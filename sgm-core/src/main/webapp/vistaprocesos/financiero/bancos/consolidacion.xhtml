<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="head">
        <script src="../../resources/pfJs/keyPress.js" type="text/javascript"></script>
        <style type="text/css">
            .ui-selectoneradio label{
                font-size: 1.2em;
                font-weight: bold;
            }
            .ui-datatable .ui-datatable-scrollable-body .ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td, .ui-datatable tfoot th{
                height : 20px;
                padding: 3px 5px;
            } 
        </style>
    </ui:define>
    <ui:define name="content">
        <h:form id="frmMain">
            <div align="center">
                <h1><h:outputText value="Emision de ficheros bancarios"/></h1>
                <p:panelGrid layout="grid" columns="2" style="width: 80%">
                    <h:outputText value="Tipo de liquidacion" style="font-weight: bolder"/>
                    <h:outputText value="#{consolidacion.tipoLiquidacion.nombreTitulo}" style="text-transform: uppercase"/>
                    <h:outputText value="Estado" style="font-weight: bolder"/>
                    <h:outputText value="#{consolidacion.estadoLiquidacion.descripcion}" style="text-transform: uppercase"/>
                    <h:outputText value="Fecha de emision" style="font-weight: bolder"/>
                    <p:calendar id="calend" value="#{consolidacion.fecReferencia}" required="true" mask="YYYY" label="Periodo de emision"/>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnBuscarPagos" value="Buscar" actionListener="#{consolidacion.cargarLiquidaciones()}" update="frmMain"/>
                        </div>
                    </f:facet>
                </p:panelGrid>
                <br/>
                <p:panelGrid layout="grid" columns="2" style="width: 80%"  rendered="#{consolidacion.existe}">
                    <h:outputText value="* Entidad bancaria" style="font-weight: bolder"/>
                    <p:selectOneMenu id="bancos" value="#{consolidacion.formato}" required="true" converter="entityConverter" label="Entidad bancaria">
                        <f:selectItem itemLabel="Elija el formato de banco" itemValue="#{null}"/>
                        <f:selectItems var="fb" value="#{consolidacion.bancos}" itemLabel="#{fb.banco}" itemValue="#{fb}"/>
                    </p:selectOneMenu>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnGenerar" value="Generar Fichero" actionListener="#{consolidacion.generarArchivo()}" update="dtEmision,:frmDescarga" oncomplete="PF('dlgDescarga').show()"/>
                        </div>
                    </f:facet>
                </p:panelGrid>
            </div>     
            <br/>
            <p:dataTable id="dtEmision" widgetVar="dtEmision" value="#{consolidacion.conciliacion}" var="emision"  lazy="true" paginator="true" rows="50" rowsPerPageTemplate="50,100,200"
                         selection="#{consolidacion.seleccionados}" rowKey="#{emision.id}" paginatorAlwaysVisible="true" rendered="#{consolidacion.existe}" filterEvent="enter">
                <f:facet name="header">
                    <p:commandButton id="btnSeleccion" value="Seleccionar todo" actionListener="#{consolidacion.seleccionarPagos()}" update="dtEmision"/>
                    <!--<p:commandButton value="select" onclick="PF('dtEmision').selectAllRows()"/>-->
                    <!--<p:commandButton value="unselect" onclick="PF('dtEmision').unselectAllRows()" />-->
                </f:facet>
                <p:column selectionMode="multiple" style="width: 10%; text-align: center"/>
                <p:column headerText="Año" style="text-align: center;" width="60" filterBy="#{emision.anio}" filterMatchMode="equals"><p:outputLabel value="#{emision.anio}"/></p:column>
                <p:column id="predio" headerText="N. Predio" style="text-align: center;" width="100"><p:outputLabel value="#{emision.predio.numPredio}"/></p:column>
                <p:column id="identificacion" headerText="Identificación" style="text-align: center" width="140"><p:outputLabel value="#{emision.comprador.ciRuc}"/></p:column>
                <p:column headerText="Contribuyente" style="text-align: center" width="200">
                    <p:outputLabel value="#{emision.comprador==null?emision.nombreComprador :emision.comprador.apellidos}#{emision.comprador.nombres}#{emision.comprador.razonSocial}#{emision.comprador.nombreComercial}"/>
                </p:column>
                <p:column headerText="Avaluo" style="text-align: center;" width="100"><p:outputLabel value="#{emision.avaluoMunicipal}"/></p:column>
                <p:column headerText="Emision" style="text-align: center;" width="100"><p:outputLabel value="#{emision.totalPago}"/></p:column>
                <p:column headerText="Descuento" style="text-align: center;" width="100"><p:outputLabel value="#{emision.descuento}"/></p:column>
                <p:column headerText="Recargo" style="text-align: center;" width="100"><p:outputLabel value="#{emision.recargo}"/></p:column>
                <p:column headerText="Interes" style="text-align: center;" width="100"><p:outputLabel value="#{emision.interes}"/></p:column>
                <p:column headerText="Coactiva" style="text-align: center;" width="100"><p:outputLabel value="#{emision.valorCoactiva}"/></p:column>
                <p:column headerText="Pago" style="text-align: center;" width="100"><p:outputLabel value="#{emision.pagoFinal}"/></p:column>
            </p:dataTable>
        </h:form>
        <p:dialog id="dlgDescarga" widgetVar="dlgDescarga" header="Descarga de fichero #{consolidacion.formato.banco}" modal="true" appendTo="@(body)" width="50%" height="250" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmDescarga">
                <p:panelGrid columns="2" layout="grid">
                    <h:outputText value="* Nombre del fichero : "/>
                    <p:inputText value="#{consolidacion.nombre}" required="true" label="Nombre del archivo" requiredMessage="El nombre del archivo es obligatorio" style="width: 100%"/>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnDescargar" value="Descargar" icon="ui-icon-info" ajax="false" actionListener="#{consolidacion.descargar()}"/>
                        </div>
                    </f:facet>
                </p:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
