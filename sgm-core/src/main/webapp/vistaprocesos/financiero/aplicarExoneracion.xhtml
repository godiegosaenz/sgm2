<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">

    <ui:define name="head">
        <script src="../../resources/pfJs/keyPress.js" type="text/javascript"></script>
        <style type="text/css">
            .ui-datepicker .ui-datepicker-title select {
                font-size: 1em;
                margin: 1px 0;
                color: black;
            }
        </style>
    </ui:define>

    <ui:define name="page_title">
        Aplicar Exoneraci&#243;n
    </ui:define>

    <ui:define name="top">

    </ui:define>

    <ui:define name="content">
        <center>
            <h1>Aplicar Exoneraci&#243;n</h1>
        </center>


        <h:form id="mainForm">
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;" rendered="#{aplicarExoneracion.ht != null}">
                <p:outputLabel value="Trámite: #{aplicarExoneracion.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Tarea: #{aplicarExoneracion.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{aplicarExoneracion.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
            <p:tabView rendered="#{aplicarExoneracion.ht != null}">
                <p:tab title="SOLICITUD">
                    <p:fieldset legend="DATOS" style="font-size: 13px;">
                        <h:panelGrid style="width: 100%;">
                            <p:row>
                                <p:column colspan="3">
                                    <p:outputLabel value="SOLICITANTE: #{aplicarExoneracion.solicitud.solicitante.ciRuc} - #{aplicarExoneracion.solicitud.solicitante.apellidos} #{aplicarExoneracion.solicitud.solicitante.nombres} #{aplicarExoneracion.solicitud.solicitante.razonSocial}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="SOLICITUD: "/><p:inputText value="#{aplicarExoneracion.solicitud.id}" readonly="true"/>
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="FECHA INGRESO: "/><p:outputLabel value="#{aplicarExoneracion.solicitud.fechaIngreso}"><f:convertDateTime pattern="dd/MM/yyyy"/></p:outputLabel>
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="DESDE:#{aplicarExoneracion.solicitud.anioInicio} - HASTA:#{aplicarExoneracion.solicitud.anioFin}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="CLASE: #{aplicarExoneracion.solicitud.exoneracionTipo.exoneracionClase.descripcion}"/>
                                </p:column>
                                <p:column colspan="2">
                                    <p:outputLabel value="TIPO: #{aplicarExoneracion.solicitud.exoneracionTipo.descripcion}"/>
                                </p:column>
                            </p:row>
                        </h:panelGrid>                        
                    </p:fieldset>
                    <center>
                        <p:dataTable style="margin-top: 15px; width: 60%;" value="#{aplicarExoneracion.predios}" var="p" paginator="true" paginatorPosition="top" rows="5" emptyMessage="Sin datos...">
                            <f:facet name="header">
                                Lista de predios urbanos
                            </f:facet>
                            <p:column headerText="Num. Predio" style="text-align: center;" width="20%">
                                <h:outputText value="#{p.numPredio}"/>
                            </p:column>
                            <p:column headerText="Cod. Catastral" style="text-align: center;" width="35%">
                                <h:outputText value="#{p.codigoPredialCompleto}"/>
                            </p:column>
                            <p:column headerText="Propietario" style="text-align: center;" width="45%">
                                <h:outputText value="#{p.nombrePropietarios}"/>
                            </p:column>
                        </p:dataTable>
<!--                        <p:dataTable style="margin-bottom: 15px; width: 60%;" value="#{aplicarExoneracion.rusticos}" var="r" paginator="true" paginatorPosition="top" rows="5" emptyMessage="Sin datos...">
                            <f:facet name="header">
                                Lista de predios rústicos
                            </f:facet>
                            <p:column headerText="ID predial" style="text-align: center;" width="20%">
                                <h:outputText value="#{r.idPredial}"/>
                            </p:column>
                            <p:column headerText="Cod. Catastral" style="text-align: center;" width="35%">
                                <h:outputText value="#{r.parroquia.descripcion}"/>
                            </p:column>
                            <p:column headerText="Propietario" style="text-align: center;" width="40%">
                                <h:outputText value="#{r.propietario.nombreCompleto}"/>
                            </p:column>
                        </p:dataTable>-->
                    </center>
                    <h:panelGroup style="margin-top: 25px; margin-bottom: 15px;">                     
                        <br/>
                        <center>

                            <p:commandButton value="Aplicar" actionListener="#{aplicarExoneracion.setAplicacionEstado(1)}"
                                             styleClass="btnStyle" style="width: 90px;" update="frmObs2" oncomplete="PF('obs2').show()"/>
                            <p:spacer width="20"/>

                            <p:commandButton value="Rechazar" actionListener="#{aplicarExoneracion.setAplicacionEstado(2)}" styleClass="btnStyle" style="width: 90px;" update="frmObs" oncomplete="PF('obs').show()"/>
                            <p:spacer width="20"/>
                            <!--<p:commandButton value="Correccion" actionListener="#{aplicarExoneracion.setAplicacionEstado(3)}" styleClass="btnStyle" style="width: 90px;" update="frmObs" oncomplete="PF('obs').show()"/>-->
                        </center>
                    </h:panelGroup>

                    <!-- -->

                    <p:panel header="Lista de exoneraciones pendientes" rendered="#{aplicarExoneracion.ht == null}">
                        <p:dataTable value="#{aplicarExoneracion.solicitudesLazy}" var="s1" lazy="true" filterEvent="enter"
                                     paginatorPosition="top" paginator="true" paginatorAlwaysVisible="false" emptyMessage="No se encontraron Registros..."
                                     rows="10" rowsPerPageTemplate="10, 20,50,100" reflow="true">
                            <p:column headerText="No. Solicitud" width="5%" style="text-align: center" filterBy="#{s1.id}" sortBy="#{s1.id}">
                                <p:outputLabel value="#{s1.id}"/>
                            </p:column>
                            <p:column headerText="No. Predio" width="7%" style="text-align: center" filterBy="#{s1.solicitud.numPredioBoth}">
                                <p:outputLabel value="#{s1.solicitud.predio.numPredio}-URB" rendered="#{s1.solicitud.predio != null}"/>
                                <p:outputLabel value="#{s1.solicitud.predioRustico.numPredioRustico}-RUS" rendered="#{s1.solicitud.predio == null}"/>
                            </p:column>
                            <p:column headerText="Solicitante" width="30%" style="text-align: center">
                                <p:outputLabel value="#{s1.solicitud.solicitante.nombreCompleto}"/>
                            </p:column>
                            <p:column headerText="Tipo" width="10%" style="text-align: center" >
                                <p:outputLabel value="#{s1.solicitud.exoneracionTipo.descripcion}" />
                            </p:column>
                            <p:column headerText="Clase" width="18%" style="text-align: center" >
                                <p:outputLabel value="#{s1.solicitud.exoneracionTipo.exoneracionClase.descripcion}" />
                            </p:column>
                            <p:column headerText="Año" width="5%" style="text-align: center" sortBy="#{s1.anio}">
                                <p:outputLabel value="#{s1.anio}" />
                            </p:column>
                            <p:column headerText="Fecha" width="8%" style="text-align: center">
                                <p:outputLabel value="#{s1.fechaIngreso}" >
                                    <f:convertDateTime parent="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Resolucion" width="7%" style="text-align: center" sortBy="#{s1.solicitud.numResolucionSac}">
                                <p:outputLabel value="#{s1.solicitud.numResolucionSac}"/>
                            </p:column>
                            <p:column headerText="Acción" width="10%" style="text-align: center">
                                <p:commandLink value="Aplicar exoneración" update="frmObs3" actionListener="#{aplicarExoneracion.setSolicitud(s1.solicitud)}" onclick="PF('obs3').show()"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </p:tab>
                <p:tab title="DOCUMENTOS">
                    <dialog:detalleArchivosAct archivos="#{aplicarExoneracion.processInstanceAllAttachments}" />
                </p:tab>
                <p:tab title="OBSERVACIONES">
                    <p:dataTable id="dtObs" value="#{aplicarExoneracion.ht.observacionesCollection}" var="obs" reflow="true" style="width: 100%">
                        <p:column headerText="Observacion" style="width: 60%">
                            <h:outputText value="#{obs.observacion}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Responsable" style="width: 25%">
                            <h:outputText value="#{obs.userCre}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Tarea" style="width: 25%">
                            <h:outputText value="#{obs.tarea}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Fecha" style="width: 15%">
                            <h:outputText value="#{obs.fecCre}" style="text-transform: uppercase"/>
                        </p:column>
                    </p:dataTable>
                </p:tab>
            </p:tabView>

            <!-- -->

            <p:tabView rendered="#{aplicarExoneracion.ht == null}" id="tabExo">
                <p:tab title="NUEVA EXONERACIÓN" id="tabNewExo">
<!--                    <p:commandLink value="==> Agregar otro Tipo de Liquidación" actionListener="#{aplicarExoneracion.abrirDialogoTipoLiquidaciones}" style="float: right; color: #0066cc; font-size: 14px;" update="formTipoLiquidaciones"/>-->
                    <br/>
                    <center>
                        <h:panelGrid columns="4" >
                            <h:outputText value="Número de Identificación" style="display: block;"/>
                            <p:inputText value="#{aplicarExoneracion.cedulaRuc}" style="display: block; margin: 0 auto;" />
                            <p:spacer width="5"/>
                            <p:commandLink id="busSolicitante" actionListener="#{aplicarExoneracion.openDlgSolicitante}"   >
                                <p:graphicImage value="/css/homeIconsImages/buscar.png" height="25" width="25"/>
                            </p:commandLink>             
                            <center>
                                <p:commandButton update="mainForm" actionListener="#{aplicarExoneracion.buscarEnte()}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" />    
                            </center>

                        </h:panelGrid>
                    </center>

                    <p:panelGrid id="pnlCampos" style="width: 100%; margin: 0 auto;" rendered="#{aplicarExoneracion.solicitante != null}">
                        <p:row id="mnRow1">
                            <p:column colspan="2">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Nombre del solicitante"/>
                                    <p:inputText value="#{aplicarExoneracion.solicitante.esPersona == true ? aplicarExoneracion.solicitante.nombreCompleto : aplicarExoneracion.solicitante.razonSocial}" readonly="true" style="width: 300px;"/>
                                </p:panelGrid>
                            </p:column>

                        </p:row>

                        <p:row id="mnRow">
                            <p:column style="width: 80%; margin: 0 auto;">
                                <p:panelGrid columns="2" >
                                    <p:outputLabel value="DESDE" style="font-weight: bold;"/>
                                    <p:outputLabel value="HASTA" style="font-weight: bold;"/>
                                    <p:inputText type="number" value="#{aplicarExoneracion.solicitud.anioInicio}" />
                                    <p:inputText type="number" value="#{aplicarExoneracion.solicitud.anioFin}"/>
                                </p:panelGrid>
                            </p:column>
                            <p:column colspan="2">
                                <p:panelGrid columns="2" style="width: 100%; margin: 0 auto;" id="pnlClase">
                                    <p:outputLabel value="Clase de Exoneración" style="font-weight: bold;"/>
                                    <p:outputLabel value="Tipo de Exoneración" style="font-weight: bold;"/>
                                    <p:selectOneMenu value="#{aplicarExoneracion.clase}" converter="entityConverter" style="width:340px; font-weight: bold;">
                                        <f:selectItems value="#{serviceLists.clases}" var="req1" itemValue="#{req1}"  itemLabel="#{req1.descripcion}" itemDisabled="false"/>
                                        <p:ajax update="mainForm:tabExo:pnlClase" event="change" listener="#{aplicarExoneracion.selClase}"/>
                                    </p:selectOneMenu>
                                    <p:selectOneMenu value="#{aplicarExoneracion.tipo}" converter="entityConverter" style="width:260px; font-weight: bold;">
                                        <f:selectItems value="#{aplicarExoneracion.tipos}" var="req2" itemValue="#{req2}"  itemLabel="#{req2.descripcion}" itemDisabled="false"/>
                                    </p:selectOneMenu>
                                </p:panelGrid>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:panelGrid columns="2">
                                    <p:outputLabel value="Nº Oficio" style="font-weight: bold;"/>
                                    <p:outputLabel value="Fecha Oficio" style="font-weight: bold;"/>
                                    <p:inputText value="#{aplicarExoneracion.solicitud.numResolucionSac}"/>                            
                                    <p:calendar value="#{aplicarExoneracion.solicitud.fechaAprobacion}" navigator="true" pattern="dd/MM/yyyy" maxdate="sysdate"/>
                                </p:panelGrid>
                            </p:column>
                            <p:column >
                                <p:panelGrid columns="2">
                                    <p:outputLabel value="Tipo de valor" style="font-weight: bold;"/>
                                    <p:outputLabel value="Valor" style="font-weight: bold;"/>
                                    <p:selectOneMenu value="#{aplicarExoneracion.solicitud.tipoValor}" converter="entityConverter" style="width: 220px;">
                                        <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />
                                        <f:selectItems value="#{serviceLists.getTipoValores('exo')}" var="req2" itemValue="#{req2}"  itemLabel="#{req2.descripcion}" itemDisabled="false"/>
                                    </p:selectOneMenu>
                                    <p:inputText type="number" value="#{aplicarExoneracion.solicitud.valor}" />
                                </p:panelGrid>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>
                    <p:tabView id="tvConsultasPredios">

                        <p:tab title="PREDIO URBANO">
                            <dialog:consultaCodigoPredial id="consulta" tipoConsulta="#{aplicarExoneracion.predioModel.tipoConsultaUrbano}"
                                                          updateConsulta="consulta, mainForm:tabExo:tvConsultasPredios:prediosUrbanos"
                                                          predioModel="#{aplicarExoneracion.predioModel}"
                                                          contribuyenteConsulta="#{aplicarExoneracion.predioModel.contribuyenteConsulta}"
                                                          dlgSolicitante="PF('dlgSolicitante').show()"
                                                          ciudadelas="#{serviceLists.ciudadelas}"
                                                          consultarEmisiones="#{aplicarExoneracion.consultarPredioUrbano()}"
                                                          updateFrmSolicitante=":frmSolicitante"
                                                          tipoPredio="true"
                                                          renderConsultaDirecta="false"/>
                            <br/>                          
                            <center>
                                <p:commandButton value="Generar y aplicar Exoneración" styleClass="btnStyle" actionListener="#{aplicarExoneracion.aplicarExoneracionSinTramite(2)}"  >
                                    <p:confirm header="Advertencia" message="Esta seguro de continuar con la exoneracion #{aplicarExoneracion.exoneracionTipo.descripcion}?" icon="ui-icon-alert" />
                                </p:commandButton>
                            </center>
                            <br/>
                            <p:dataTable id="prediosUrbanos" value="#{aplicarExoneracion.prediosUrbanos}" var="urbano" scrollHeight="350" 
                                         rows="20" paginator="true" emptyMessage="No se ha seleccionado ningun elemento" rowIndexVar="index"
                                         rowsPerPageTemplate="20,50,100" paginatorPosition="top" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                                <p:column headerText="Matricula Inmobiliaria" width="100"><p:outputLabel value="#{urbano.numPredio}"/></p:column>
                                <p:column headerText="Cod. Catastral"><p:outputLabel value="#{urbano.claveCat}"/></p:column>
                                <p:column headerText="Dirección"><p:outputLabel value="#{urbano.ciudadela.nombre} -  Mz. #{urbano.mz} Sl.#{urbano.solar}"/></p:column>
                                <p:column headerText="Propietario"><p:outputLabel value="#{urbano.nombrePropietarios}"/></p:column>
                                <p:column headerText="Avalùo de la Propiedad">
                                    <h:outputText value="#{urbano.avaluoMunicipal}" >
                                        <f:convertNumber pattern="$ #,##0.00" />
                                    </h:outputText>
                                </p:column>                    
                                <p:column headerText="Eliminar" style="text-align: center;" width="100">
                                    <p:commandLink update="mainForm:tabExo:tvConsultasPredios:prediosUrbanos" action="#{aplicarExoneracion.eliminarPredioUrbano(index)}">
                                        <p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/></p:commandLink></p:column>
                            </p:dataTable>
                        </p:tab>

                        <p:tab title="PREDIO RURAL" rendered="#{appConfig.mainConfig.fichaPredial.aplicarExoneracionPredioRural}">
                            <p:selectOneRadio value="#{aplicarExoneracion.predioModel.tipoConsultaRural}">
                                <f:selectItem itemLabel="CODIGO PREDIAL" itemValue="1" />
                                <p:ajax update="consultaRural"/>
                            </p:selectOneRadio>
                            <p:panel id="consultaRural">
                                <p:panelGrid rendered="#{aplicarExoneracion.predioModel.tipoConsultaRural eq 1}">
                                    <p:row>
                                        <p:column><p:outputLabel value="CODIGO PREDIAL: " style="font-size: 13px; font-weight: bolder;"/></p:column>
                                    </p:row>
                                    <p:row>
                                        <p:column><p:inputText value="#{aplicarExoneracion.predioModel.regCatastral}" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                    </p:row>
                                </p:panelGrid>
                                <br/>
                                <center><p:commandButton value="CONSULTAR" actionListener="#{aplicarExoneracion.consultarPredioRural()}" update="prediosRurales" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-search" iconPos="right"/></center>
                            </p:panel>
                            <br/>
                            <center>
                                <p:commandButton value="Generar y aplicar Exoneración" styleClass="btnStyle" actionListener="#{aplicarExoneracion.aplicarExoneracionSinTramite(2)}" update="frmExoAp" oncomplete="PF('dlgExoAplicada').show()">
                                    <p:confirm header="Advertencia" message="Esta seguro de continuar con la exoneracion #{aplicarExoneracion.exoneracionTipo.descripcion}?" icon="ui-icon-alert" />
                                </p:commandButton>
                            </center>
                            <br/>
                            <p:dataTable id="prediosRurales" value="#{aplicarExoneracion.prediosRurales}" var="rural" rowKey="#{rural.id}"  scrollHeight="350" lazy="true" reflow="true" rows="20" paginator="true" emptyMessage=""
                                         rowsPerPageTemplate="20,50,100" paginatorPosition="top" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                                <p:column headerText="Cod. Catastral">
                                    <p:outputLabel value="#{rural.regCatastral}"/>
                                </p:column>
                                <p:column headerText="Cod. Catastral">
                                    <p:outputLabel value="#{rural.predioRustico ne null?rural.predioRustico.propietario.nombreCompleto:rural.predioRusctico2017.nombreCompleto}"/>
                                </p:column>
                                <p:column headerText="Eliminar" style="text-align: center;" width="100">
                                    <p:commandLink update="prediosRurales" actionListener="#{aplicarExoneracion.eliminarPredioRural(rural)}"><p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/></p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </p:tab>   

                    </p:tabView>

                </p:tab>
            </p:tabView>
        </h:form>

        <!-- -->

        <p:dialog id="dlgExoAplicada" widgetVar="dlgExoAplicada" header="Solicitud de Exoneración Aplicada" appendTo="@(body)" modal="true" width="80%" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmExoAp">
                <p:panel id="pobs" header="Datos de la exoneración" style="width: 100%">

                    <div align="center">
                        <h:outputText value="NUMERO DE SOLICITUD: #{aplicarExoneracion.exoneracion.id}" style="font-weight:bold"/>
                        <h:outputText value=" - TIPO: #{aplicarExoneracion.exoneracion.exoneracion.exoneracionTipo.descripcion}" style="font-weight:bold"/>
                        <p:panelGrid columns="2">
                            <p:fieldset legend="Liquidación Original" style="font-size: 13px;">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Total a pagar"/>
                                    <p:inputText value="#{aplicarExoneracion.original==null? 0.00 : aplicarExoneracion.original.totalPago}"/>
                                </p:panelGrid>
                                <p:dataList value="#{aplicarExoneracion.detList1}" var="t1" type="ordered" emptyMessage="#{aplicarExoneracion.original==null?'EMISION DE TITULO':'SIN REGISTROS'}">
                                    <f:facet name="header">
                                        Rubros
                                    </f:facet>
                                    #{t1.descripcion}: #{t1.valor}
                                </p:dataList>
                            </p:fieldset>

                            <!-- -->

                            <p:fieldset legend="Liquidación Posterior" style="font-size: 13px;">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Total a pagar"/>
                                    <p:inputText value="#{aplicarExoneracion.posterior==null? 0.00 : aplicarExoneracion.posterior.totalPago}"/>
                                </p:panelGrid>
                                <p:dataList value="#{aplicarExoneracion.detList2}" var="t2" type="ordered" emptyMessage="#{aplicarExoneracion.posterior==null?'BAJA DE TITULO':'SIN REGISTROS'}">
                                    <f:facet name="header">
                                        Rubros
                                    </f:facet>
                                    #{t2.descripcion}: #{t2.valor}
                                </p:dataList>
                            </p:fieldset>
                        </p:panelGrid>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>

        <!-- -->

        <p:dialog id="dlgObs" widgetVar="obs" header="Solicitud de Exoneración" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs">
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">

                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{aplicarExoneracion.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                        <br/>
                        <p:commandButton id="btnValidar" value="Validar Requisitos" actionListener="#{aplicarExoneracion.aplicarExoneracion()}" oncomplete="PF('obs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>

        <!-- -->

        <p:dialog id="dlgObs2" widgetVar="obs2" header="Aplicación de Exoneración" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs2">
                <p:panelGrid columns="3" id="pobs1" style="width: 100%">
                    <h:outputText value="Valor de la exoneración: "/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valor}" style="text-align: right;"  rendered="#{!aplicarExoneracion.solicitud.tipoValor.esPorcentaje}"/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valor}" placeholder="%" style="text-align: right;" rendered="#{aplicarExoneracion.solicitud.tipoValor.esPorcentaje}"/>
                    <p:selectOneMenu  id="idBase" value="#{aplicarExoneracion.solicitud.tipoValor}" converter="entityConverter" effect="fold"  style="width:180px;">
                        <p:ajax update="frmObs2"/>
                        <f:selectItems value="#{serviceLists.getTipoValores('exo')}" var="itemCEC" itemLabel="#{itemCEC.descripcion}" itemValue="#{itemCEC}"/>  
                    </p:selectOneMenu>
                </p:panelGrid>
                <p:panelGrid columns="2" style="width: 100%">
                    <h:outputText value="Valor IP: "/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valorIP}" style="text-align: right;"/>
                </p:panelGrid>
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">

                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{aplicarExoneracion.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" />
                        <br/>
                        <p:commandButton update="mainForm" id="btnValidar" value="Validar Requisitos" actionListener="#{aplicarExoneracion.aplicarExoneracion()}" oncomplete="PF('obs2').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>        

        <!-- -->

        <p:dialog id="dlgObs3" widgetVar="obs3" header="Aplicación de Exoneración" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs3">
                <p:panelGrid columns="3" id="pobs1" style="width: 100%">
                    <h:outputText value="Ingrese el valor de la exoneración: "/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valor}" style="text-align: right;"  rendered="#{!aplicarExoneracion.solicitud.tipoValor.esPorcentaje}"/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valor}" placeholder="%" style="text-align: right;" rendered="#{aplicarExoneracion.solicitud.tipoValor.esPorcentaje}"/>
                    <p:selectOneMenu  id="idBase" value="#{aplicarExoneracion.solicitud.tipoValor}" converter="entityConverter" effect="fold"  style="width:180px;">
                        <p:ajax update="frmObs2"/>
                        <f:selectItems value="#{serviceLists.getTipoValores('exo')}" var="itemCEC" itemLabel="#{itemCEC.descripcion}" itemValue="#{itemCEC}"/>  
                    </p:selectOneMenu>

                </p:panelGrid>
                <p:panelGrid columns="2" style="width: 100%">
                    <h:outputText value="Ingrese el valor IP: "/>
                    <p:inputText value="#{aplicarExoneracion.solicitud.valorIP}" style="text-align: right;"/>
                </p:panelGrid>
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">

                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{aplicarExoneracion.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true"/>
                        <br/>
                        <p:commandButton update="mainForm" id="btnValidar" value="Validar Requisitos" actionListener="#{aplicarExoneracion.aplicarExoneracionAutomatico()}" oncomplete="PF('obs3').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>

        <!-- -->

        <p:dialog header="Listado de Predios - Seleccione Predio" widgetVar="dlgPrediosConsulta" appendTo="@(body)" width="90%" responsive="true" closable="true" closeOnEscape="true" modal="true">
            <h:form id="frmPredios">
                <p:dataTable value="#{aplicarExoneracion.predioConsulta.prediosConsulta}" var="p" selectionMode="single" selection="#{aplicarExoneracion.predioConsulta.predioConsulta}" rowKey="#{p.id}" style="width: 90%; margin: 0 auto;" reflow="true" paginator="true" rows="10" filterEvent="enter" paginatorPosition="top">
                    <p:column headerText="No. Predio" sortBy="#{p.numPredio}" filterBy="#{p.numPredio}" filterMatchMode="exact" filterStyle="width: 95%;"><h:outputText value="#{p.numPredio}"/></p:column>
                    <p:column headerText="Urbanizacion"><h:outputText value="#{p.ciudadela.nombre}"/></p:column>
                    <p:column headerText="Mz"><h:outputText value="#{p.urbMz}"/></p:column>
                    <p:column headerText="Sl"><h:outputText value="#{p.urbSolarnew}"/></p:column>
                    <p:column headerText="Cod. Predial"><h:outputText value="#{p.codigoPredialCompleto}"/></p:column>
                    <f:facet name="footer">
                        <p:commandButton value="Seleccionar" onclick="PF('dlgPrediosConsulta').hide()" update="mainForm"/>
                    </f:facet>
                </p:dataTable>         
            </h:form>
        </p:dialog>

        <!-- -->

        <p:confirmDialog global="true">
            <center>
                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </center>
        </p:confirmDialog>

        <p:dialog header="LISTADO TIPO DE LIQUIDACIONES" widgetVar="tipoLiquidacionesDlg"  resizable="false" width="70%" height="10%" position="center">
            <h:form id="formTipoLiquidaciones">
                <h:panelGrid columns="3" style="width: 80%; margin: 0 auto;">
                    <p:outputLabel value="Tipo Liquidación" style="font-weight: bold;"/>
                    <p:outputLabel value="Rubros Liquidación" style="font-weight: bold;"/>
                    <p:outputLabel value="Agregar" style="font-weight: bold;"/>
                    <p:selectOneMenu value="#{aplicarExoneracion.tipoLiquidacion}" style="width:300px; font-weight: bold;" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                        <f:selectItems value="#{aplicarExoneracion.tipoLiquidaciones}" var="tipoLiquidacion" itemLabel="#{tipoLiquidacion.nombreTransaccion}" itemValue="#{tipoLiquidacion}"/>
                        <p:ajax update="formTipoLiquidaciones"/>
                    </p:selectOneMenu>
                    <p:selectOneMenu value="#{aplicarExoneracion.rubroLiquidacion}" style="width:300px; font-weight: bold;" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                        <f:selectItems value="#{aplicarExoneracion.tipoLiquidacion.renRubrosLiquidacionCollection}" var="rubro" itemLabel="#{rubro.descripcion}" itemValue="#{rubro}"/>
                    </p:selectOneMenu>
                    <p:commandButton value="Agregar" actionListener="#{aplicarExoneracion.agregarTipoLiquidacionSolicitud}" update="dtTipoLiquidaciones" styleClass="btnStyle" icon="ui-icon-plusthick"/>
                </h:panelGrid>
                <br/>
                <p:dataTable id="dtTipoLiquidaciones" value="#{aplicarExoneracion.tipoLiquidacionesEnSolitud}" var="tipoLiquidacionSolicitud" scrollable="true" style="
                             height: 50%" scrollHeight="350" lazy="true" reflow="true" rows="5">
                    <p:column headerText="Tipo Liquidacion"><p:outputLabel value="#{tipoLiquidacionSolicitud.tipoLiquidacion.nombreTransaccion}"/></p:column>
                    <p:column headerText="Rubro"><p:outputLabel value="#{tipoLiquidacionSolicitud.rubro.descripcion}"/></p:column>
                    <p:column headerText="Eliminar">
                        <p:commandLink update="dtTipoLiquidaciones" actionListener="#{aplicarExoneracion.eliminarTipoLiquidacionSolicitud(tipoLiquidacionSolicitud)}">
                            <p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/>   
                        </p:commandLink>
                    </p:column>
                </p:dataTable>

                <center>
                    <p:commandButton value="Aceptar" oncomplete="PF('tipoLiquidacionesDlg').hide();" styleClass="btnStyle" icon="ui-icon-check"/>
                </center>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgSolicitante" widgetVar="dlgSolicitante" header="Listado de Contribuyentes" appendTo="@(body)" width="70%" responsive="true" closable="true" closeOnEscape="true" modal="true" position="center">
            <h:form id="frmSolicitante">
                <p:dataTable id="dtSolicitante" value="#{aplicarExoneracion.solicitantes}" var="s" 
                             selection="#{aplicarExoneracion.predioModel.contribuyenteConsulta}" 
                             rowKey="#{s.id}" style="width: 100%" lazy="true" 
                             paginator="true" rows="10"  filterEvent="enter" paginatorPosition="top">
                    <f:facet name="header">Seleccione Contribuyente</f:facet>
                    <p:column selectionMode="single" style="width: 8%; text-align: center"  />
                    <p:column headerText="No. Identificacion" sortBy="#{s.ciRuc}" filterBy="#{s.ciRuc}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.ciRuc}"/>
                    </p:column>
                    <p:column headerText="Apellidos" filterBy="#{s.apellidos}" sortBy="#{s.apellidos}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.apellidos}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{s.nombres}" sortBy="#{s.nombres}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.nombres}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Razon Social" filterBy="#{s.razonSocial}" sortBy="#{s.razonSocial}"  filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.razonSocial}" style="text-transform: uppercase"/>
                    </p:column>
                    <f:facet name="footer">
                        <p:commandButton id="btnSeleccionar" actionListener="#{aplicarExoneracion.seleccionarContribuyente()}" value="Seleccionar" update="mainForm" style="height: 30px" oncomplete="PF('dlgSolicitante').hide()"/>
                    </f:facet>
                </p:dataTable>         
            </h:form>
        </p:dialog>        

        <p:dialog id="dlgPrediosQuePuedenSerExonerados" widgetVar="dlgPrediosQuePuedenSerExonerados" 
                  header="LISTADO DE PREDIOS QUE PUEDEN SER EXONERADOS" appendTo="@(body)" width="70%" responsive="true" closable="true" 
                  closeOnEscape="true" modal="true" position="center">
            <h:form id="frmPrediosASerExonerados">
                <p:dataTable id="dtPrediosSeguros" value="#{aplicarExoneracion.prediosUrbanosAExonerar}" var="urbano" 
                             style="width: 100%" lazy="true" reflow="true" paginator="true" rows="10" paginatorPosition="center">
                    <p:column headerText="Matricula Inmobiliaria" width="100"><p:outputLabel value="#{urbano.numPredio}"/></p:column>
                    <p:column headerText="Propietario"><p:outputLabel value="#{urbano.nombrePropietarios}"/></p:column>
                </p:dataTable>         
                <br></br><br></br>
                <div align="center">
                    <p:commandButton value="Aplicar Exoneración" styleClass="btnStyle" actionListener="#{aplicarExoneracion.exonerarPrediosMenoresA500Remuneraciones()}"  >
                        <p:confirm header="Advertencia" message="Esta seguro de continuar con la exoneracion #{aplicarExoneracion.exoneracionTipo.descripcion}?" icon="ui-icon-alert" />
                    </p:commandButton>
                    <p:spacer width="5" />
                    <p:commandButton value="Cancelar" styleClass="btnStyle"  oncomplete="PF('dlgPrediosQuePuedenSerExonerados').hide()"/>
                </div>

            </h:form>
        </p:dialog>  

    </ui:define>

</ui:composition>



