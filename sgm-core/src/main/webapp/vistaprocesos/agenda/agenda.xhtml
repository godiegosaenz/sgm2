<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="content">
        <center>
            <h1>
                Agenda
            </h1>
        </center>
        <h:form id="frmMain">
            <p:messages autoUpdate="true" showDetail="true"/>
            <center>
                <p:tabView id="tvAgenda" style="width: 98%">                
                    <p:tab id="tCalendario" title="Calendario de actividades" titleStyle="font-weight: bolder; font-size: 12px;">
                        <div align="center">
                            <p:schedule id="schedule"  value="#{agendaTrabajo.calendario}" style="width: 80%" rendered="#{agendaTrabajo.habilitado}" locale="es" draggable="false">
                                <p:ajax event="dateSelect" listener="#{agendaTrabajo.onDateSelect}" oncomplete="PF('dlgEvento').show();" update=":frmAgenda"/>
                                <p:ajax event="eventSelect" listener="#{agendaTrabajo.onEventSelect}" oncomplete="PF('dlgEvento').show();" update=":frmAgenda"/>
                            </p:schedule>
                        </div>
                    </p:tab>
                    <p:tab id="tEventos" title="Mis Actividades">
                        <p:dataTable id="dtEventos" value="#{agendaTrabajo.misEventos}" var="cl" lazy="true" reflow="true" style="width: 100%" paginator="true" rows="10" rowsPerPageTemplate="20,50,100"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                            <!--<p:column headerText="Tipo" filterBy="#{cl.agenda.tipo.descripcion}" filterMatchMode="contains" sortBy="#{cl.agenda.tipo.descripcion}">
                                <h:outputText value="#{cl.agenda.tipo.descripcion}" style="text-transform: uppercase"/>
                            </p:column>-->
                            <p:column headerText="Evento/Actividad" filterBy="#{cl.agenda.descripcion}" filterMatchMode="contains">
                                <h:outputText value="#{cl.agenda.descripcion}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Solicitante" filterBy="#{cl.agenda.tramite.nombrePropietario}" filterMatchMode="contains">
                                <h:outputText value="#{cl.agenda.tramite.nombrePropietario}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Involucrado">
                                <h:outputText value="#{cl.involucrado.apellidos} #{cl.involucrado.nombres}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Detalle" filterBy="#{cl.detalle}" filterMatchMode="contains">
                                <h:outputText value="#{cl.detalle}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Fecha Inicio">
                                <h:outputText value="#{cl.agenda.FInicio}"/>
                            </p:column>
                            <p:column headerText="Fecha Fin" sortBy="#{cl.fecAtencion}">
                                <h:outputText value="#{cl.fecAtencion}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </center>
        </h:form>
        <p:dialog id="dlgEvento" widgetVar="dlgEvento" header="Gestor de actividades" closable="true" closeOnEscape="true" modal="true" appendTo="@(body)" responsive="true" width="700" style="font-weight: bold;background: #616161; color: #FFFFFF;">
            <h:form id="frmAgenda">
                <p:panel id="pDatosAgenda" header="Los campos marcados con * son obligatorios" style="width: 100%;">
                    <p:messages autoUpdate="true" showDetail="true"/>
                    <p:tabView id="tvDatos" style="width: 100%" scrollable="true">
                        <p:tab id="tAgendar" title="Datos de la actividad">
                            <p:panelGrid id="pgDatosEvento" style="width: 100%">
                                <p:row>
                                    <p:column>
                                        <h:outputText value="* Tipo de actividad" style="font-weight: bolder"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu id="tipoEvento" value="#{agendaTrabajo.agenda.tipo}" converter="entityConverter" style="width: 250px; height: 30px">
                                            <!--<p:ajax update="frmAgenda"/>-->
                                            <f:selectItems value="#{agendaTrabajo.eventos}" var="tev" itemLabel="#{tev.descripcion}" itemValue="#{tev}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="* Fecha" style="font-weight: bolder"/>
                                    </p:column>
                                    <p:column>
                                        <p:calendar id="finicio" value="#{agendaTrabajo.evento.startDate}" style="width: 80%" pattern="MM/dd/yyyy HH:mm:ss"/>                                
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{agendaTrabajo.agenda.id==null}">
                                    <p:column>
                                        <h:outputText value="Involucrados"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectCheckboxMenu id="involucrados" value="#{agendaTrabajo.invSel}" converter="entityConverter" label="Elija el(los) involucrado(s)" filter="true" filterMatchMode="contains" style="width: 250px; height: 30px">
                                            <f:selectItems value="#{agendaTrabajo.involucrados}" var="pr" itemLabel="#{pr.ente.nombres} #{pr.ente.apellidos}" itemValue="#{pr}"/>
                                        </p:selectCheckboxMenu>
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{!agendaTrabajo.director}">
                                    <p:column>
                                        <h:outputText value="* Director responsable"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu id="directorResp" value="#{agendaTrabajo.directorSelec}" converter="entityConverter" label="Elija la direccion respectiva" filter="true" filterMatchMode="contains" style="width: 250px; height: 30px">
                                            <f:selectItems value="#{agendaTrabajo.directores}" var="pr" itemLabel="#{pr.ente.nombres} #{pr.ente.apellidos}" itemValue="#{pr}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="Elija un color"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu id="colores" value="#{agendaTrabajo.color}" converter="entityConverter" var="color" style="width: 250px; height: 30px">
                                            <f:selectItems value="#{agendaTrabajo.colores}" var="pr" itemValue="#{pr}" itemLabel="#{pr.nombre}"/>
                                            <p:column>
                                                <h:outputText style="background-color:#{color.codigo}" value=" ---- "/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="Requiere de :"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectBooleanCheckbox id="lectura" value="#{agendaTrabajo.agenda.lectura}" itemLabel="Lectura"/>
                                        <p:spacer width="3"/>
                                        <p:selectBooleanCheckbox id="contesta" value="#{agendaTrabajo.agenda.contestacion}" itemLabel="Contestacion"/>
                                        <p:spacer width="3"/>
                                        <p:selectBooleanCheckbox id="confirma" value="#{agendaTrabajo.agenda.confirmacion}" itemLabel="Confirmacion"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="Lugar" style="font-weight: bolder"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="lugar" value="#{agendaTrabajo.agenda.lugar}" style="width: 80%;text-transform: uppercase"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputText value="Avisos previo actividad" style="font-weight: bolder"/>
                                    </p:column>
                                    <p:column>
                                        <p:selectBooleanCheckbox value="#{agendaTrabajo.tipoAviso.notificacion}" itemLabel="Notificacion" disabled="true"/>
                                        <p:spacer width="5"/>
                                        <p:selectBooleanCheckbox value="#{agendaTrabajo.tipoAviso.alerta}" itemLabel="Alertas">
                                            <p:ajax update="frmAgenda"/>
                                        </p:selectBooleanCheckbox>
                                        <p:spacer width="5"/>
                                        <p:selectOneRadio id="alerta" value="#{agendaTrabajo.intervalos}" rendered="#{agendaTrabajo.tipoAviso.alerta}">
                                            <f:selectItem itemLabel="Hora" itemValue="1" />
                                            <f:selectItem itemLabel="Dia" itemValue="2" />
                                            <f:selectItem itemLabel="Mes" itemValue="3" />
                                        </p:selectOneRadio>
                                        <p:spacer width="5"/>
                                        <!--<p:selectOneRadio id="intervalos" value="# {agendaTrabajo.tipoAviso.intervalo}" rendered="#{agendaTrabajo.tipoAviso.alerta}">
                                            <f:selectItem itemLabel="1h" itemValue="1" />
                                            <f:selectItem itemLabel="2h" itemValue="2" />
                                            <f:selectItem itemLabel="1d" itemValue="1" />
                                            <f:selectItem itemLabel="2d" itemValue="2" />
                                            <f:selectItem itemLabel="1m" itemValue="1" />
                                        </p:selectOneRadio>-->
                                        <pe:inputNumber id="intervalos" value="#{agendaTrabajo.tipoAviso.intervalo}" minValue="1" maxlength="3" rendered="#{agendaTrabajo.tipoAviso.alerta}" title="Invervalos"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                            <p:editor id="detalle" value="#{agendaTrabajo.agenda.descripcion}" height="200"/>
                        </p:tab>
                        <p:tab id="tDocsAnexos" title="Correspondencia">
                            <p:fileUpload  fileUploadListener="#{agendaTrabajo.handleFileUpload}" rendered="#{agendaTrabajo.agenda.id == null}"
                                           multiple="true"
                                           mode="advanced"
                                           fileLimit="6"
                                           label="Seleccionar"
                                           cancelLabel="Cancelar"
                                           uploadLabel="Subir"
                                           skinSimple="true"
                                           update="dtDocumentos"
                                           sizeLimit="50000000" 
                                           allowTypes="/(\.|\/)(gif|jpe?g|png|pdf|doc?x|xls?x|dwg|odt)$/"/>
                            <p:dataTable id="dtDocumentos" value="#{agendaTrabajo.files}" rendered="#{agendaTrabajo.agenda.id == null}"
                                         var="req" reflow="true"  emptyMessage="No adjunto ningun documento">
                                <p:column headerText="Documentos" style="width: 75%;">
                                    <h:outputText value="#{req.nombre}" style="text-transform: uppercase;"/>
                                </p:column>
                            </p:dataTable>

                            <dialog:detalleArchivosAct archivos="#{agendaTrabajo.adjuntos}" />
                        </p:tab>
                        <p:tab id="tIntervinientes" title="Intervinientes" rendered="#{agendaTrabajo.agenda.id!=null}">
                            <p:dataTable id="dtInvolucrados" value="#{agendaTrabajo.agenda.agendaDetList}" var="inv" paginator="true" rows="10" reflow="true">
                                <p:column headerText="Involucrado" rendered="#{inv.estado}">
                                    <h:outputText value="#{inv.involucrado.apellidos} #{inv.involucrado.nombres}" style="text-transform: uppercase"/>
                                </p:column>
                                <p:column headerText="Detalle" rendered="#{inv.estado}">
                                    <h:outputText value="#{inv.detalle}" style="text-transform: uppercase"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnGuardar" value="Guardar" style="height: 30px" actionListener="#{agendaTrabajo.agendar()}" update=":frmMain" rendered="#{agendaTrabajo.agenda.id == null}"/>
                        </div>
                    </f:facet>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>