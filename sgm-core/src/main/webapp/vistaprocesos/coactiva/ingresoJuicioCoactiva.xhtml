<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="head">
        <script src="../../resources/pfJs/keyPress.js" type="text/javascript"></script>
        <style type="text/css">
            .ui-datepicker .ui-datepicker-title select {
                font-size: 1em;
                margin: 1px 0;
                color: black;
            }
            .ui-selectoneradio label{
                font-size: 1.2em;
                font-weight: bold;
            }
            .ui-datatable .ui-datatable-scrollable-body .ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td, .ui-datatable tfoot th{
                height : 20px;
                padding: 3px 5px;
            }
        </style>
    </ui:define>
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{inicioCoactiva.doPreRenderView()}"/>
        </f:metadata>
    </ui:define>

    <ui:define name="content">
        <center>
            <h1>Coactivas</h1>
        </center>
        <h:form id="mainForm">
            <center>
                <p:fieldset legend="*Detalle del Juicio*" style="font-size: 14px; font-weight: bold;">
                    <h:panelGrid styleClass="noBorder" columns="8">
                        Nº. Juicio:
                        <p:inputText type="number" value="#{inicioCoactiva.juicio.numeroJuicio}" disabled="#{inicioCoactiva.showTable}"/>
                        Año Juicio:
                        <p:inputText type="number" value="#{inicioCoactiva.juicio.anioJuicio}" disabled="#{inicioCoactiva.showTable}"/>
                        Fecha Juicio:
                        <p:calendar value="#{inicioCoactiva.juicio.fechaJuicio}" pattern="dd/MM/yyyy" maxdate="sysdate" navigator="true" disabled="#{inicioCoactiva.showTable}"/>

                    </h:panelGrid>
                    <br></br>
                    <h:panelGrid styleClass="noBorder" columns="6">
                        Abogado:
                        <p:selectOneMenu value="#{inicioCoactiva.juicio.abogadoJuicio}" converter="entityConverter" disabled="#{inicioCoactiva.showTable}">
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />  
                            <f:selectItems value="#{inicioCoactiva.listAbogados}" var="ab" itemLabel="#{ab.detalle}" itemValue="#{ab}"/>  
                        </p:selectOneMenu>
                        Tipo Juicio:
                        <p:selectOneMenu value="#{inicioCoactiva.estado}" disabled="#{inicioCoactiva.showTable}">
                            <f:selectItem itemLabel="Juicio Nuevo" itemValue="#{1}"/>
                            <f:selectItem itemLabel="Juicio Finalizado" itemValue="#{2}"/>
                        </p:selectOneMenu>
                        Funcionario:
                        <p:selectOneMenu value="#{inicioCoactiva.juicio.usuarioAsignado}" converter="entityConverter" disabled="#{inicioCoactiva.showTable}">
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />  
                            <f:selectItems value="#{inicioCoactiva.users}" var="us" itemLabel="#{us.usuario} - #{us.ente.nombreCompleto}" itemValue="#{us}"/>  
                        </p:selectOneMenu>

                    </h:panelGrid>
                    <br></br>
                    <p:commandButton value="Ingresar Juicio" icon="ui-icon-home" styleClass="btnStyle" actionListener="#{inicioCoactiva.actualizaForm()}" disabled="#{inicioCoactiva.showTable}"/>
                </p:fieldset>
            </center>
            <br></br>
            <h:panelGroup id="groupCoactiva" rendered="#{inicioCoactiva.showTable}" >
                <div align="right">
                    <h:panelGrid styleClass="noBorder" columns="3" style="width: 500px">
                        <h:outputText value="TOTAL DEL JUICIO: $" style="font-weight: bolder;font-size: 15px;"/>
                        <p:outputLabel value="#{inicioCoactiva.totalJuicio}" style="font-weight: bolder;font-size: 15px;"/>
                        <!-- <p:commandButton value="Buscar Predio" icon="ui-icon-home" styleClass="btnStyle" actionListener="# {inicioCoactiva.showDlgPredios()}" style="float: right"/>-->
                    </h:panelGrid>
                </div>
                <br></br>
                <p:selectOneRadio value="#{inicioCoactiva.predioModel.tipoConsultaUrbano}">
                    <f:selectItem itemLabel="MATRICULA INMOBILIARIA" itemValue="1" />
                    <f:selectItem itemLabel="CODIGO PREDIAL" itemValue="3" />
                    <p:ajax update="consulta"/>
                </p:selectOneRadio>
                <p:panel id="consulta">
                    <h:outputText value="MATRICULA INMOBILIARIA" style="font-size: 13px; font-weight: bolder;" rendered="#{inicioCoactiva.predioModel.tipoConsultaUrbano eq 1}"/>
                    <p:spacer width="5"/>
                    <p:inputText value="#{inicioCoactiva.predioModel.numPredio}" style="font-size: 13px; font-weight: bolder;" rendered="#{inicioCoactiva.predioModel.tipoConsultaUrbano eq 1}"/>

                    <p:panelGrid style="width: 100%;" styleClass="ui-responsive" rendered="#{inicioCoactiva.predioModel.tipoConsultaUrbano eq 3}">
                        <p:row styleClass="ui-responsive">
                            <p:column><p:outputLabel value="PROVINCIA " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="CANTON " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="PARROQUIA " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="ZONA " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="SECTOR " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="MANZANA " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="LOTE " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="BLOQUE " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="PISO " style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="UNIDAD " style="font-size: 13px; font-weight: bolder;"/></p:column>
                        </p:row>
                        <p:row styleClass="ui-responsive">
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.provincia}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.canton}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.parroquiaShort}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.zona}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.sector}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.mz}" maxlength="3" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.solar}" maxlength="3" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText>
                            </p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.bloque}" maxlength="2" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText>   </p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.piso}" maxlength="3" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                            <p:column>
                                <p:inputText value="#{inicioCoactiva.predioModel.unidad}" maxlength="3" style="font-size: 13px; font-weight: bolder; width: 90%;">
                                    <pe:keyFilter preventPaste="false" regEx="[0-9]"/>
                                </p:inputText></p:column>
                        </p:row>
                    </p:panelGrid>

                    <!--                        <p:row>
                                                <p:column><p:outputLabel value="URBANIZACION" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                                <p:column><p:outputLabel value="MANZANA" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                                <p:column><p:outputLabel value="SOLAR" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                            </p:row>
                                            <p:row>
                                                <p:column>
                                                    <p:selectOneMenu  value="# {inicioCoactiva.predioModel.ciudadela}" effect="fade" converter="entityConverter"  style="width:300px;">
                                                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                                                        <f:selectItems value="# {inicioCoactiva.ciudadelasEntidad}" var="c" itemLabel="#{c.nombre}" itemValue="#{c}"/>  
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column><p:inputText value="# {inicioCoactiva.predioModel.mzUrb}"/></p:column>
                                                <p:column><p:inputText value="# {inicioCoactiva.predioModel.slUrb}"/></p:column>
                                            </p:row>-->


                    <br/>
                    <center><p:commandButton value="CONSULTAR" actionListener="#{inicioCoactiva.consultarPredioUrbano()}" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-search" iconPos="right" update="mainForm:dtCoactiva"/></center>
                </p:panel>

                <br/>
                <p:dataTable id="dtCoactiva" value="#{inicioCoactiva.impuestos}" var="jui" emptyMessage="Sin elementos..." scrollable="true" scrollHeight="250" style="text-align: center;" rowIndexVar="index">
                    <f:facet name="header">Títulos de Crédito Agregados al Juicio</f:facet>
                    <p:column headerText="No" width="35"><p:outputLabel value="#{index+1}"/></p:column>
                    <p:column headerText="Mat. Inmob." width="150"><p:outputLabel value="#{jui.predio.numPredio}"/></p:column>
                    <p:column headerText="Cod. Predial"><p:outputLabel value="#{jui.predio.codigoPredialCompleto}"/></p:column>
                    <p:column headerText="Año Deuda" width="100"><p:outputLabel value="#{jui.anio}"/></p:column>
                    <p:column headerText="Total Deuda" width="150"><p:outputLabel value="#{jui.totalPago}"/></p:column>
                    <p:column headerText="Estado Pago" width="100"><p:outputLabel value="#{jui.estadoLiquidacion.descripcion}"/></p:column>
                    <!--<p:column headerText="Predio" width="60">
                        <p:commandLink actionListener="# {inicioCoactiva.showDetallePredio(jui.predio)}">
                            <p:graphicImage value="/css/homeIconsImages/detalle.png" height="16"/>   
                        </p:commandLink>
                    </p:column>
                    <p:column headerText="Det/Liq" width="60">
                        <p:commandLink actionListener="# {inicioCoactiva.showDlgDetalleLiquidacion(jui)}">
                            <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                        </p:commandLink>
                    </p:column>-->
                    <p:column headerText="Del." width="50">
                        <p:commandLink actionListener="#{inicioCoactiva.deleteLiquidacion(index)}"><p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/></p:commandLink>
                    </p:column>
                </p:dataTable>
                <p:fieldset legend="Detalle del Juicio Ingreso" style="width: 50%; margin: 0 auto;" rendered="#{inicioCoactiva.guardado}">
                    <p:outputLabel value="CONTROL: " style="font-size: 14px; font-weight: bold;"/><p:outputLabel value="#{inicioCoactiva.ht.id}" style="font-size: 14px; font-weight: bold;"/>
                    <br/>
                    <p:outputLabel value="JUCIO: " style="font-size: 14px; font-weight: bold;"/><p:outputLabel value="#{inicioCoactiva.juicio.numeroJuicio}-#{inicioCoactiva.juicio.anioJuicio}" style="font-size: 14px; font-weight: bold;"/>
                </p:fieldset>
                <br/><div align="center">
                    <p:commandButton value="Adjuntar Documento" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{inicioCoactiva.showDlgDocumento()}" disabled="#{inicioCoactiva.guardado}"/>
                    <p:spacer height="1" width="20"/>
                    <p:commandButton value="Guardar Juicio Coactivo" icon="ui-icon-check" styleClass="btnStyle" actionListener="#{inicioCoactiva.guardarJuicioCoactivo()}" disabled="#{inicioCoactiva.guardado}">
                        <p:confirm header="Confirmacion" message="Desea ingresar el Juicio Coactivo?" icon="ui-icon-alert"/>
                    </p:commandButton>
                    <p:spacer height="1" width="40"/>
                    <p:commandButton value="Nuevo Juicio" icon="ui-icon-plus" styleClass="btnStyle" actionListener="#{inicioCoactiva.redirectIngresoJuicio()}" disabled="#{!inicioCoactiva.guardado}" update="mainForm"/>
                    <p:confirmDialog global="true">
                        <p:commandButton value="SI" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="NO" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </div>
            </h:panelGroup>
        </h:form>


        <p:dialog header="Adjuntar Documento" widgetVar="dlgDocumento" width="500" height="400" modal="true" resizable="false" position="center">
            <h:form id="formDoc">
                <h:panelGrid columns="1" styleClass="noBorder" style="width: 100%;">
                    OBSERVACION:
                    <p:inputTextarea value="#{inicioCoactiva.observacion}" style="width: 100%" rows="4" autoResize="false"/>
                    DOCUMENTOS:
                </h:panelGrid>
                <h:panelGrid columns="1" styleClass="noBorder" style="width: 100%;text-align: center">
                    <p:fileUpload fileUploadListener="#{inicioCoactiva.handleFileUpload}" update="dtDocumentos"
                                  label="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar" multiple="false"
                                  mode="advanced" dragDropSupport="false"  sizeLimit="1000000000"
                                  allowTypes="#{inicioCoactiva.formatoArchivos}" /> 
                    <p:dataList id="dtDocumentos" value="#{inicioCoactiva.files}" var="docs"
                                emptyMessage="Sin documentos..." style="text-align: center">
                        <f:facet name="header">Nombre</f:facet>
                        <p:outputLabel value="#{docs.nombre}"/>
                    </p:dataList>
                    <br/>
                    <p:commandButton value="Aceptar" icon="ui-icon-check" styleClass="btnStyle" oncomplete="PF('dlgDocumento').hide()" actionListener="#{inicioCoactiva.closeDialog}" />
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="Listado de Predios - Seleccione Predio" widgetVar="dlgPrediosConsulta" width="90%" responsive="true" closable="true" closeOnEscape="true" modal="true" height="90%">
            <h:form id="frmPredios">
                <p:dataTable value="#{inicioCoactiva.prediosUrbanosConsulta}" var="p" selection="#{inicioCoactiva.prediosUrbanosConsultaSeleccionados}" rowKey="#{p.id}" style="width: 90%; margin: 0 auto;" reflow="true" paginator="true" rows="15" filterEvent="enter" paginatorPosition="top">
                    <p:column selectionMode="multiple" style="width:30px;text-align:center"/>
                    <p:column headerText="No. Predio" sortBy="#{p.numPredio}" filterBy="#{p.numPredio}" filterMatchMode="exact" filterStyle="width: 95%;"><h:outputText value="#{p.numPredio}"/></p:column>
                    <p:column headerText="Urbanizacion" filterBy="#{p.ciudadela.nombre}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.ciudadela.nombre}"/></p:column>
                    <p:column headerText="Mz" filterBy="#{p.mz}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.mz}"/></p:column>
                    <p:column headerText="Sl" filterBy="#{p.solar}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.solar}"/></p:column>
                    <p:column headerText="Cod. Predial"><h:outputText value="#{p.claveCat}"/></p:column>
                    <f:facet name="footer">
                        <p:commandButton value="Seleccionar" actionListener="#{inicioCoactiva.seleccionarPredio(1)}"/>
                    </f:facet>
                </p:dataTable>         
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>

