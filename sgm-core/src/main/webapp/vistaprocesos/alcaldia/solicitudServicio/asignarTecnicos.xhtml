<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">

    <ui:define name="events">

    </ui:define>

    <ui:define name="content"> T
        <div align="center">
            <h1>Asignar Tecnicos</h1>
        </div>
        <h:form id="frmAsigResl" >
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;">
                <p:outputLabel value="Tarea: #{asignarTecnicos.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="No Trámite: #{asignarTecnicos.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{asignarTecnicos.session.name_user}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
            <p:tabView id="tvDatos">
                <p:tab id="tinf" title="Datos de Solicitud">
                    <p:panelGrid id="formulario" style="width: 100%; margin: 0 auto;" >
                        <p:row>
                            <p:column colspan="2">
                                <p:outputLabel value="Solicitante." style="font-weight: bold;"/>
                            </p:column>
                            <p:column colspan="4">
                                <p:outputLabel value="#{asignarTecnicos.ht.nombrePropietario}" style="font-weight: bold;"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="2">
                                <p:outputLabel value="Tipo de Servicio Solicitado que requiere de la Municipalidad." style="font-weight: bold; font-size: 14px;"/>
                            </p:column>
                            <p:column colspan="4">
                                <p:outputLabel value="Dirección del lugar donde se requiere el servicio." style="font-weight: bold; font-size: 14px;"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="2">
                                <p:outputLabel value="#{asignarTecnicos.solicitud.tipoServicio.nombre}"/>
                            </p:column>

                            <p:column colspan="2">
                                <p:outputLabel value="PARROQUIA : " style="font-weight: bold;"/>
                                <p:outputLabel value="#{asignarTecnicos.solicitud.parroquia.descripcion}"/>
                            </p:column>

                            <p:column colspan="2">
                                <p:outputLabel value="URBANIZACIÓN O SECTOR : " style="font-weight: bold;"/>
                                <p:outputLabel value="#{asignarTecnicos.solicitud.cdla.nombre}"/>
                            </p:column>
                        </p:row>
                        <!--<p:row rendered="# {!asignarTecnicos.audiencia}">
                            <p:column colspan="4">
                                <p:outputLabel value="La dirección del lugar donde se requiere el servicio. Por favor, incluya la dirección exacta y una referencia de cómo llegar al lugar." style="font-weight: bold; font-size: 12px;"/>
                            </p:column>
                            <p:column colspan="2" >
                                <p:outputLabel value="Fecha del Incidente." style="font-weight: bold; font-size: 12px;"/>
                            </p:column>
                        </p:row>
                        <p:row rendered="# {!asignarTecnicos.audiencia}">
                            <p:column colspan="4">
                                <p:inputTextarea value="# {asignarTecnicos.solicitud.direccion}" style="width: 90%;" readonly="true"/>
                            </p:column>
                            <p:column colspan="2">
                                <p:outputLabel value="# {asignarTecnicos.solicitud.fechaInconveniente}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                        </p:row>-->

                        <p:row rendered="#{!asignarTecnicos.audiencia}">
                            <p:column colspan="6">
                                <p:outputLabel value="Descripcion del hecho o incidente que requiere nuestra atención." style="font-weight: bold; font-size: 12px;"/>
                            </p:column>
                        </p:row>
                        <p:row rendered="#{asignarTecnicos.audiencia}">
                            <p:column colspan="6">
                                <p:outputLabel value="Descripcion del motivo de nuestra atención." style="font-weight: bold; font-size: 12px;"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="6">
                                <p:inputTextarea value="#{asignarTecnicos.solicitud.descripcionInconveniente}" style="width: 90%;"  readonly="true"/>
                            </p:column>
                        </p:row>

                    </p:panelGrid>
                </p:tab>

                <!-- Documentos -->
                <p:tab id="tDocumt" title="Documentos">
                    <dialog:detalleArchivosAct archivos="#{asignarTecnicos.processInstanceAllAttachmentsFiles}" />
                </p:tab>
                <!-- Observaciones -->
                <p:tab id="tObserv" title="Observaciones">
                    <h2>Listado de Observaciones</h2>
                    <p:dataTable id="dtObserv" value="#{asignarTecnicos.ht.observacionesCollection}" var="obs" reflow="true" emptyMessage="No se encontro ninguna Observación">
                        <p:column headerText="Observacion" style="width: 60%">
                            <h:outputText value="#{obs.observacion}" style="text-transform: uppercase; font-size: 10px;"/>
                        </p:column>
                        <p:column headerText="Responsable" style="width: 18%; text-align: center; font-size: 10px;">
                            <h:outputText value="#{obs.userCre}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Tarea" style="width: 25%; text-align: center; font-size: 10px;">
                            <h:outputText value="#{obs.tarea}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Fecha" style="width: 20%; text-align: center; font-size: 10px;">
                            <p:outputLabel value="#{obs.fecCre}" style="text-transform: uppercase"/>
                        </p:column>
                    </p:dataTable>
                </p:tab>
                <!--Direcciones Involucradas-->
                <p:tab title="Direcciones Involucradas">
                    <p:dataTable value="#{asignarTecnicos.solicitud.svSolicitudDepartamentoCollection}" var="direccion" reflow="true" >
                        <p:column headerText="Dirección">
                            <h:outputText value="#{direccion.departamento.nombre}"/>
                        </p:column>
                        <p:column headerText="Acción" style="width: 25%">
                            <p:outputLabel value="#{direccion.accion eq 1?'ATENDIDA':''}" style="font-weight: bolder;"/>
                            <p:outputLabel value="#{direccion.accion eq 2?'DELEGADA':''}" style="font-weight: bolder;"/>
                            <p:outputLabel value="#{direccion.accion eq 3?'RECHAZADA':''}" style="font-weight: bolder;"/>
                            <p:outputLabel value="#{direccion.accion eq 4?'REENVIADA':''}" style="font-weight: bolder;"/>
                            <p:outputLabel value="#{direccion.accion eq null?'SIN REALIZAR':''}" style="font-weight: bolder;"/>
                        </p:column>
                        <p:column headerText="Estado" style="width: 25%">
                            <p:outputLabel value="#{direccion.fechaFinalizado eq null?'PENDIENTE':'FINALIZADO -'}" style="font-weight: bolder;"/>
                            <p:outputLabel value="#{direccion.fechaFinalizado}" style="font-weight: bolder;">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                            </p:outputLabel>
                        </p:column>
                    </p:dataTable>



                </p:tab>
            </p:tabView>

            <dialog:prediosSolicitud predio="#{asignarTecnicos.catPredioList}" />
            <br/><br/>
            <center>
                <p:commandButton value="RESOLVER" actionListener="#{asignarTecnicos.mostarObs(1)}" style="font-weight: bold; height: 30px;" icon="ui-icon-check" styleClass="btnStyle" iconPos="right"/>
                <p:spacer width="10"/>
                <p:commandButton value="DELEGAR" actionListener="#{asignarTecnicos.mostarObs(2)}" style="font-weight: bold; height: 30px;" icon="ui-icon-person" styleClass="btnStyle" iconPos="right"/>
                <p:spacer width="10"/>
                <!-- <p:commandButton value="RECHAZAR" actionListener="# {asignarTecnicos.mostarObs(3)}" style="font-weight: bold; height: 30px;" icon="ui-icon-close" styleClass="btnStyle" iconPos="right" rendered="# {asignarTecnicos.detalleDepartamento.padre eq null}"/> -->
                <p:commandButton value="REENVIAR" actionListener="#{asignarTecnicos.mostarObs(4)}" style="font-weight: bold; height: 30px;" icon="ui-icon-arrowrefresh-1-w" styleClass="btnStyle" iconPos="right" rendered="#{asignarTecnicos.detalleDepartamento.padre eq null}"/>
            </center>
            <br/><br/>
        </h:form>

        <p:dialog id="dlgObs" widgetVar="obs" header="#{asignarTecnicos.taskDataByTaskID.name}" appendTo="@(body)" modal="true" width="750" height="100%" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObsCor">
                <h2>#{asignarTecnicos.titleObs}</h2>
                <h:panelGroup rendered="#{asignarTecnicos.opcion eq 1}">

                    <p:outputLabel value="Detalle informe Solicitud" style="font-weight: bold;"/><br/>
                    <p:inputTextarea value="#{asignarTecnicos.detalleDepartamento.informe}" placeholder="Ingrese una descripcion sobre la atencion de la solicitud." style="width: 90%;"/>
                    <p:panelGrid  columns="2" styleClass="noBorder" style="width: 100%;">
                        <p:row>
                            <p:column>
                                <p:outputLabel value="ADJUNTAR DOCUMENTO/INFORME?" style="font-weight: bold;"/>
                            </p:column>
                            <p:column>
                                <p:selectBooleanCheckbox value="#{asignarTecnicos.detalleDepartamento.archivo}" label="SI/NO">
                                    <p:ajax update="dtFiles"/>
                                </p:selectBooleanCheckbox>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/><br/>
                    <p:panel id="dtFiles" styleClass="noBorder">
                        <p:dataTable id="dtInformes" value="#{asignarTecnicos.files}" var="f" rendered="#{asignarTecnicos.detalleDepartamento.archivo}" emptyMessage="No hay documentos adjuntos">
                            <f:facet name="header">
                                Documentos Cargados.
                                <p:commandLink id="btnAgrPla" value="Adjuntar Documento" onclick="PF('dlgDocPl').show()" shape="poly" style="color: #0066cc; font-weight: bold; float: right; "/>
                            </f:facet>
                            <p:column headerText="Nombre Archivo" style="text-align: center;">
                                <h:outputLabel value="#{f.nombre}"/>
                            </p:column>
                            <p:column headerText="Tipo" style="text-align: center; width: 25%;">
                                <h:outputLabel value="#{f.tipo}"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </h:panelGroup>
                <h:panelGroup rendered="#{asignarTecnicos.opcion eq 2}">
                    <center>
                        <p:outputLabel value="Detalle el requerimiento para el delegado" style="font-weight: bold;"/><br/>
                        <p:inputTextarea value="#{asignarTecnicos.detalleDepartamento.comunicado}" placeholder="Ingrese una descripcion sobre la atencion de la solicitud." style="width: 95%;"/>
                    </center>

                    <p:panelGrid  columns="2" styleClass="noBorder" style="width: 100%;">
                        <p:row>
                            <p:column>
                                <p:outputLabel value="ADJUNTAR DOCUMENTO/INFORME?" style="font-weight: bold;"/><br/><br/>
                                <center>
                                    <p:outputLabel value="Delegado debe cargar un documento si esta seleccionada la opción"/>    
                                </center>

                            </p:column>
                            <p:column>
                                <center>
                                    <p:selectBooleanCheckbox value="#{asignarTecnicos.detalleDepartamento.archivo}" label="SI/NO"/>
                                </center>
                            </p:column>
                        </p:row>

                    </p:panelGrid>
                    <br/>
                    <p:outputLabel value="SELECCIONE EL USUARIO AL CUAL DELEGA LA ATENCION DE LA SOLICITUD" style="font-weight: bold; border-spacing: 15px 50px; color: #005f9c"/>
                    <br/>
                    <p:selectOneMenu id="usuariosDepDel" value="#{asignarTecnicos.user}" effect="fade" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                        <f:selectItems value="#{asignarTecnicos.listUsuarios}" var="usuario" itemLabel="#{usuario.usuario}-#{usuario.ente.apellidos}#{usuario.ente.nombres}" itemValue="#{usuario}"/>
                    </p:selectOneMenu>
                    <p:spacer width="20"/>
                    <p:commandLink value="ASIGNAR" actionListener="#{asignarTecnicos.agregarUsuario()}" update="usuarioAsig, usuariosDepDel" style="color: blue; font-weight: bold;" title="Click para agregar."/>
                    <br/>
                    <h:panelGrid id="usuarioAsig" columns="2" style="width: 100%;" cellspacing="2" cellpadding="10">
                        <p:outputLabel value="NOMBRES" style="font-weight: bold;"/>
                        <p:outputLabel value="#{asignarTecnicos.user.ente.apellidos} #{asignarTecnicos.user.ente.nombres}"/>                    

                        <p:commandButton value="LIMPIAR" actionListener="#{asignarTecnicos.limpiarUsuario()}" update="usuarioAsig" style="font-weight: bold; float: left;" icon="ui-icon-scissors" styleClass="btnStyle" iconPos="right"/>
                    </h:panelGrid>
                </h:panelGroup>
                <h:panelGroup rendered="#{asignarTecnicos.opcion eq 2}">
                   <br/>
                    <p:outputLabel value="SELECCIONE LA SECRETARIA PARA ASIGNAR LA FECHA" style="font-weight: bold; border-spacing: 15px 50px; color: #005f9c"/>
                    <br/>
                    <p:selectOneMenu id="usuariosDepDelSecretaria" value="#{asignarTecnicos.userSecretaria}" effect="fade" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                        <f:selectItems value="#{asignarTecnicos.listUsuariosSecretariaPlanificacion}" var="usuario" itemLabel="#{usuario.usuario}-#{usuario.ente.apellidos}#{usuario.ente.nombres}" itemValue="#{usuario}"/>
                    </p:selectOneMenu>
                    <p:spacer width="20"/>
                    <p:commandLink value="ASIGNAR" actionListener="#{asignarTecnicos.agregarUsuarioSecretaria()}" update="usuarioAsigSecretaria, usuariosDepDelSecretaria" style="color: blue; font-weight: bold;" title="Click para agregar."/>
                    <br/>
                    <h:panelGrid id="usuarioAsigSecretaria" columns="2" style="width: 100%;" cellspacing="2" cellpadding="10">
                        <p:outputLabel value="NOMBRES" style="font-weight: bold;"/>
                        <p:outputLabel value="#{asignarTecnicos.userSecretaria.ente.apellidos} #{asignarTecnicos.user.ente.nombres}"/>                    

                        <p:commandButton value="LIMPIAR" actionListener="#{asignarTecnicos.limpiarUsuarioSecretaria()}" update="usuarioAsigSecretaria" style="font-weight: bold; float: left;" icon="ui-icon-scissors" styleClass="btnStyle" iconPos="right"/>
                    </h:panelGrid>
                </h:panelGroup>

                <h:panelGroup rendered="#{asignarTecnicos.opcion eq 3}">
                    <p:outputLabel value="Detalle el motivo del rechazo" style="font-weight: bold;"/><br/>
                    <p:inputTextarea value="#{asignarTecnicos.detalleDepartamento.informe}" placeholder="Ingrese el motivo del rechazo de la solicitud." style="width: 100%;"/>
                </h:panelGroup>

                <p:panel rendered="#{asignarTecnicos.opcion eq 4}">
                    <p:outputLabel value="Motivo del reenvio" style="font-weight: bold;"/><br/>
                    <p:inputTextarea value="#{asignarTecnicos.detalleDepartamento.informe}" placeholder="Ingrese el motivo del reenvio de la solicitud." style="width: 100%;"/>
                    <h:panelGrid id="pngAsgDep" columns="3" style="width: 70%;">
                        <p:outputLabel value="DEPARTAMENTO"/>
                        <p:outputLabel value="USUARIO"/>
                        <p:outputLabel value="ACCION"/>

                        <p:selectOneMenu value="#{asignarTecnicos.departamento}" effect="fade" converter="entityConverter">
                            <f:attribute name="name" value="GeDepartamento"/>
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                            <f:selectItems value="#{asignarTecnicos.departamentos}" var="dep" itemLabel="#{dep.nombre}" itemValue="#{dep}"/>
                            <p:ajax  listener="#{asignarTecnicos.cargarUsuariosDepartamento()}" update="usuariosDep"/>
                        </p:selectOneMenu>
                        <p:selectOneMenu id="usuariosDep" value="#{asignarTecnicos.user}" effect="fade" converter="entityConverter">>
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                            <f:selectItems value="#{asignarTecnicos.usuariosDeparta}" var="usuario" itemLabel="#{usuario.usuario}-#{usuario.ente.apellidos}#{usuario.ente.nombres}" itemValue="#{usuario}"/>
                        </p:selectOneMenu>
                        <p:commandButton value="Agregar" actionListener="#{asignarTecnicos.agregarUsuarioDep()}" update="usuariosNotificacion, pngAsgDep" styleClass="btnStyle" icon="ui-icon-circle-plus"/>
                    </h:panelGrid>

                    <p:dataTable id="usuariosNotificacion" value="#{asignarTecnicos.reasignarDeparta}" var="user" emptyMessage="No se ha seleccionado usuarios." style="width: 90%; margin: 0 auto;">
                        <f:facet name="header">
                            Usuarios para la Audiencia.
                        </f:facet>
                        <p:column headerText="Departamento">
                            #{user.departamento.nombre}
                        </p:column>
                        <p:column headerText="Nombre">
                            #{user.usuario.ente.apellidos} #{user.usuario.ente.nombres}
                        </p:column>
                        <p:column headerText="Accion">
                            <p:commandLink value="eliminar" actionListener="#{asignarTecnicos.eliminarUsuario(user)}" update="usuariosNotificacion"/>
                        </p:column>
                    </p:dataTable>                        
                </p:panel>
                <br/>
                <center>
                    <p:commandButton id="btnCompletar" value="Continuar" actionListener="#{asignarTecnicos.completarTarea()}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-check" iconPos="right" />
                    <p:spacer width="10"/>
                    <p:commandButton id="btnSubir" value="Cancelar" onclick="PF('obs').hide()" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-close" iconPos="right" />
                </center>
                <br/><br/>
            </h:form>
            <br/>
        </p:dialog>

        <p:dialog widgetVar="dlgDocPl" modal="true">
            <h:form>
                <p:fileUpload  fileUploadListener="#{asignarTecnicos.handleFileUpload}" multiple="true" mode="advanced" label="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar"
                               skinSimple="true" sizeLimit="1000000000" update="frmObsCor" allowTypes="#{asignarTecnicos.tipoArchivos}" oncomplete="PF('dlgDocPl').hide()"/>

                <div align="center">
                    <p:commandButton id="AgrPla" value="Aceptar" onclick="PF('dlgDocPl').hide()" style="height: 30px; " styleClass="btnStyle"/>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>

