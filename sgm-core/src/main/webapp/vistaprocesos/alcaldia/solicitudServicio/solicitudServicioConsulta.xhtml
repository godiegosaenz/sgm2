<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">




    <ui:define name="content">
        <div align="center">
            <h1>SOLICITUDES SERVICIOS INGRESADAS</h1>
        </div>
        <h:form id="formSolServCon">
            <p:dataTable id="dtSolicitudes" value="#{solicitudServicioConsulta.solicitudServiciosLazy}" var="solicitud" emptyMessage="No existen datos"
                         paginator="true" lazy="true" filterEvent="enter"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rows="10" rowsPerPageTemplate="10,15,20" rowStyleClass="#{solicitudServicioConsulta.colorRow(solicitud.tramite.estado)}">
                <p:column headerText="Nº Trámite" filterBy="#{solicitud.tramite.id}" style="width: 100px; text-align: center;" filterStyle="width: 90%; ">
                    <h:outputText value="#{solicitud.tramite.id}"/>
                </p:column>
                <p:column headerText="Fecha" style="width: 120px; text-align: center;">
                    <h:outputText value="#{solicitud.fechaCreacion}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Solicitante" width="200">
                    <h:outputText value="#{solicitud.tramite.nombrePropietario}"/>
                </p:column>
                <p:column headerText="Descripcion" filterBy="#{solicitud.descripcionInconveniente}" sortBy="#{solicitud.descripcionInconveniente}" filterStyle="width: 90%">
                    <h:outputText value="#{solicitud.descripcionInconveniente}"/>
                </p:column>
                <p:column headerText="Direcciones(s)" width="150">
                    <p:dataList value="#{solicitudServicioConsulta.getDireccionesActivas(solicitud)}" var="dep" type="ordered" emptyMessage="Sin Asignación">
                        <p:outputLabel value="#{dep.departamento.nombre}"/>
                    </p:dataList>
                </p:column>
                <p:column headerText="Informe">
                    <h:outputText value="#{solicitud.informe}"/>
                </p:column>
                <p:column headerText="Estado" width="70" style="text-align: center;">
                    <h:outputText value="#{solicitud.tramite.estado}"/>
                </p:column>
                <p:column headerText="Opciones" width="80" style="text-align: center;">
                    <p:commandLink actionListener="#{solicitudServicioConsulta.imprimirTicket(solicitud)}" title="#{solicitud.tramite.id} - Imprimir Ticket">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16" width="16"/>
                    </p:commandLink>
                    <p:spacer width="2" />
                    <p:commandLink actionListener="#{solicitudServicioConsulta.imprimirInforme(solicitud)}" title="#{solicitud.tramite.id} - Imprimir Guia">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16" width="16"/>
                    </p:commandLink>
                    <p:spacer width="2" />
                    <p:commandLink actionListener="#{solicitudServicioConsulta.ver(solicitud)}" title="#{solicitud.tramite.id} - Ver Detalle">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16" width="16"/>
                    </p:commandLink>
                    <p:spacer width="2" />
                    <p:commandLink actionListener="#{solicitudServicioConsulta.openDlgEdit(solicitud)}" title="#{solicitud.tramite.id} - Editar">
                        <p:graphicImage value="/css/homeIconsImages/edit.png" height="20" width="16"/>   
                    </p:commandLink>
                </p:column>
                <!--<p:column headerText="Ingresar" width="5%" style="text-align: center;" rendered="# {userSession.roles.contains(9)}">
                    <p:commandLink actionListener="# {solicitudServicioConsulta.reingreso(solicitud)}" disabled="# {solicitud.tramite.idProceso ne null}">
                        <p:graphicImage value="/css/homeIconsImages/ir.png" height="16"/>
                    </p:commandLink>
                </p:column>-->
            </p:dataTable>
        </h:form>


        <p:dialog appendTo="@(body)" widgetVar="info" closeOnEscape="true" fitViewport="true" header="Informaci&#243;n" modal="true" id="dlgInfo" responsive="true" height="500" width="75%" resizable="false">
            <h:form id="frmInfo">
                <p:tabView dynamic="true" >
                    <p:tab title="Informaci&#243;n" titletip="">
                        <p:panelGrid columns="2" styleClass="noBorder" style="width: 100%;">
                            <p:outputLabel value="Solicitante: " style="font-weight: bolder;"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.hist.nombrePropietario}"/>

                            <p:outputLabel value="Remitente " style="font-weight: bolder;" rendered="#{solicitudServicioConsulta.solicitud.representante ne null}"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.representante}" rendered="#{solicitudServicioConsulta.solicitud.representante ne null}"/>

                            <p:outputLabel value="Estado Tr&#225;mite: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.hist.estado}"/>

                            <p:outputLabel value="Tipo Servicio: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.tipoServicio.nombre}"/>

                            <p:outputLabel value="Lugar Audiencia: " style="font-weight: bolder" rendered="#{solicitudServicioConsulta.audiencia}"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.lugarAudiencia.nombre}" rendered="#{solicitudServicioConsulta.audiencia}"/>

                            <p:outputLabel value="Parroquia: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.parroquia.descripcion}"/>

                            <p:outputLabel value="Ciudadela: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.cdla.nombre}"/>

                            <p:outputLabel value="Descrici&#243;n Inconveniente: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudServicioConsulta.solicitud.descripcionInconveniente}"/>
                        </p:panelGrid>

                    </p:tab >
                    <p:tab title="Observaciones">
                        <p:dataTable value="#{solicitudServicioConsulta.hist.observacionesCollection}" var="sInfo" scrollable="true" paginator="true" paginatorPosition="top" scrollHeight="300"  >
                            <p:column headerText="Usuario" width="15%">
                                <p:outputLabel value="#{sInfo.userCre}"/>
                            </p:column>
                            <p:column headerText="Tarea"  width="30%">
                                <p:outputLabel value="#{sInfo.tarea}"/>
                            </p:column>
                            <p:column headerText="Observaciones">
                                <p:outputLabel value="#{sInfo.observacion}" rendered="#{!sInfo.tarea.startsWith('Documento')}"/>
                                <p:panelGrid styleClass="noBorder" columns="4" rendered="#{sInfo.tarea.startsWith('Documento') and !userSession.roles.contains(99)}">
                                    <p:outputLabel value="VER:"/>
                                    <p:commandLink actionListener="#{solicitudServicioConsulta.showDocuments(sInfo.observacion, 'pdf')}">
                                        <p:graphicImage value="/css/homeIconsImages/buscar.png" height="20"/>
                                    </p:commandLink>
                                    <p:outputLabel value="DESCARGAR:"/>
                                    <p:commandLink actionListener="#{solicitudServicioConsulta.descargarDocumento(sInfo.observacion)}">
                                        <p:graphicImage value="/css/homeIconsImages/down.png"/>
                                    </p:commandLink>
                                </p:panelGrid>
                            </p:column>
                            <p:column headerText="Fecha" width="18%">
                                <p:outputLabel value="#{sInfo.fecCre}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Tareas">
                        <p:dataTable value="#{solicitudServicioConsulta.task}" var="task" scrollable="true" paginator="true" paginatorPosition="top" scrollRows="8" scrollHeight="270" rows="5">
                            <p:column headerText="Tarea" width="50%">
                                <p:outputLabel value="#{task.name}"/>
                            </p:column>
                            <p:column headerText="Asignado a" >
                                <p:outputLabel value="#{task.assignee}" rendered="#{task.assignee ne null}"/>
                                <p:dataList value="#{solicitudServicioConsulta.getAssignee(task.id)}" var="asig" type="ordered" emptyMessage="Sin Asignación" rendered="#{task.assignee eq null}" >
                                    #{asig.userId}
                                </p:dataList>
                            </p:column>
                            <p:column headerText="Inicio" width="15%">
                                <p:outputLabel value="#{task.startTime}" >
                                    <f:convertDateTime pattern="dd/MM/YYYY"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Fin" width="15%">
                                <p:outputLabel value="#{task.endTime}">
                                    <f:convertDateTime pattern="dd/MM/YYYY"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Documentos" rendered="#{!userSession.roles.contains(99)}">
                        <dialog:detalleArchivosAct archivos="#{solicitudServicioConsulta.documentos}" />
                    </p:tab>
                    <p:tab title="Direcciones">
                        <p:dataTable value="#{solicitudServicioConsulta.solicitud.svSolicitudDepartamentoCollection}" var="depart" scrollable="true" paginator="true" paginatorPosition="top" scrollRows="8" scrollHeight="270" rows="5">
                            <p:column headerText="Dirección">
                                <p:outputLabel value="#{depart.departamento.nombre}"/>
                            </p:column>
                            <p:column headerText="Director" >
                                <p:outputLabel value="#{depart.director.ente.apellidos}#{depart.director.ente.nombres}"/>
                            </p:column>
                            <p:column headerText="Acción - Fecha" >
                                <p:outputLabel value="#{depart.accion eq 1?'ATENDIDA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 2?'DELEGADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 3?'RECHAZADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 4?'REENVIADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq null?'SIN REALIZAR':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.fechaAccion}" style="font-weight: bolder;">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Comunicado" >
                                <p:outputLabel value="#{depart.comunicado}"/>
                            </p:column>
                            <p:column headerText="Responsable">
                                <p:outputLabel value="#{depart.responsable.ente.apellidos}#{depart.responsable.ente.nombres}"/>
                            </p:column>
                            <p:column headerText="Informe" >
                                <p:outputLabel value="#{depart.informe}"/>
                            </p:column>
                            <p:column headerText="Estado" >
                                <p:outputLabel value="#{depart.fechaFinalizado eq null?'PENDIENTE':'FINALIZADO - '}"/>
                                <p:outputLabel value="#{depart.fechaFinalizado}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
                <br/>
                <center>
                    <p:commandButton value="Aceptar" actionListener="#{solicitudServicioConsulta.aceptar()}" styleClass="btnStyle"/>
                </center>

            </h:form>
        </p:dialog>

        <p:dialog appendTo="@(body)" widgetVar="dlgEdit" closeOnEscape="true" fitViewport="true" header="Edición Datos Solicitud" modal="true" responsive="true" width="60%" resizable="false">
            <h:form id="formEdit">
                <br/>
                <p:outputLabel value="Tramite: " style="font-size: 14px; font-weight: bold;"/>
                <p:outputLabel value="#{solicitudServicioConsulta.solicitud.tramite.id}" style="font-size: 14px; font-weight: bold;"/>
                <p:spacer width="25"/>
                <p:outputLabel value="Fecha: " style="font-size: 14px; font-weight: bold;"/>
                <p:outputLabel value="#{solicitudServicioConsulta.solicitud.tramite.fecha}" style="font-size: 14px; font-weight: bold;">
                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                </p:outputLabel>
                <br/><br/>
                <p:outputLabel value="Solicitante: " style="font-size: 13px; font-weight: bold;"/><br/>
                <p:outputLabel value="CI/RUC: " style="font-size: 12px; font-weight: bold;"/>
                <p:inputText value="#{solicitudServicioConsulta.solicitud.tramite.solicitante.ciRuc}" readonly="true"/>
                <p:spacer width="25"/>
                <p:outputLabel value="Solicitante: " style="font-size: 12px; font-weight: bold;"/>
                <p:inputText value="#{solicitudServicioConsulta.solicitud.tramite.solicitante.apellidos}" rendered="#{solicitudServicioConsulta.solicitud.tramite.solicitante.esPersona}" placeholder="Apellidos" title="Apellidos"/>
                <p:inputText value="#{solicitudServicioConsulta.solicitud.tramite.solicitante.nombres}" rendered="#{solicitudServicioConsulta.solicitud.tramite.solicitante.esPersona}" placeholder="Nombres" title="Nombres"/>
                <p:inputText value="#{solicitudServicioConsulta.solicitud.tramite.solicitante.razonSocial}" rendered="#{!solicitudServicioConsulta.solicitud.tramite.solicitante.esPersona}" size="50" placeholder="Razón Social" title="Razón Social"/>
                <br/>
                <p:outputLabel value="OPCIONES" style="font-size: 12px; font-weight: bold;"/>
                <!--<p:commandButton value="Editar Datos" actionListener="# {solicitudServicioConsulta.cargarSolicitante(solicitudServicioConsulta.solicitud.tramite.solicitante)}" styleClass="btnStyle" oncomplete="PF('dlgEditSolicitante').show();" update="formEditSolicitante"/>
                <p:spacer width="25"/>-->
                <p:commandButton value="Cambiar Solicitante" styleClass="btnStyle" oncomplete="PF('dlgCambioSolicitante').show();" update="formCambioSolicitante"/>
                <br/><br/>
                <p:outputLabel value="Descripción Solicitud: " style="font-size: 13px; font-weight: bold;"/><br/>
                <p:inputTextarea value="#{solicitudServicioConsulta.solicitud.descripcionInconveniente}" style="width: 100%;"/>
                <br/>
                <center>
                    <p:commandButton value="Editar" styleClass="btnStyle" actionListener="#{solicitudServicioConsulta.editarSolicitud()}" oncomplete="PF('dlgEdit').hide();" update="formSolServCon">
                        <p:confirm header="Confirmacion" message="Guardar Datos?" icon="ui-icon-alert" />
                    </p:commandButton>
                    <p:spacer width="20"/>
                    <p:commandButton value="Cancelar" styleClass="btnStyle" oncomplete="PF('dlgEdit').hide();"/>
                </center>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>
            </h:form>
        </p:dialog>

        <p:dialog appendTo="@(body)" widgetVar="dlgEditSolicitante" closeOnEscape="true" fitViewport="true" header="Edición Datos Solicitante" modal="true" responsive="true" width="35%" resizable="false">
            <h:form id="formEditSolicitante">
                <p:panelGrid style="width: 100%;" styleClass="noBorder">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="CI/RUC: " style="font-size: 12px; font-weight: bold;"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{solicitudServicioConsulta.solicitante.ciRuc}" readonly="true"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Solicitante: " style="font-size: 12px; font-weight: bold;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Nombres: " rendered="#{solicitudServicioConsulta.solicitante.esPersona}"/> 
                            <p:inputText value="#{solicitudServicioConsulta.solicitante.nombres}" rendered="#{solicitudServicioConsulta.solicitante.esPersona}"/>
                            <p:outputLabel value="Apellidos: " rendered="#{solicitudServicioConsulta.solicitante.esPersona}"/> 
                            <p:inputText value="#{solicitudServicioConsulta.solicitante.apellidos}" rendered="#{solicitudServicioConsulta.solicitante.esPersona}"/>
                            <p:outputLabel value="Razón Social: " rendered="#{!solicitudServicioConsulta.solicitante.esPersona}"/>
                            <p:inputText value="#{solicitudServicioConsulta.solicitante.razonSocial}" rendered="#{!solicitudServicioConsulta.solicitante.esPersona}" size="50"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog appendTo="@(body)" widgetVar="dlgCambioSolicitante" closeOnEscape="true" fitViewport="true" header="Cambiar Solicitante" modal="true" responsive="true" width="35%" resizable="false">
            <h:form id="formCambioSolicitante">
                <p:dataTable id="dtSolicitante" var="s" value="#{solicitudServicioConsulta.solicitantes}" style="width: 100%" lazy="true" reflow="true" paginator="true" rows="10" selectionMode="single" selection="#{solicitudServicioConsulta.solicitud.tramite.solicitante}" rowKey="#{s.id}">
                    <f:facet name="header">Seleccione el solicitante respectivo</f:facet>
                    <p:column headerText="No. Identificacion" sortBy="#{s.ciRuc}" filterBy="#{s.ciRuc}" filterMatchMode="contains">
                        <h:outputText value="#{s.ciRuc}"/>
                    </p:column>
                    <p:column headerText="Descripcion" rendered="#{s.esPersona}" filterBy="#{s.apellidos} #{s.nombres}" sortBy="#{s.apellidos}" filterMatchMode="contains">
                        <h:outputText value="#{s.apellidos} #{s.nombres}" rendered="#{s.esPersona}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Descripcion" rendered="#{!s.esPersona}" filterBy="#{s.razonSocial}" sortBy="#{s.razonSocial}"  filterMatchMode="contains">
                        <h:outputText value="#{s.razonSocial}" rendered="#{!s.esPersona}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Direccion">
                        <h:outputText value="#{s.direccion}"/>
                    </p:column>
                    <f:facet name="footer">
                        <p:commandButton id="btnSeleccionar" value="Seleccionar"  style="height: 30px;" oncomplete="PF('dlgCambioSolicitante').hide()" update="formEdit"/>
                    </f:facet>
                </p:dataTable> 
            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>
