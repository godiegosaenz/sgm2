<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">

    <ui:define name="events">

    </ui:define>

    <ui:define name="top">
        <h1>SOLICITUD DE SERVICIOS POR DIRECCIONES</h1>
    </ui:define>

    <ui:define name="content">
        <h:form id="formSolDep">
            <p:panelGrid styleClass="noBorder" style="width: 80%; margin: 0 auto;">
                <p:row>
                    <p:column>
                        <p:selectOneRadio value="#{solicitudDepartamentos.estado}" styleClass="noBorder" layout="pageDirection">  
                            <f:selectItem itemLabel="TODAS" itemValue="todas"/>
                            <f:selectItem itemLabel="PENDIENTES" itemValue="pendientes"/>
                        </p:selectOneRadio>
                    </p:column>
                    <p:column>
                        <p:outputLabel value="Desde:"/>
                    </p:column>
                    <p:column>
                        <p:calendar value="#{solicitudDepartamentos.fechaDesde}" pattern="dd/MM/yyy"  />
                    </p:column>
                    <p:column>
                        <p:outputLabel value="Hasta:"/>
                    </p:column>
                    <p:column>
                        <p:calendar value="#{solicitudDepartamentos.fechaHasta}" pattern="dd/MM/yyy"  />
                    </p:column>
                    <p:column>
                        <p:commandButton value="Actualizar" actionListener="#{solicitudDepartamentos.actualizar()}" styleClass="btnStyle" icon="ui-icon-refresh" iconPos="s" update="dtSolicitudes"/>
                    </p:column>
                </p:row>
            </p:panelGrid>
            <br/><br/>
            <p:dataTable id="dtSolicitudes" value="#{solicitudDepartamentos.solicitudes}" var="solicitud" emptyMessage="No existen datos"
                         paginator="true"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} "
                         rows="5" rowsPerPageTemplate="5,10,15">
                <p:column headerText="Nº Trámite" filterBy="#{solicitud.tramite}" sortBy="#{solicitud.tramite}" width="10%" style="text-align: center;">
                    <h:outputText value="#{solicitud.tramite.id}"/>
                </p:column>
                <p:column headerText="Fecha" style="width: 120px; text-align: center;">
                    <h:outputText value="#{solicitud.fechaCreacion}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Solicitante" >
                    <h:outputText value="#{solicitud.enteSolicitante.apellidos} #{solicitud.enteSolicitante.nombres}" rendered="#{solicitud.enteSolicitante.esPersona}"/>
                    <h:outputText value="#{solicitud.enteSolicitante.razonSocial}" rendered="#{!solicitud.enteSolicitante.esPersona}"/>
                </p:column>
                <p:column headerText="TIPO">
                    <h:outputText value="#{solicitud.tipoServicio.nombre}"/>
                </p:column>
                <p:column headerText="Descripcion" filterBy="#{solicitud.descripcionInconveniente}" sortBy="#{solicitud.descripcionInconveniente}" filterStyle="width: 90%">
                    <h:outputText value="#{solicitud.descripcionInconveniente}"/>
                </p:column>
                <p:column headerText="Informe">
                    <h:outputText value="#{solicitud.informe}"/>
                </p:column>
                <p:column headerText="Estado" width="10%" style="text-align: center;" sortBy="#{solicitud.tramite.estado}">
                    <h:outputText value="#{solicitud.tramite.estado}"/>
                </p:column>
                <p:column headerText="Ver" width="10%" style="text-align: center;">
                    <p:commandLink actionListener="#{solicitudDepartamentos.ver(solicitud)}" >
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>
        <p:dialog appendTo="@(body)" widgetVar="info" closeOnEscape="true" fitViewport="true" header="Informaci&#243;n" modal="true" id="dlgInfo" responsive="true" height="500" width="75%" resizable="false">
            <h:form id="frmInfo">
                <p:tabView dynamic="true" >
                    <p:tab title="Informaci&#243;n" titletip="">
                        <p:panelGrid columns="2" styleClass="noBorder" style="width: 100%;">
                            <p:outputLabel value="Solicitante: " style="font-weight: bolder;"/>
                            <p:outputLabel value="#{solicitudDepartamentos.hist.nombrePropietario}"/>

                            <p:outputLabel value="Remitente " style="font-weight: bolder;" rendered="#{solicitudDepartamentos.solicitud.representante ne null}"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.representante}" rendered="#{solicitudDepartamentos.solicitud.representante ne null}"/>

                            <p:outputLabel value="Estado Tr&#225;mite: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudDepartamentos.hist.estado}"/>

                            <p:outputLabel value="Tipo Servicio: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.tipoServicio.nombre}"/>

                            <p:outputLabel value="Lugar Audiencia: " style="font-weight: bolder" rendered="#{solicitudDepartamentos.audiencia}"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.lugarAudiencia.nombre}" rendered="#{solicitudDepartamentos.audiencia}"/>

                            <p:outputLabel value="Parroquia: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.parroquia.descripcion}"/>

                            <p:outputLabel value="Ciudadela: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.cdla.nombre}"/>

                            <p:outputLabel value="Descrici&#243;n Inconveniente: " style="font-weight: bolder"/>
                            <p:outputLabel value="#{solicitudDepartamentos.solicitud.descripcionInconveniente}"/>
                        </p:panelGrid>

                    </p:tab >
                    <p:tab title="Observaciones">
                        <p:dataTable value="#{solicitudDepartamentos.hist.observacionesCollection}" var="sInfo" scrollable="true" paginator="true" paginatorPosition="top" scrollHeight="300"  >
                            <p:column headerText="Usuario" width="15%">
                                <p:outputLabel value="#{sInfo.userCre}"/>
                            </p:column>
                            <p:column headerText="Tarea"  width="30%">
                                <p:outputLabel value="#{sInfo.tarea}"/>
                            </p:column>
                            <p:column headerText="Observaciones">
                                <p:outputLabel value="#{sInfo.observacion}"/>
                            </p:column>
                            <p:column headerText="Fecha" width="18%">
                                <p:outputLabel value="#{sInfo.fecCre}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Tareas">
                        <p:dataTable value="#{solicitudDepartamentos.task}" var="task" scrollable="true" paginator="true" paginatorPosition="top" scrollRows="8" scrollHeight="270" rows="5">
                            <p:column headerText="Tarea" width="50%">
                                <p:outputLabel value="#{task.name}"/>
                            </p:column>
                            <p:column headerText="Asignado a" >
                                <p:outputLabel value="#{task.assignee}" rendered="#{task.assignee ne null}"/>
                                <p:dataList value="#{solicitudDepartamentos.getAssignee(task.id)}" var="asig" type="ordered" emptyMessage="Sin Asignación" rendered="#{task.assignee eq null}" >
                                    #{asig.userId}
                                </p:dataList>
                            </p:column>
                            <p:column headerText="Inicio" width="15%">
                                <p:outputLabel value="#{task.startTime}" >
                                    <f:convertDateTime pattern="dd/MM/YYYY"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Fin" width="15%">
                                <p:outputLabel value="#{task.endTime}">
                                    <f:convertDateTime pattern="dd/MM/YYYY"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Documentos">
                        <dialog:detalleArchivosAct archivos="#{solicitudDepartamentos.documentos}" />
                    </p:tab>
                    <p:tab title="Direcciones">
                        <p:dataTable value="#{solicitudDepartamentos.solicitud.svSolicitudDepartamentoCollection}" var="depart" scrollable="true" paginator="true" paginatorPosition="top" scrollRows="8" scrollHeight="270" rows="5">
                            <p:column headerText="Dirección">
                                <p:outputLabel value="#{depart.departamento.nombre}"/>
                            </p:column>
                            <p:column headerText="Director" >
                                <p:outputLabel value="#{depart.director.ente.apellidos}#{depart.director.ente.nombres}"/>
                            </p:column>
                            <p:column headerText="Acción - Fecha" >
                                <p:outputLabel value="#{depart.accion eq 1?'ATENDIDA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 2?'DELEGADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 3?'RECHAZADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq 4?'REENVIADA -':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.accion eq null?'SIN REALIZAR':''}" style="font-weight: bolder;"/>
                                <p:outputLabel value="#{depart.fechaAccion}" style="font-weight: bolder;">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Comunicado" >
                                <p:outputLabel value="#{depart.comunicado}"/>
                            </p:column>
                            <p:column headerText="Responsable">
                                <p:outputLabel value="#{depart.responsable.ente.apellidos}#{depart.responsable.ente.nombres}"/>
                            </p:column>
                            <p:column headerText="Informe" >
                                <p:outputLabel value="#{depart.informe}"/>
                            </p:column>
                            <p:column headerText="Estado" >
                                <p:outputLabel value="#{depart.fechaFinalizado eq null?'PENDIENTE':'FINALIZADO - '}"/>
                                <p:outputLabel value="#{depart.fechaFinalizado}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
                <br/>
                <center>
                    <p:commandButton value="Aceptar" styleClass="btnStyle" oncomplete="PF('info').show();"/>
                </center>

            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>


