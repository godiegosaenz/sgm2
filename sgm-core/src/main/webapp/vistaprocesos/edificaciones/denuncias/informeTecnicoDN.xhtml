<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:poue="http://primefaces.org/ui/extensions"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">

   
    <ui:define name="page_title">
        Multas
    </ui:define>

    <ui:define name="top" >
        <h:panelGroup rendered="#{multasView.ht.id != null}">
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;" >
                <p:outputLabel value="Trámite: #{multasView.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Tarea: #{multasView.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{multasView.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
        </h:panelGroup>
    </ui:define>

    <ui:define name="content">
        <h:form id="frmMain">
            <p:tabView id="tvSolicitud">
                <p:tab title="Informe tecnico">
                    
                    <p:panel id="panel1">
                        <p:dataTable id="dtDocumentosFF" value="#{informeTecnicoDN.archivos}" 
                                var="archivo" emptyMessage="No se ha subido ningún archivo.">
                            <p:column headerText="Nombre" width="50%">
                               #{archivo.nombre}
                           </p:column>
                            <p:column headerText="Tipo" width="25%">
                               #{archivo.tipo}
                           </p:column>
                           <p:column headerText="Acción" width="25%">
                               <center>
                                <p:commandButton value="Eliminar" update="dtDocumentosFF" actionListener="#{informeTecnicoDN.eliminarArchivo(archivo)}"/>
                               </center>
                           </p:column>
                       </p:dataTable>
                        <p:fileUpload fileUploadListener="#{informeTecnicoDN.handleFileUploadJS}" mode="advanced" dragDropSupport="false"
                                        label="Seleccion"
                                        uploadLabel="Subir"
                                        cancelLabel="Cancelar"
                                        update="messages1" 
                                        multiple="true" sizeLimit="35000000" fileLimit="3" allowTypes="/(\.|\/)(gif|jpe?g|png|pdf|doc|docx)$/" />
                        <p:growl id="messages1" showDetail="true"/>
                    </p:panel>
                    <center style="margin-top: 10px;">
                        <p:commandButton value="Guardar Documentos" style="height: 30px;" styleClass="btnStyle" actionListener="#{informeTecnicoDN.mostrarObservaciones(true)}" icon="ui-icon-check"/>
                        <p:commandButton value="Cancelar" style="height: 30px;" styleClass="btnStyle" actionListener="#{informeTecnicoDN.mostrarObservaciones(false)}" icon="ui-icon-close"/>
                    </center>
                </p:tab>
                
                <p:tab id="tobs" title="Observaciones">
                    <p:panel id="pobs" header="Listado de Observaciones" style="width: 100%">
                        <p:dataTable id="dtObs" value="#{informeTecnicoDN.ht.observacionesCollection}" var="obs" reflow="true" style="width: 100%">
                            <p:column headerText="Observacion" style="width: 60%">
                                <h:outputText value="#{obs.observacion}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Responsable" style="width: 25%">
                                <h:outputText value="#{obs.userCre}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Tarea" style="width: 25%">
                                <h:outputText value="#{obs.tarea}" style="text-transform: uppercase"/>
                            </p:column>
                            <p:column headerText="Fecha" style="width: 15%">
                                <h:outputText value="#{obs.fecCre}" style="text-transform: uppercase"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </p:tab>
                
            </p:tabView>
        </h:form>
        
        <!-- -->
        
        <p:dialog id="dlgObs" widgetVar="obs" header="#{informeTecnicoDN.ht.tipoTramiteNombre}" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs" target="_blank">
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">
                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{informeTecnicoDN.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                        <br/>
                        <p:commandButton id="btnValidar" value="Validar Requisitos" actionListener="#{informeTecnicoDN.completarTarea()}" oncomplete="PF('obs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>
        
        <!-- -->
        
        <p:dialog id="dlgNuevoCliente" header="Ingreso de Cliente" widgetVar="dlgNewClient" modal="true" resizable="false" closeOnEscape="false" position="center">
            <h:form  id="formNewClient">
                <p:panelGrid styleClass="noBorder" style="width: 100%">
                    <p:row>
                        <p:column style="text-align: right"><p:outputLabel value="Tipo Persona:" style="font-weight: bolder"/></p:column>
                        <p:column>
                            <p:selectOneMenu value="#{informeTecnicoDN.tipoEnte}" style="width: 160px;">
                                <f:selectItem itemLabel="Natural" itemValue="1" />
                                <f:selectItem itemLabel="Jurídica" itemValue="2" />
                                <p:ajax update="tabNewEnte"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:tabView id="tabNewEnte" style="width: 520px;height: 400px">
                    <p:tab title="Datos Principales">
                        <p:panelGrid styleClass="noBorder" style="width: 100%">
                            <p:row>
                                <p:column colspan="4">
                                    <p:outputLabel value="NOTA: CAMPOS OBLIGATORIOS (*)" style="font-weight: bolder;color: #0033FF"/>
                                </p:column>
                            </p:row>
                            <p:row >
                                <p:column colspan="4">
                                    <p:selectBooleanCheckbox value="#{informeTecnicoDN.excepcionalEmpresa}" itemLabel="EXCEPCIONALES JURIDICO:" style="float: left; font-weight: bold; font-size: 12px;">
                                        <p:ajax update="tabNewEnte" process="@this"/>
                                    </p:selectBooleanCheckbox>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{informeTecnicoDN.tipoEnte==1?'(*)Cédula:':informeTecnicoDN.tipoEnte==2?'(*)R.U.C.:':informeTecnicoDN.tipoEnte==3?'(*)Identificación:':''}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:inputText value="#{informeTecnicoDN.demandado.ciRuc}" rendered="#{informeTecnicoDN.tipoEnte==1 or informeTecnicoDN.tipoEnte==2}">
                                        <p:ajax event="blur" listener="#{informeTecnicoDN.existeCedula()}" update="formNewClient"/>
                                    </p:inputText>
                                    <p:inputText readonly="true" value="Lo asigna el sistema" disabled="#{informeTecnicoDN.tipoEnte==3}" rendered="#{informeTecnicoDN.tipoEnte==3}"/>
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="Fec. Nacimiento:" rendered="#{informeTecnicoDN.tipoEnte==1 or managedEnte.tipoEnte==3}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Fec. Constitución:" rendered="#{informeTecnicoDN.tipoEnte==2}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:calendar value="#{informeTecnicoDN.demandado.fechaNacimiento}" placeholder="DÍA-MES-AÑO" maxdate="sysdate" pattern="dd-MM-yyyy" mask="true" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Nombres:" rendered="#{informeTecnicoDN.tipoEnte==1 or (informeTecnicoDN.tipoEnte==3 and !informeTecnicoDN.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="(*)Razón Social:" rendered="#{informeTecnicoDN.tipoEnte==2 or (informeTecnicoDN.tipoEnte==3 and informeTecnicoDN.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{informeTecnicoDN.demandado.nombres}" rendered="#{informeTecnicoDN.tipoEnte==1 or (informeTecnicoDN.tipoEnte==3 and !informeTecnicoDN.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{informeTecnicoDN.demandado.razonSocial}" rendered="#{informeTecnicoDN.tipoEnte==2 or (informeTecnicoDN.tipoEnte==3 and informeTecnicoDN.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Apellidos:" rendered="#{informeTecnicoDN.tipoEnte==1 or (informeTecnicoDN.tipoEnte==3 and !informeTecnicoDN.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Nombre Comercial:" rendered="#{informeTecnicoDN.tipoEnte==2 or (informeTecnicoDN.tipoEnte==3 and informeTecnicoDN.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{informeTecnicoDN.demandado.apellidos}" rendered="#{informeTecnicoDN.tipoEnte==1 or (informeTecnicoDN.tipoEnte==3 and !informeTecnicoDN.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{informeTecnicoDN.demandado.nombreComercial}" rendered="#{informeTecnicoDN.tipoEnte==2 or (informeTecnicoDN.tipoEnte==3 and informeTecnicoDN.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Dirección:" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{informeTecnicoDN.demandado.direccion}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:tab>
                </p:tabView>
                <div align="center">
                    <p:commandButton value="Guardar" icon="ui-icon-disk" update="frmMain" actionListener="#{informeTecnicoDN.guardarEnte()}"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>