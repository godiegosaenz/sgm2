<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="content">
        <h:form id="frmMain">
            <p:panel id="pRequisitos" header="Fusion de Predios: Seleccion de requisitos" style="width: 100%" toggleable="true">
                <center>
                    <p:panelGrid columns="3" style="width: 50%; border: 0">
                        <h:outputText value="No. Identificacion" style="text-align: right; font-weight: bold"/>
                        <p:inputText value="#{requisitosFP.cedulaRuc}" style="text-align: center; width: 100%"/>
                        <p:commandButton update="frmMain" actionListener="#{requisitosFP.buscarEnte()}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" />
                    </p:panelGrid>
                </center>
                <center>
                    <p:panel id="pSoliticante" header="Datos del Solicitante " style="width: 50%" rendered="#{requisitosFP.userValido}">
                        <p:panelGrid columns="2" layout="grid" style="width: 100%">
                            <h:outputText value="No. Identificacion:" style="font-weight: bolder;"/>
                            <h:outputText value="#{requisitosFP.solicitante.ciRuc}" style="text-transform: uppercase;"/>
                            <h:outputText value=" Razon Social:" rendered="#{!requisitosFP.solicitante.esPersona}" style="font-weight: bolder;"/>
                            <h:outputText value="#{requisitosFP.solicitante.nombreComercial}" rendered="#{!requisitosFP.solicitante.esPersona}" style="text-transform: uppercase;"/>
                            <h:outputText value=" Nombres:" rendered="#{requisitosFP.solicitante.esPersona}" style="font-weight: bolder;"/>
                            <h:outputText value="#{requisitosFP.solicitante.nombres} #{requisitosFP.solicitante.apellidos}" rendered="#{requisitosFP.solicitante.esPersona}" style="text-transform: uppercase;"/>
                        </p:panelGrid>
                        <p:panelGrid columns="2" style="width: 100%">
                            <p:outputLabel value="Urbanización: " style="font-size: 12px; font-weight: bold"/>
                            <p:selectOneMenu value="#{requisitosFP.ciudadela}" converter="entityConverter" panelStyle="font-size: 12px" style="font-size: 12px;" >  
                                <f:attribute name="name" value="CatCiudadela" />
                                <f:selectItem itemLabel="Seleccione una Urbanizacion" itemValue="#{null}"/>  
                                <f:selectItems value="#{requisitosFP.ciudadelas}" var="cd" itemLabel="#{cd.nombre}" itemValue="#{cd}" />
                            </p:selectOneMenu>
                            <p:outputLabel value=" Manzana: " style="font-size: 12px; font-weight: bold" />
                            <p:inputText value="#{requisitosFP.mzUrb}" />

                            <p:outputLabel value=" Solar: " style="font-size: 12px; font-weight: bold"/>
                            <p:inputText value="#{requisitosFP.solarUrb}"/>
                        </p:panelGrid>
                    </p:panel>
                </center>
                <div align="center">
                    <p:commandButton id="btnMostrarPred" value="Buscar Predios" style="height: 30px" actionListener="#{requisitosFP.buscarPredios()}" oncomplete="PF('selPredio').show()" update=":formPredSel" rendered="#{requisitosFP.solicitante!=null}"/>
                </div>
                <br/>
                <p:panel id="pDatosTramite" header="Datos del tramite" style="width: 100%" toggleable="true" rendered="#{requisitosFP.tpredios}">
                    <p:dataTable  id="dataLisPredios"  value="#{requisitosFP.predios}" var="itemPr" emptyMessage="No tiene datos" style="width: 100%;" reflow="true" rendered="#{requisitosFP.predios.size()>1}"
                                  selection="#{requisitosFP.seleccionados}" rowKey="#{itemPr.id}" paginator="true" rows="10" rowsPerPageTemplate="15,50,100" paginatorPosition="top"
                                  paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header">Seleccione los predios de referencia, para poder listar los requisitos</f:facet>
                        <p:column selectionMode="multiple" style="width: 5%; text-align: center"/>
                        <p:column headerText="Código Predial" style="width: 20%">
                            <h:outputText value="#{itemPr.sector}.#{itemPr.mz}.#{itemPr.cdla}.#{itemPr.mzdiv}.#{itemPr.solar}.#{itemPr.div1}.#{itemPr.div2}.
                                          #{itemPr.div3}.#{itemPr.div4}.#{itemPr.div5}.#{itemPr.div6}.#{itemPr.div7}.#{itemPr.div8}.#{itemPr.div9}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="Código Urbanistico" style="width: 20%">
                            <h:outputText value="#{itemPr.sector}-#{itemPr.urbMz}-#{itemPr.mzdiv}-#{itemPr.urbSolarnew}-#{itemPr.div1}-#{itemPr.div2}-#{itemPr.div3}-#{itemPr.div4}-#{itemPr.div5}
                                              -#{itemPr.div6}-#{itemPr.div7}-#{itemPr.div8}-#{itemPr.div9}-#{itemPr.phv}-#{itemPr.phh}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="No. Predio" style="width: 20%">
                            <h:outputText value="#{itemPr.numPredio}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="Ciudadela" style="width: 30%">
                            <h:outputText value="#{itemPr.ciudadela.nombre}" style="text-align: center"/>
                        </p:column>
                        <f:facet name="footer">
                            <p:commandButton id="btnVer" icon="ui-icon-search" value="Listar requistos" actionListener="#{requisitosFP.mostrarReq()}" update="frmMain"/>
                        </f:facet>
                    </p:dataTable>
                    <br/>
                    <p:dataTable  id="dtSeleccionados"  value="#{requisitosFP.seleccionados}" var="sel" emptyMessage="No tiene datos" style="width: 100%;" reflow="true" rendered="#{requisitosFP.seleccionados!=null and requisitosFP.seleccionados.size()>1}"
                                  paginator="true" rows="10" rowsPerPageTemplate="15,50,100" paginatorPosition="top"
                                  paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header">Predios seleccionados</f:facet>
                        <p:column headerText="Código Predial" style="width: 20%">
                            <h:outputText value="#{sel.sector}.#{sel.mz}.#{sel.cdla}.#{sel.mzdiv}.#{sel.solar}.#{sel.div1}.#{sel.div2}.
                                          #{sel.div3}.#{sel.div4}.#{sel.div5}.#{sel.div6}.#{sel.div7}.#{sel.div8}.#{sel.div9}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="Código Urbanistico" style="width: 20%">
                            <h:outputText value="#{sel.sector}-#{sel.urbMz}-#{sel.mzdiv}-#{sel.urbSolarnew}-#{sel.div1}-#{sel.div2}-#{sel.div3}-#{sel.div4}-#{sel.div5}
                                              -#{sel.div6}-#{sel.div7}-#{sel.div8}-#{sel.div9}-#{sel.phv}-#{sel.phh}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="No. Predio" style="width: 20%">
                            <h:outputText value="#{sel.numPredio}" style="text-align: center"/>
                        </p:column>
                        <p:column headerText="Ciudadela" style="width: 20%">
                            <h:outputText value="#{sel.ciudadela.nombre}" style="text-align: center"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:dataTable id="dtrequisitos" value="#{requisitosFP.requisitos}" rendered="#{requisitosFP.mostrarRequisitos}"
                                 var="req" reflow="true"  emptyMessage="No se encontró ningun Requisito">
                        <f:facet name="header">Listado de Requisitos: #{requisitosFP.tramite.descripcion}</f:facet>
                        <p:column headerText="Requisito" style="width: 75%;">
                            <h:outputText value="#{req.nombre}" style="text-transform: uppercase;"/>
                        </p:column>
                        <p:column headerText="Presentar Documento">
                            <center>
                                <p:inputText value="#{validarRequisito.entrada}"  rendered="#{req.tieneComprobante}" />
                                <p:fileUpload  rendered="#{!req.tieneComprobante}" fileUploadListener="#{requisitosFP.handleFileUpload}"
                                               multiple="trye"
                                               mode="advanced"
                                               fileLimit="4"
                                               label="Seleccionar"
                                               uploadLabel="Subir"
                                               cancelLabel="Cancelar"
                                               skinSimple="true"
                                               sizeLimit="35000000" 
                                               allowTypes="/(\.|\/)(gif|jpe?g|png|doc|docx|xls|xlsx|pdf)$/"/>
                                <p:growl id="messages" showDetail="true"/>
                            </center>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <center><p:commandButton value="Validar archivos" onclick="PF('dlgObs').show()" update=":frmObs" rendered="#{requisitosFP.mostrarRequisitos}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/></center>
                </p:panel>
            </p:panel>
        </h:form>
        <p:dialog id="dlgObs" widgetVar="dlgObs" header="#{requisitosFP.tramite.descripcion}" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs">
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">
                    <p:commandButton value="Observación Default" icon="ui-icon-plus" styleClass="btnStyle" update="obsservacion" actionListener="#{requisitosFP.observacionDefault()}" process="@this"/>
                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{requisitosFP.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                        <br/>
                        <p:commandButton id="btnValidar" value="Continuar" actionListener="#{requisitosFP.iniciarProceso()}" oncomplete="PF('dlgObs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgPropietarios" widgetVar="dlgPropietarios" header="Listado de personas" modal="true" appendTo="@(body)" closable="true" closeOnEscape="true" width="60%">
            <h:form id="frmPropietarios">
                <p:dataTable id="dtProps" reflow="true" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="20,50,100" paginatorPosition="top"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             value="#{requisitosFP.entesLazy}" var="user" emptyMessage="No se encontró ningún Item"
                             selection="#{requisitosFP.solicitante}" rowKey="#{user.id}">
                    <f:facet name="header">
                        <div align="right">
                            <p:commandButton id="btnNuevoProp" value="Nuevo" oncomplete="PF('dlgPropietarios').hide()" actionListener="#{requisitosFP.redirecNuevoEnte()}"/>
                        </div>
                    </f:facet>
                    <p:column selectionMode="single" width="50" style="text-align: center"/>
                    <p:column headerText="C.I./R.U.C." style="text-align: center;width: 20%" filterBy="#{user.ciRuc}" filterStyle="width: 80%;">
                        <h:outputText value="#{user.ciRuc}" style="text-align: center; font-size: 12px"/>
                    </p:column>
                    <p:column headerText="Nombres" style="text-align: center" filterBy="#{user.nombres}" filterStyle="width: 80%;">
                        <h:outputText value="#{user.nombres}"/>
                    </p:column>
                    <p:column headerText="Apellidos" style="text-align: center" filterBy="#{user.apellidos}" filterStyle="width: 80%;">`
                        <h:outputText value="#{user.apellidos}"/>
                    </p:column>
                    <p:column headerText="Razón Social" style="text-align: center" filterBy="#{user.razonSocial}" filterStyle="width: 80%;">
                        <h:outputText value="#{user.razonSocial}"/>
                    </p:column>    
                    <p:column headerText="Nombre Comercial" style="text-align: center" filterBy="#{user.nombreComercial}" filterStyle="width: 80%;">
                        <h:outputText value="#{user.nombreComercial}"/>
                    </p:column>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnSeleccionarProps" value="Seleccionar" actionListener="#{requisitosFP.seleccionar()}" oncomplete="PF('dlgPropietarios').hide()" update=":frmMain" style="height: 30px"/>
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>
        <p:dialog header="Seleccione Predio" widgetVar="selPredio" modal="true" appendTo="@(body)" resizable="false" width="85%" height="80%">
            <h:form id="formPredSel">
                <center>
                    <p:selectOneRadio id="optconsult" value="#{requisitosFP.codUrban}" layout="custom">
                        <f:selectItem itemLabel="Código Urbanistico" itemValue="#{true}" />
                        <f:selectItem itemLabel="Código Predial" itemValue="#{false}" />
                        <p:ajax update="formPredSel" event="change"/>
                    </p:selectOneRadio>
                    <h:panelGrid columns="4" style="margin: 0 auto">
                        <p:radioButton id="opt1" for="optconsult" itemIndex="0"/>
                        <h:outputLabel for="opt1" value="Código Urbanistico" />
                        <p:radioButton id="opt2" for="optconsult" itemIndex="1"/>
                        <h:outputLabel for="opt2" value="Código Predial" />
                    </h:panelGrid>
                </center>
                <p:dataTable id="dtSelPred" paginator="true" lazy="true" style="text-align: center; font-size: 11px;" scrollHeight="400" scrollable="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rows="15" rowsPerPageTemplate="15,50,100" value="#{requisitosFP.lpredios}" var="pl" selection="#{requisitosFP.seleccionados}" rowKey="#{pl.id}"
                             emptyMessage="No se encontró ningun predio">
                    <p:column selectionMode="multiple" style="text-align: center" width="50"/>
                    <p:column headerText="Núm. Predio" filterBy="#{pl.numPredio}" sortBy="#{pl.numPredio}" filterStyle="width: 40px" style="width: 100px;">
                        <p:outputLabel value="#{pl.numPredio}"/>
                    </p:column>
                    <p:column headerText="Sector" rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.sector}" sortBy="#{pl.sector}" filterStyle="width: 30px" style="width: 80px;">
                        <p:outputLabel value="#{pl.sector}"/>
                    </p:column>
                    <p:column headerText="Mz." rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.mz}" sortBy="#{pl.mz}" filterStyle="width: 30px" style="width: 60px;">
                        <p:outputLabel value="#{pl.mz}"/>
                    </p:column>
                    <p:column headerText="Cdla." rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.cdla}" sortBy="#{pl.cdla}" filterStyle="width: 30px" style="width: 70px;">
                        <p:outputLabel value="#{pl.cdla}"/>
                    </p:column>
                    <p:column headerText="Mz. Div." rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.mzdiv}" sortBy="#{pl.mzdiv}" filterStyle="width: 30px" style="width: 80px;">
                        <p:outputLabel value="#{pl.mzdiv}"/>
                    </p:column>
                    <p:column headerText="Solar" rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.solar}" sortBy="#{pl.solar}" filterStyle="width: 30px" style="width: 70px;">
                        <p:outputLabel value="#{pl.solar}"/>
                    </p:column>
                    <p:column headerText="Div. 1" rendered="#{!requisitosFP.codUrban}" filterBy="#{pl.div1}" sortBy="#{pl.div1}" filterStyle="width: 30px" style="width: 130px;">
                        <p:outputLabel value="#{pl.div1},#{pl.div2},#{pl.div3},#{pl.div4},#{pl.div5},#{pl.div6},#{pl.div7},#{pl.div8},#{pl.div9},#{pl.phv},#{pl.phh}"/>
                    </p:column>
                    <p:column style="width: 260px;" headerText="Urbanización" filterBy="#{pl.ciudadela.nombre}" rendered="#{requisitosFP.codUrban}" filterOptions="#{fichaIngresoNuevo.lisUrbanizaciones}" filterMatchMode="exact" >
                        <p:outputLabel value="#{pl.ciudadela.nombre}"/>
                    </p:column>
                    <p:column style="width: 70px;" headerText="Mz.Urb." rendered="#{requisitosFP.codUrban}" filterBy="#{pl.urbMz}" sortBy="#{pl.urbMz}" filterStyle="width: 40px">
                        <p:outputLabel value="#{pl.urbMz}"/>
                    </p:column>
                    <p:column style="width: 80px;" headerText="Sl. Urb" rendered="#{requisitosFP.codUrban}" filterBy="#{pl.urbSolarnew}" sortBy="#{pl.urbSolarnew}" filterStyle="width: 40px">
                        <p:outputLabel value="#{pl.urbSolarnew}"/>
                    </p:column>
                    <p:column headerText="Nombre Propietario" filterBy="#{pl.nomCompPago}" filterStyle="width: 300px">
                        <p:outputLabel value="#{pl.nomCompPago}"/>
                    </p:column>
                    <p:column headerText="Dirección" rendered="#{!requisitosFP.codUrban}" style="width: 80px;" >
                        <p:outputLabel value="Mz. #{pl.urbMz} Sl. #{pl.urbSolarnew}"/>
                    </p:column>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnSelectPred" value="Seleccionar" actionListener="#{requisitosFP.mostrarReq()}" style="height: 30px" update="frmMain" oncomplete="PF('selPredio').hide()"/>
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>