<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="metadata">
        
    </ui:define>
    <ui:define name="content">
        <h:form id="frmMain">

            <p:panelGrid id="pnlDP" columns="1" style="width: 100%;">
                <p:panel header="Buscar Usuario" style="width: 100%;">
                    <center>
                        <p:panelGrid columns="2" >
                            <p:panelGrid columns="2" >
                                <h:outputText value="Tipo de Otros Permisos" style="display: block;"/>
                                <p:selectOneMenu value="#{requisitosOT.tramite}"  style="font-size: 12px; width: 220px;" converter="entityConverter">  
                                    <f:selectItem itemLabel="Seleccione un Elemento..." itemValue="#{null}" />  
                                    <f:selectItems value="#{requisitosOT.tramites}"  var="rpc" itemLabel="#{rpc.tipoTramite}" itemValue="#{rpc}" />
                                    <p:ajax update="frmMain" />
                                </p:selectOneMenu>
                            </p:panelGrid>
                            <p:panelGrid columns="3" >
                                <h:outputText value="Número de Cédula" style="display: block;"/>
                                <p:inputText value="#{requisitosOT.cedulaRuc}" style="display: block; margin: 0 auto;" disabled="#{requisitosOT.tramite==null}"/>
                                <p:commandButton update="frmMain" actionListener="#{requisitosOT.buscarEnte()}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" disabled="#{requisitosOT.tramite==null}"/>
                            </p:panelGrid>
                        </p:panelGrid>
                        
                    </center>
                    <p:panelGrid columns="2" style="width: 100%; height: auto;" id="panelList" rendered="#{requisitosOT.userValido}">
                        <p:panel header="Usuario Encontrado" style="width: 100%;">
                            <center>
                                <p:dataTable  id="dataListEnte"  value="#{requisitosOT.enteList}" var="itemP"
                                                emptyMessage="No tiene datos" style="width: 440px;">
                                    <p:column headerText="#C.I. o R.U.C.">
                                        <h:outputText value="#{itemP.ciRuc}" style="text-transform: uppercase;"/>
                                    </p:column>
                                    <p:column headerText="Nombres">
                                        <h:outputText value="#{itemP.nombreComercial}" rendered="#{!itemP.esPersona}" style="text-transform: uppercase;"/>
                                        <h:outputText value="#{itemP.nombres} #{itemP.apellidos}" rendered="#{itemP.esPersona}" style="text-transform: uppercase;"/>
                                    </p:column>
                                </p:dataTable>
                            </center>
                            <p:commandButton value="Editar datos de persona" icon="ui-icon-pencil" actionListener="#{requisitosOT.setPersonaEdit()}" style="height: 30px;" styleClass="btnStyle" update="formSolicitante" onclick="PF('dlgSolInf').show()"/>
                        </p:panel>
                        <p:panel header="Predios del Usuario" style="width: 100%;" rendered="#{requisitosOT.tramite.necesitaPredio}">
                            <center>
                                <p:dataTable  id="dataLisPredios"  value="#{requisitosOT.predioList}" var="itemPr"
                                                emptyMessage="No tiene datos" style="width: 440px;" rows="5" paginator="true" paginatorPosition="top">
                                    <p:column headerText="Código Predial">
                                        <center>
                                            <h:outputText value="#{itemPr.sector}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.mz}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.cdla}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.mzdiv}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.solar}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div1}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div2}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div3}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div4}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div5}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div6}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div7}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div8}." style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemPr.div9}" style="text-transform: uppercase;"/>
                                        </center>
                                    </p:column>
                                    <p:column headerText="Acción">
                                        <center><p:commandButton actionListener="#{requisitosOT.setearYMostrarRequisitos(itemPr)}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" update="frmMain" value="Seleccionar"/></center>
                                    </p:column>
                                </p:dataTable>
                            </center>
                            <p:commandButton value="Buscar Predio" onclick="PF('selPredio').show()" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-search" />
                        </p:panel>
                        <h:panelGrid columns="6"  cellspacing="20"  >
                            <p:outputLabel value="Urbanización: " style="font-size: 15px; font-weight: bold"/>
                            <p:selectOneMenu value="#{requisitosOT.ciudadela}" converter="entityConverter" panelStyle="font-size: 12px" style="font-size: 12px; width: 200px;" >  
                                <f:attribute name="name" value="CatCiudadela" />
                                <f:selectItem itemLabel="Seleccione un Elemento..." itemValue="#{null}"/>  
                                <f:selectItems value="#{requisitosOT.ciudadelas}" var="cd" itemLabel="#{cd.nombre}" itemValue="#{cd}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Manzana: " style="font-size: 15px; font-weight: bold" onblur=""/>
                            <p:inputText value="#{requisitosOT.mzUrb}" />

                            <p:outputLabel value="Solar: " style="font-size: 15px; font-weight: bold"/>
                            <p:inputText value="#{requisitosOT.solarUrb}"/>
                        </h:panelGrid>
                    </p:panelGrid>
                </p:panel>
                <p:panel id="panelRequisitos" header="Listado de Requisitos: #{requisitosOT.tp.descripcion} - Código Predial: #{requisitosOT.codigoPredial}" style="width: 100%;" rendered="#{requisitosOT.userValido}">
                    <p:dataTable value="#{requisitosOT.requisitos}" 
                                 var="req" reflow="true"
                                 emptyMessage="No se encontró ningun Requisito" 
                                 style="font-size: 12px;">

                        <p:column headerText="Requisito" style="width: 75%;">
                            <h:outputText value="#{req.nombre}" style="text-transform: uppercase;"/>
                        </p:column>

                        <p:column headerText="Presentar Documento">
                            <center>
                                <p:inputText value="#{validarRequisito.agregarEntrada()}"  rendered="#{req.tieneComprobante}" />
                                <p:fileUpload  rendered="#{!req.tieneComprobante}" fileUploadListener="#{requisitosOT.handleFileUpload}"
                                               multiple="false"
                                               mode="advanced"
                                               fileLimit="1"
                                               uploadLabel="Subir" cancelLabel="Cancelar"
                                               label="Seleccionar"
                                               skinSimple="true"
                                               update="messages"
                                               sizeLimit="35000000" 
                                               allowTypes="/(\.|\/)(gif|jpe?g|png|pdf)$/"/>

                                <p:growl id="messages" showDetail="true"/>
                            </center>
                        </p:column>

                    </p:dataTable>
                    <br/>
                    <center><p:commandButton styleClass="btnStyle" value="Validar archivos" actionListener="#{requisitosOT.validar()}" /></center>
                </p:panel>

            </p:panelGrid>
        </h:form>
        
        <p:dialog id="dlgObs" widgetVar="obs" header="#{requisitosOT.tp.descripcion}" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs" target="_blank">
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">
                    <p:commandButton value="Observación Default" icon="ui-icon-plus" styleClass="btnStyle" update="obsservacion" actionListener="#{requisitosOT.observacionDefault()}" process="@this"/>
                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{requisitosOT.obs.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                        <br/>
                        <p:commandButton id="btnValidar" value="Validar Requisitos" actionListener="#{requisitosOT.iniciarProceso()}" oncomplete="PF('obs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>
        
        <p:dialog id="dlgSolicitante" header="Datos de Solicitante" widgetVar="dlgSolInf" resizable="false" modal="true" 
                  position="center" closable="false">
            <h:form id="formSolicitante">
                <p:panelGrid styleClass="noBorder" style="width: 400px">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Cédula:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{requisitosOT.persona.ciRuc}" readonly="true"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Nombres:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{requisitosOT.persona.nombres}" style="width: 100%"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Apellidos:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{requisitosOT.persona.apellidos}" style="width: 100%"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Dirección :"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{requisitosOT.persona.direccion}" style="width: 100%"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:commandLink value="SI CLIENTE NO POSEE CORREO DE CLIC AQUI." style="font-weight: bolder;color: #0033FF"
                                           actionListener="#{requisitosOT.agregarCorreoGenerico()}" update="dtEmailPer"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Email:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="labelEmail" value="#{requisitosOT.emailNew}" size="35" placeholder="Ejemplo: correo@ejemplo.com"/>
                            <p:spacer width="15" height="1"/>
                            <p:commandButton value="Agregar" icon="ui-icon-plus" update="dtEmailPer,labelEmail"
                                             actionListener="#{requisitosOT.agregarEmail()}" />
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:dataTable id="dtEmailPer" value="#{requisitosOT.persona.enteCorreoCollection}" var="mail" scrollable="true" scrollHeight="80">
                                <p:column headerText="Email" style="text-align: center">
                                    <p:outputLabel value="#{mail.email}"/>
                                </p:column>
                                <p:column headerText="Acción" style="text-align: center" width="60">
                                    <p:commandLink value="Eliminar" actionListener="#{requisitosOT.eliminarEmail(mail)}" 
                                                   update="dtEmailPer" style="color: #0033FF;font-weight: bolder"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Teléfono:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="labelTelef" value="#{requisitosOT.tlfnNew}" size="35" placeholder="Ejemplo: 045555555 ó 0988888888"/>
                            <p:spacer width="20" height="1"/>
                            <p:commandButton value="Agregar" actionListener="#{requisitosOT.agregarTlfn()}" 
                                             update="dtTelefPer,labelTelef" icon="ui-icon-plus"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:dataTable id="dtTelefPer" value="#{requisitosOT.persona.enteTelefonoCollection}" var="tlfn" scrollable="true" scrollHeight="80">
                                <p:column headerText="Teléfono" style="text-align: center" >
                                    <p:outputLabel value="#{tlfn.telefono}"/>
                                </p:column>
                                <p:column headerText="Acción" style="text-align: center" width="60">
                                    <p:commandLink value="Eliminar" actionListener="#{requisitosOT.eliminarTlfn(tlfn)}"
                                                   style="color: #0033FF;font-weight: bolder" update="dtTelefPer" />
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="text-align: center">
                            <p:commandButton value="Guardar" icon="ui-icon-disk" styleClass="btnStyle"
                                             actionListener="#{requisitosOT.guardarSolicitante()}"/>
                            <p:spacer width="40" height="1"/>
                            <p:commandButton value="Cancelar" icon="ui-icon-cancel" styleClass="btnStyle" oncomplete="PF('dlgSolInf').hide();"
                                             actionListener="#{requisitosOT.cancelarGuardado()}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>
        
        <p:dialog header="Seleccione Predio" widgetVar="selPredio" modal="true" resizable="false" width="85%" height="80%">
            <h:form id="formPredSel">
                <center>
                    <p:selectOneRadio id="optconsult" value="#{requisitosOT.codUrban}" layout="custom">
                        <f:selectItem itemLabel="Código Urbanistico" itemValue="#{true}" />
                        <f:selectItem itemLabel="Código Predial" itemValue="#{false}" />
                        <p:ajax update="formPredSel" event="change"/>
                    </p:selectOneRadio>
                    <h:panelGrid columns="4" style="margin: 0 auto">
                        <p:radioButton id="opt1" for="optconsult" itemIndex="0"/>
                        <h:outputLabel for="opt1" value="Código Urbanistico" />
                        <p:radioButton id="opt2" for="optconsult" itemIndex="1"/>
                        <h:outputLabel for="opt2" value="Código Predial" />
                    </h:panelGrid>
                </center>
                <p:dataTable id="dtSelPred" paginator="true" lazy="true" style="text-align: center; font-size: 11px;" scrollHeight="400" scrollable="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rows="15" rowsPerPageTemplate="15,50,100" value="#{requisitosOT.predioLazy}" var="pl"
                             emptyMessage="No se encontró Movimientos">
                    <p:column headerText="Núm. Predio" filterBy="#{pl.numPredio}" sortBy="#{pl.numPredio}" filterStyle="width: 40px" style="width: 100px;">
                        <p:outputLabel value="#{pl.numPredio}"/>
                    </p:column>
                    <p:column headerText="Sector" rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.sector}" sortBy="#{pl.sector}" filterStyle="width: 30px" style="width: 80px;">
                        <p:outputLabel value="#{pl.sector}"/>
                    </p:column>
                    <p:column headerText="Mz." rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.mz}" sortBy="#{pl.mz}" filterStyle="width: 30px" style="width: 60px;">
                        <p:outputLabel value="#{pl.mz}"/>
                    </p:column>
                    <p:column headerText="Cdla." rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.cdla}" sortBy="#{pl.cdla}" filterStyle="width: 30px" style="width: 70px;">
                        <p:outputLabel value="#{pl.cdla}"/>
                    </p:column>
                    <p:column headerText="Mz. Div." rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.mzdiv}" sortBy="#{pl.mzdiv}" filterStyle="width: 30px" style="width: 80px;">
                        <p:outputLabel value="#{pl.mzdiv}"/>
                    </p:column>
                    <p:column headerText="Solar" rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.solar}" sortBy="#{pl.solar}" filterStyle="width: 30px" style="width: 70px;">
                        <p:outputLabel value="#{pl.solar}"/>
                    </p:column>
                    <p:column headerText="Div. 1" rendered="#{!requisitosOT.codUrban}" filterBy="#{pl.div1}" sortBy="#{pl.div1}" filterStyle="width: 30px" style="width: 130px;">
                        <p:outputLabel value="#{pl.div1},#{pl.div2},#{pl.div3},#{pl.div4},#{pl.div5},#{pl.div6},#{pl.div7},#{pl.div8},#{pl.div9},#{pl.phv},#{pl.phh}"/>
                    </p:column>
                    <p:column style="width: 260px;" headerText="Urbanización" filterBy="#{pl.ciudadela.nombre}" rendered="#{requisitosOT.codUrban}" filterOptions="#{fichaIngresoNuevo.lisUrbanizaciones}" filterMatchMode="exact" >
                        <p:outputLabel value="#{pl.ciudadela.nombre}"/>
                    </p:column>
                    <p:column style="width: 70px;" headerText="Mz.Urb." rendered="#{requisitosOT.codUrban}" filterBy="#{pl.urbMz}" sortBy="#{pl.urbMz}" filterStyle="width: 40px">
                        <p:outputLabel value="#{pl.urbMz}"/>
                    </p:column>
                    <p:column style="width: 80px;" headerText="Sl. Urb" rendered="#{requisitosOT.codUrban}" filterBy="#{pl.urbSolarnew}" sortBy="#{pl.urbSolarnew}" filterStyle="width: 40px">
                        <p:outputLabel value="#{pl.urbSolarnew}"/>
                    </p:column>
                    <p:column headerText="Nombre Propietario" filterStyle="width: 40px">
                        <p:outputLabel value="#{pl.getNombrePropietarios()}"/>
                    </p:column>
                    <p:column headerText="Dirección" rendered="#{!requisitosOT.codUrban}" style="width: 80px;" >
                        <p:outputLabel value="Mz. #{pl.urbMz} Sl. #{pl.urbSolarnew}"/>
                    </p:column>
                    <p:column headerText="Seleccionar" style="width: 75px;" >
                        <p:commandButton icon="ui-icon-circle-check" actionListener="#{requisitosOT.selectPredio(pl)}" update="frmMain" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 15px;" oncomplete="PF('selPredio').hide()"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
        
    </ui:define>
</ui:composition>