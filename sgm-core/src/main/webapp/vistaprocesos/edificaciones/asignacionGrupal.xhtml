<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{asignacionGrupal.doPreRenderView()}" />
        </f:metadata>
    </ui:define>
    <ui:define name="top"><h1>Asignaci贸n Grupal</h1></ui:define>
    <ui:define name="content">
        <h:form id="formMain">
            <div style="width: 100%">
                <p:panelGrid styleClass="noBorder" columns="2" style="float: left" rendered="#{asignacionGrupal.esAdmin}">
                    <p:outputLabel value="Tareas de Usuario:" style="font-weight: bolder; color: #0033FF; font-size: 16px"/>
                    <p:inputText value="#{asignacionGrupal.usuario}"> 
                        <p:ajax event="change" listener="#{asignacionGrupal.actualizarTramitePendiente()}" />
                    </p:inputText>
                </p:panelGrid>
                <p:outputLabel value="Total Tramites: #{asignacionGrupal.tareasWF.size()}" 
                               style="font-size: 16px; font-weight: bolder; float: right; padding-right: 35px" /> 
            </div><br/><br/>
            <p:dataTable id="taskList" paginator="true" style="text-align: center;" var="v_task" value="#{asignacionGrupal.tareasWF}"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rows="20" rowsPerPageTemplate="20,50,100" emptyMessage="No tiene tareas pendientes..." filterEvent="enter" paginatorPosition="top"
                         selection="#{asignacionGrupal.tareasSeleccionadas}" rowKey="#{v_task.tarea.id}">
                <p:column selectionMode="multiple" style="text-align:center" width="35"/>
                <p:column headerText="Nombre Tarea" style="text-align: center">
                    <p:outputLabel value=" #{v_task.tarea.name}" style="text-transform: uppercase"/>
                </p:column>
                <p:column headerText="Nombre Tramite" filterBy="#{v_task.tarea.description}" filterStyle="width: 90%"
                          sortBy="#{v_task.tarea.description}">
                    <p:outputLabel value="#{v_task.tarea.description}"  style="text-transform: uppercase"/>
                </p:column>
                <p:column headerText="Solicitante" filterBy="#{v_task.tramite.nombrePropietario}" filterStyle="width: 90%"
                          sortBy="#{v_task.tramite.nombrePropietario}" >
                    <p:outputLabel value="#{v_task.tramite.nombrePropietario}" style="text-transform: uppercase"/>
                </p:column>
                <p:column headerText="No.Tramite" filterBy="#{v_task.tramite.id}" sortBy="#{v_task.tramite.id}" rendered="#{!asignacionGrupal.userRegistro}"
                          width="120" filterStyle="width: 90%">
                    <p:outputLabel value="#{v_task.tramite.id}"/>
                </p:column>
                <p:column headerText="MZ/SL" width="120" rendered="#{!asignacionGrupal.userRegistro}">
                    <p:outputLabel value="Mz #{v_task.tramite.urbmz} - SL #{v_task.tramite.urbsolar}" style="text-transform: uppercase"/>
                </p:column>
                <p:column headerText="Fecha" sortBy="#{v_task.tramite.fecha}" width="80">
                    <p:outputLabel value="#{v_task.tramite.fecha}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:outputLabel>
                </p:column>
                <f:facet name="footer">
                    <p:commandButton icon="ui-icon-calculator" value="Asignar" styleClass="btnStyle" oncomplete="PF('dlgTareasSeleccionadas').show();" update="formTareasSeleccionadas"/> 
                </f:facet>
            </p:dataTable>
        </h:form>
        
        <p:dialog header="Tareas Seleccionadas Para la Asignaci贸n" widgetVar="dlgTareasSeleccionadas" maximizable="true" minHeight="550" minWidth="850"
                  modal="true" closeOnEscape="true" width="850" position="top">
            <h:form id="formTareasSeleccionadas">
                <br/>
                <p:outputLabel value="Tecnico :" style="font-size: 14px; font-weight: bold;"/>
                <p:spacer width="50"/>
                <p:selectOneMenu value="#{asignacionGrupal.tecnico}" effect="fade" converter="entityConverter">
                    <f:attribute name="name" value="AclUser"/>
                    <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                    <f:selectItems value="#{asignacionGrupal.rolTecnico.aclUserCollection}" var="user" itemLabel="#{user.usuario}-#{user.ente.apellidos} #{user.ente.nombres}" itemValue="#{user}"/>
                </p:selectOneMenu>
                <p:spacer width="50"/>
                <p:commandButton icon="ui-icon-person" value="Realizar Asignaci贸n" actionListener="#{asignacionGrupal.validarAsignacion()}" styleClass="btnStyle" oncomplete="PF('dlgMensaje').show();" update="formMensaje"/> 
                <br/><br/>
                <p:dataTable paginator="true" style="text-align: center;" var="v_task" value="#{asignacionGrupal.tareasSeleccionadas}"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rows="20" rowsPerPageTemplate="20,50,100" emptyMessage="No tiene tareas pendientes..." filterEvent="enter" paginatorPosition="top">
                    <p:column headerText="No.Tramite" filterBy="#{v_task.tramite.id}" sortBy="#{v_task.tramite.id}" rendered="#{!asignacionGrupal.userRegistro}"
                              width="120" filterStyle="width: 90%">
                        <p:outputLabel value="#{v_task.tramite.id}"/>
                    </p:column>
                    <p:column headerText="Nombre Tramite" filterBy="#{v_task.tarea.description}" filterStyle="width: 90%"
                              sortBy="#{v_task.tarea.description}">
                        <p:outputLabel value="#{v_task.tarea.description}"  style="text-transform: uppercase"/>
                    </p:column>
                </p:dataTable>
                <br/><br/>
            </h:form>
        </p:dialog>
        
        <p:dialog header="Mensaje" widgetVar="dlgMensaje" modal="true" closeOnEscape="true" width="400">
            <h:form id="formMensaje">
                <br/>
                <p:outputLabel value="Para realizar la Asignaci贸n debe haber seleccionado los tramites y seleccionar el Tecnico:" style="font-size: 13px; font-weight: bold;" rendered="#{!asignacionGrupal.posibleAsignacion}"/>
                <br/>
                <p:outputLabel value="Al Tecnico:" rendered="#{asignacionGrupal.posibleAsignacion}" style="font-size: 13px;"/>
                <p:outputLabel value="#{asignacionGrupal.tecnico.usuario}" style="font-size: 13px; font-weight: bold;" rendered="#{asignacionGrupal.posibleAsignacion}"/> 
                <p:outputLabel value=", se le asignara(n) :" rendered="#{asignacionGrupal.posibleAsignacion}" style="font-size: 13px;"/> 
                <p:outputLabel value="#{asignacionGrupal.tareasSeleccionadas.size()}" style="font-size: 13px; font-weight: bold;" rendered="#{asignacionGrupal.posibleAsignacion}"/> 
                <p:outputLabel value="- Tramite(s)." rendered="#{asignacionGrupal.posibleAsignacion}" style="font-size: 13px;"/>
                <br/><br/><br/>
                <center>
                    <p:commandButton icon="ui-icon-check" value="Aceptar" styleClass="btnStyle" actionListener="#{asignacionGrupal.realizarAsignacion()}" rendered="#{asignacionGrupal.posibleAsignacion}"/>
                    <p:spacer width="50"/>
                    <p:commandButton icon="ui-icon-cancel" value="Cancelar" styleClass="btnStyle" oncomplete="PF('dlgMensaje').hide();" />
                </center>
                <br/>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
