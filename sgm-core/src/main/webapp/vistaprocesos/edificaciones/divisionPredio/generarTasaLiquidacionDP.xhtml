<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="top">
        <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;">
            <p:outputLabel value="Trámite: #{generarTasaLiqDP.ht.id}" style="font-weight: bolder;color: #005f9c"/>
            <p:outputLabel value="Tarea: #{generarTasaLiqDP.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
            <p:outputLabel value="Responsable: #{generarTasaLiqDP.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
        </p:panelGrid>
    </ui:define>
    <ui:define name="content">
        <h:form id="frmMain">

            <p:panel id="pnlDP" style="width: 100%;">
                <p:tabView id="tdatos">
                    <p:tab id="tgen" title="Tasa de liquidacion">
                        <p:panel header="Código Predial">
                            <p:panelGrid  style="width: 100%;" styleClass="noBorder" >

                                <f:facet name="header">  
                                    <p:row>  
                                        <p:column >Sector</p:column>  
                                        <p:column >Mnz.</p:column>  
                                        <p:column >Cdla.</p:column>  
                                        <p:column >Mnz. Div</p:column>  
                                        <p:column>Solar</p:column>  
                                        <p:column>Div1</p:column>  
                                        <p:column>Div2</p:column>  
                                        <p:column>Div3</p:column>  
                                        <p:column>Div4</p:column>  
                                        <p:column>Div5</p:column>  
                                        <p:column>Div6</p:column>  
                                        <p:column>Div7</p:column>  
                                        <p:column>Div8</p:column>  
                                        <p:column>Div9</p:column>  
                                        <p:column>Phv</p:column>  
                                        <p:column>Phh</p:column>  
                                        <p:column>Buscar</p:column>
                                    </p:row>  
                                </f:facet>
                                <p:row style="width: 100%;">
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.sector}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.mz}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.cdla}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.mzdiv}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.solar}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div1}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div2}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div3}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div4}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div5}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div6}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div7}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div8}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.div9}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.phv}"/></p:column>
                                    <p:column><p:inputText style="width: 100%" value="#{generarTasaLiqDP.datosPredio.phh}"/></p:column>
                                    <p:column><p:commandButton update="frmMain" actionListener="#{generarTasaLiqDP.buscarPredio}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px; float: right" value="Buscar" /></p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:panel>

                        <p:panel id="panelPropietarios" header="Datos del Solicitante">

                            <p:column colspan="5">
                                <h:outputText value="Propietarios: " style="font-weight: bold;font-size: 14px"/>
                                <p:commandButton actionListener="#{generarTasaLiqDP.setearValores}" onclick="PF('dlgBuscar').show()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px; float: right" value="Agregar Propietario" disabled="true" />
                                <br/>
                            </p:column>
                            <p:panelGrid style="width: 100%" styleClass="noBorder">
                                <p:column>
                                    <p:dataTable    id="dtpropietarios"
                                                    value="#{generarTasaLiqDP.lisPropietarios}" var="itemP"
                                                    emptyMessage="No tiene datos" style="width: 100%">

                                        <p:column headerText="#C.I. o R.U.C." style="width: 75%;">
                                            <h:outputText value="#{itemP.ente.ciRuc}" style="text-transform: uppercase;"/>
                                        </p:column>
                                        <p:column headerText="Propietario" style="width: 75%;">
                                            <h:outputText value="#{itemP.ente.razonSocial}" rendered="#{!itemP.ente.esPersona}" style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemP.ente.nombreComercial}" rendered="#{!itemP.ente.esPersona}" style="text-transform: uppercase;"/>
                                            <h:outputText value="#{itemP.ente.nombres} #{itemP.ente.apellidos}" rendered="#{itemP.ente.esPersona}" style="text-transform: uppercase;"/>
                                        </p:column>
                                        <p:column headerText="Opción" style="width: 75%;">
                                            <center>
                                                <p:commandLink value="Eliminar" actionListener="#{generarTasaLiqDP.eliminarPropietario(itemP)}" disabled="true" update="dtpropietarios"/>
                                            </center>
                                        </p:column>
                                    </p:dataTable>
                                </p:column>
                            </p:panelGrid>
                        </p:panel>

                        <p:panel header="Ubicación" style="width: 100%;">
                            <p:panelGrid style="width: 100%;" >
                                <p:row style="width: 100%;">
                                    <p:column><h:outputText value="Cantón :" style="margin-right: 25px;"/> <p:inputText value="#{generarTasaLiqDP.canton.nombre}" style="width: 75%" readonly="true"/></p:column>
                                    <p:column><h:outputText value="Parroquia :" style="margin-right: 25px;"/> <p:inputText value="#{generarTasaLiqDP.parroquia.descripcion}" style="width: 75%" readonly="true"/></p:column>
                                    <p:column><h:outputText value="Urbanización :" style="margin-right: 25px;"/> <p:inputText value="#{generarTasaLiqDP.datosPredio.ciudadela.nombre}" style="width: 75%" readonly="true"/></p:column>
                                    <p:column><h:outputText value="Calle :" style="margin-right: 25px;"/> <p:inputText  value="#{generarTasaLiqDP.datosPredio.calle}" style="width: 75%"/></p:column>

                                </p:row>
                                <p:row>
                                    <p:column colspan="2"><h:outputText value="Código Catastral Actual :" style="margin-right: 25px;"/> <p:inputText value="#{generarTasaLiqDP.codigoCatastral}" readonly="true" style="width: 70%"/></p:column>
                                    <p:column><h:outputText value="Mz :" style="margin-right: 75px;"/> <p:inputText value="#{generarTasaLiqDP.datosPredio.urbMz}" readonly="true" style="width: 75%"/></p:column>
                                    <p:column><h:outputText value="Solar :" style="margin-right: 25px;"/> <p:inputText value="#{generarTasaLiqDP.datosPredio.urbSolarnew}" readonly="true" style="width: 75%"/></p:column>
                                </p:row>
                            </p:panelGrid>
                            <p:panelGrid style="width: 100%;  " >
                                <p:column style="width: 150px;">
                                    <p:panel id="panelValores" header="CARACTERÍSTICAS DEL PREDIO" >
                                        <p:panelGrid columns="2" style="width: 100%;">
                                            <h:outputText value="N./Piso sobre nivel bordillo"/><p:inputText  style="width: 50%; display: block; margin: 0 auto;" maxlength="10" value="#{generarTasaLiqDP.htd.numPisosSobreBord}"/>
                                            <h:outputText value="N./Piso bajo nivel bordillo"/><p:inputText style="width: 50%; display: block; margin: 0 auto;" maxlength="10" value="#{generarTasaLiqDP.htd.numPisosBajoBord}"/>
                                            <h:outputText value="Área de Edificación"/><p:inputText style="width: 50%; display: block; margin: 0 auto;" value="#{generarTasaLiqDP.htd.areaEdificacion}"></p:inputText>
                                                <h:outputText value="Avaluo de Construcción"/> <p:inputText style="width: 50%; display: block; margin: 0 auto;"  maxlength="10" value="#{generarTasaLiqDP.htd.avaluoConstruccion}" readonly="true"> </p:inputText> 
                                                <h:outputText value="Avaluo del Solar"/> <p:inputText style="width: 50%; display: block; margin: 0 auto;" maxlength="10" value="#{generarTasaLiqDP.htd.avaluoSolar}" readonly="true">  </p:inputText>
                                                <h:outputText value="Avaluo de la Propiedad"/> 
                                                <p:inputText style="width: 50%; display: block; margin: 0 auto;" maxlength="10" value="#{generarTasaLiqDP.htd.avaluoPropiedad}" > 
                                                    <p:ajax event="blur" listener="#{generarTasaLiqDP.getAvaluoTotal()}" update="pnlSelect"/> 
                                                </p:inputText>

                                        </p:panelGrid>
                                    </p:panel>
                                </p:column>

                                <p:column style="width: 250px;">
                                    <p:panel>
                                        <p:panel header="DESCRIPCIÓN DE LA EDIFICACIÓN" style="height: auto;">
                                            <br/>
                                            <p:inputTextarea id="descripcion" value="#{generarTasaLiqDP.htd.descripcion}" style="width: 100%; text-transform: uppercase; height: 58px;" placeholder="Descripción del predio a dividir"/>
                                        </p:panel>
                                        <p:panel header="OBSERVACIONES DE LA TAREA" style="height: auto;">
                                            <br/>
                                            <p:inputTextarea id="obsservacion" value="#{generarTasaLiqDP.observacion}" style="width: 100%; text-transform: uppercase; height: 58px;" placeholder="Las observaciones son obligatorias para continuar con el trámite."/>
                                        </p:panel>
                                    </p:panel>
                                </p:column>
                            </p:panelGrid>
                                <p:panelGrid id="pnlSelect" style="width: 100%;" styleClass="noBorder">
                                    <f:facet name="header">  
                                        <p:row>
                                            <p:column><h:outputText value="BASE DEL CÁLCULO 1"/></p:column>
                                            <p:column><h:outputText value="BASE DEL CÁLCULO 2"/></p:column>
                                            <p:column><h:outputText value="TOTAL A PAGAR"/></p:column>
                                            <p:column><h:outputText value="DIRECTOR(A) DE EDIFICACIONES"/></p:column>
                                            <p:column><h:outputText value="RESPONSABLE"/></p:column>                                
                                        </p:row>
                                    </f:facet>
                                    <p:row>
                                        <p:column><center><p:inputText value="#{generarTasaLiqDP.htd.baseCalculo}%" readonly="true"/></center></p:column>
                                        <p:column><center><p:inputText value="#{generarTasaLiqDP.baseCalculo2}" readonly="true"/></center></p:column>
                                        <p:column><center><p:inputText value="#{generarTasaLiqDP.htd.total}" readonly="true"/></center></p:column>
                                        <p:column><center>
                                                <p:selectOneMenu value="#{generarTasaLiqDP.htd.firma}" converter="entityConverter" style="width: 40%;">
                                                    <f:selectItems value="#{generarTasaLiqDP.firmas}" var="model" itemValue="#{model}" itemLabel="#{model.nomCompleto}"/>
                                                </p:selectOneMenu>
                                            </center></p:column>
                                        <p:column><center><p:inputText placeholder="# de cédula" value="#{generarTasaLiqDP.cedulaRucResp}"/> <p:commandButton icon="ui-icon-search" actionListener="#{generarTasaLiqDP.buscarResponsable}"/></center></p:column>      
                                    </p:row>
                                </p:panelGrid>
                                <br/>
                                <center><p:commandButton ajax="false"  actionListener="#{generarTasaLiqDP.imprimirPDF()}" icon="ui-icon-document" style="color: #ffffff; width: 150px; background: #616161 !important; font-weight: bold; height: 30px;" value="Guardar"  />
                                <p:commandButton id="btnFIn" value="Mis tareas" actionListener="#{generarTasaLiqDP.continuar()}" style="color: #ffffff; width: 150px; background: #616161 !important; font-weight: bold; height: 30px;" icon="ui-icon-check"/></center>
                            
                        </p:panel>
                    </p:tab>
                    
                    <!-- -->
                    
                    <p:tab id="tadicionales" title="Adicionales">
                        <p:tabView id="tadic">
                            <p:tab id="tdocs" title="Observaciones">
                                <p:dataTable id="dtobs" value="#{generarTasaLiqDP.ht.observacionesCollection}" var="obs" reflow="true" style="width: 100%">
                                    <f:facet name="header">Observaciones</f:facet>
                                    <p:column headerText="Descripcion" style="width: 40%">
                                        #{obs.observacion}
                                    </p:column>
                                    <p:column headerText="tarea" style="width: 25%">
                                        #{obs.tarea}
                                    </p:column>
                                    <p:column headerText="Responsable" style="width: 20%">
                                        #{obs.userCre}
                                    </p:column>
                                    <p:column headerText="Fecha" style="width: 15%">
                                        #{obs.fecCre}
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                            <p:tab id="tobs" title="Documentos">
                                <dialog:detalleArchivosAct archivos="#{generarTasaLiqDP.processInstanceAttachmentsFiles}"/>
                            </p:tab>
                        </p:tabView>
                    </p:tab>
                </p:tabView>
            </p:panel>
        </h:form>

        <p:dialog header="Buscar Usuario" id="dlgBuscar" widgetVar="dlgBuscar" modal="true" height="auto" width="auto" >  
            <h:form id="nuevoDlgForm" >
                <h:panelGroup id="nuevoPGroup">
                    <p:panelGrid columns="3" >
                        <h:outputText value="Número de Cédula" style="display: block;"/>
                        <p:inputText value="#{generarTasaLiqDP.cedulaRuc}" style="display: block; margin: 0 auto;"/>
                        <p:commandButton update="dataListEnte" actionListener="#{generarTasaLiqDP.buscarEnte()}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" />
                    </p:panelGrid>
                    <p:panelGrid columns="1" style="width: 100%; height: auto;" id="panelList">
                        <p:dataTable  id="dataListEnte"  value="#{generarTasaLiqDP.enteList}" var="itemP"
                                      emptyMessage="No tiene datos" style="width: 330px;">
                            <p:column headerText="#C.I. o R.U.C.">
                                <h:outputText value="#{itemP.ciRuc}" style="text-transform: uppercase;"/>
                            </p:column>
                            <p:column headerText="Nombres">
                                <h:outputText value="#{itemP.nombreComercial}" rendered="#{!itemP.esPersona}" style="text-transform: uppercase;"/>
                                <h:outputText value="#{itemP.nombres} #{itemP.apellidos}" rendered="#{itemP.esPersona}" style="text-transform: uppercase;"/>
                            </p:column>
                            <p:column headerText="Acción">
                                <p:commandButton update="nuevoDlgForm" value="Agregar Propietario"  actionListener="#{generarTasaLiqDP.agregarPropietario(itemP)}"/>
                            </p:column>
                        </p:dataTable>
                    </p:panelGrid>
                    <br/>
                    <center><p:commandButton onclick="PF('dlgBuscar').hide()" update=":frmMain:tdatos:panelPropietarios" style="color: #ffffff; width: 150px; background: #616161 !important; font-weight: bold; height: 30px;" value="Cerrar"  /></center>
                </h:panelGroup>
            </h:form>
        </p:dialog>
        
        <p:dialog header="Mensaje Responsable Técnico" id="dlgResp" widgetVar="dlgResp" modal="true" height="auto" width="auto" >  
            <h:form id="respDlgForm" >
                <h:outputText value="La persona: #{generarTasaLiqDP.responsableTec.nombres} #{generarTasaLiqDP.responsableTec.apellidos} será el responsable técnico." />
                <br/>
                <center><p:commandButton value="Aceptar" onclick="PF('dlgResp').hide()"/></center>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>