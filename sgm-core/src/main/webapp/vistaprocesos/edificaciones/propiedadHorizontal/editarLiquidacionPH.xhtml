<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="events">

    </ui:define>

    <ui:define name="page_title">
        Generar Liquidación P.H.
    </ui:define>

    <ui:define name="content">
        <h:form id="formGenLiqPH">
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;">
                <p:outputLabel value="Tarea: #{editarLiquidacionPH.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="No Trámite: #{editarLiquidacionPH.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{editarLiquidacionPH.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
            <p:panelGrid id="pgliqPH">
                <f:facet name="header" >
                    <p:column colspan="17" styleClass="headerWhite" style="color: #0066cc; text-align: center; font-size: 14pt;">
                        Código Predial:
                    </p:column>
                </f:facet>
                <p:row >
                    <p:column>
                        Sector<br/><p:inputText value="#{editarLiquidacionPH.predio.sector}" readonly="true" style="width: 50px;"/>
                    </p:column>
                    <p:column>
                        Mnz. <p:inputText value="#{editarLiquidacionPH.predio.mz}" readonly="true" style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Cdla. <p:inputText value="#{editarLiquidacionPH.predio.cdla}" readonly="true" style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Mz. Div <p:inputText value="#{editarLiquidacionPH.predio.mzdiv}" readonly="true" style="width: 70%;"/>
                    </p:column>
                    <p:column>
                        Solar <p:inputText value="#{editarLiquidacionPH.predio.solar}" readonly="true" style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div1 <p:inputText value="#{editarLiquidacionPH.predio.div1}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div2 <p:inputText value="#{editarLiquidacionPH.predio.div2}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div3 <p:inputText value="#{editarLiquidacionPH.predio.div3}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div4 <p:inputText value="#{editarLiquidacionPH.predio.div4}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div5 <p:inputText value="#{editarLiquidacionPH.predio.div5}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div6 <p:inputText value="#{editarLiquidacionPH.predio.div6}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div7 <p:inputText value="#{editarLiquidacionPH.predio.div7}" readonly="true"  style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div8 <p:inputText value="#{editarLiquidacionPH.predio.div8}" readonly="true" style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        Div9 <p:inputText value="#{editarLiquidacionPH.predio.div9}" readonly="true" style="width: 80%;"/>
                    </p:column>
                    <p:column>
                        <p:commandLink update="formGenLiqPH" style=" height: 30px;" >
                            <p:graphicImage value="/css/homeIconsImages/buscar.png" height="20" width="20"/>
                        </p:commandLink>
                    </p:column>
                </p:row>
                <!--Datos Propietario-->
                <p:row>
                    <p:column colspan="15" styleClass="ui-widget-header headerWhite" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">
                        Datos de Propietario
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="15">
                        <p:dataTable id="dtProp" value="#{editarLiquidacionPH.listaPropietarios}" var="prop" style="width: 100%" reflow="true" emptyMessage="No hay asignado Propietarios al Predio">
                            <f:facet name="header">
                                <div align="right">
                                    <p:commandLink value="Agregar Propietario" actionListener="#{editarLiquidacionPH.renderPersNat()}" style="color: #0033FF !important; font-weight: bold; font-size: 14px;"  disabled="true"/>
                                </div>
                            </f:facet>
                            <p:column headerText="#C.I. O R.U.C" style="text-align: center;font-weight: bold">
                                <p:outputLabel value="#{prop.ente.ciRuc}"/>
                            </p:column>
                            <p:column headerText="Propietario" style="text-align: center;font-weight: bold">
                                <p:outputLabel value="#{prop.ente.nombres} #{prop.ente.apellidos}" rendered="#{prop.ente.esPersona}"/>
                                <p:outputLabel value="#{prop.ente.razonSocial}" rendered="#{!prop.ente.esPersona}"/>
                            </p:column>
                            <p:column headerText="Opción" style="text-align: center;font-weight: bold">
                                <p:commandLink value="Eliminar" actionListener="#{editarLiquidacionPH.eliminarProp(prop)}" update="formGenLiqPH:dtProp" process="dtProp"/>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                </p:row>
                <!--Urbanización-->
                <p:row>
                    <p:column styleClass="ui-widget-header headerWhite" colspan="17" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">Ubicación</p:column>
                </p:row>
                <p:row>
                    <p:column colspan="5">
                        Cantón: <!--p:inputText value="# {editarLiquidacionPH.predio.nombreUrb}"  style="width: 70%" readonly="true" /-->
                        <br/>
                        <p:selectOneMenu value="#{editarLiquidacionPH.canton}" effect="fade" converter="entityConverter"  >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" itemDisabled="true" />  
                            <f:selectItems value="#{editarLiquidacionPH.catCantonsList}" var="c" itemLabel="#{c.nombre}" itemValue="#{c}" itemDisabled="true"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="3">
                        Parroquia: <!--p:inputText value="# {editarLiquidacionPH.predio.ciudadela.codParroquia.descripcion}" style="width: 50%" readonly="true" /-->
                        <p:selectOneMenu value="#{editarLiquidacionPH.parroquia}" effect="fade" converter="entityConverter"  >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" itemDisabled="true" />  
                            <f:selectItems value="#{editarLiquidacionPH.catParroquiaList}" var="p" itemLabel="#{p.descripcion}" itemValue="#{p}" itemDisabled="true"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="3">
                        Urbanización: <p:inputText value="#{editarLiquidacionPH.predio.ciudadela.nombre}" readonly="true" style="width: 50%" />
                    </p:column>
                    <p:column colspan="4">
                        Calle: <p:inputText value="#{editarLiquidacionPH.predio.calle}" style="width: 70%" />
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="7">
                        Código catastral Actual: <p:inputText value="#{editarLiquidacionPH.predio.codigoPredial}" readonly="true" style="width: 70%"/>
                    </p:column>
                    <p:column colspan="4">
                        Mz: <p:inputText value="#{editarLiquidacionPH.predio.urbMz}" readonly="true"/>
                    </p:column>
                    <p:column colspan="4">
                        Solar: <p:inputText value="#{editarLiquidacionPH.predio.urbSolarnew}" readonly="true"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="8" styleClass="ui-widget-header" style="text-align: center; color: #0066cc;">
                        CARACTERÍSTICAS DEL PREDIO
                    </p:column>
                    <p:column colspan="7" styleClass="ui-widget-header" style="text-align: center; color: #0066cc;">
                        DESCRIPCIÓN DE LA EDIFICACIÓN
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="8">
                        <p:panelGrid id="pgCaractPred" columns="2" layout="grid">
                            <p:outputLabel value="N&deg;./Piso sobre nivel bordillo"/>
                            <p:inputText value="#{editarLiquidacionPH.procesoPH.numPisosSobreBord}" readonly="true"/>

                            <p:outputLabel value="N&deg;./Piso bajo nivel bordillo"/>
                            <p:inputText value="#{editarLiquidacionPH.procesoPH.numPisosBajoBord}" readonly="true"/>

                            <p:outputLabel value="Área de Edificación"/>
                            <pe:inputNumber value="#{editarLiquidacionPH.procesoPH.areaEdificacion}" readonly="#{!editarLiquidacionPH.isPropiedadHorizontal}" maxValue="999999999999.9999" >
                                <p:ajax event="blur" listener="#{editarLiquidacionPH.calcularAvaluoConstruccion()}" update="formGenLiqPH:avaluoConstrid"/>
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo de Construcción"/>
                            <pe:inputNumber id="avaluoConstrid" value="#{editarLiquidacionPH.procesoPH.avaluoConstruccion}" maxValue="99999999999999999999.9999" >
                                <p:ajax event="blur" listener="#{editarLiquidacionPH.avaluoPropiedad()}" update="formGenLiqPH:avaluoid,formGenLiqPH:totalpagar"/>
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo del Solar"/>
                            <pe:inputNumber value="#{editarLiquidacionPH.procesoPH.avaluoSolar}" maxValue="99999999999999999999.9999" >
                                <p:ajax event="blur" listener="#{editarLiquidacionPH.avaluoPropiedad()}" update="formGenLiqPH:avaluoid,formGenLiqPH:totalpagar" />
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo de la Propiedad"/>
                            <pe:inputNumber id="avaluoid" value="#{editarLiquidacionPH.procesoPH.avaluoEdificacion}" readonly="true"  maxValue="99999999999999999999.9999"/>

                        </p:panelGrid>
                    </p:column>
                    <p:column colspan="7">
                        <p:inputTextarea value="#{editarLiquidacionPH.procesoPH.descripcion}" rows="10" style="width: 95%;"/>
                    </p:column>
                </p:row>

                <p:row>
                    <p:column colspan="5" styleClass="ui-widget-header" style="text-align: center; color: #0066cc;">
                        BASE DEL CÁLCULO 1
                    </p:column>
                    <p:column styleClass="ui-widget-header" colspan="5" style="text-align: center; color: #0066cc;">
                        BASE DEL CÁLCULO 2
                    </p:column>
                    <p:column styleClass="ui-widget-header" colspan="5" style="text-align: center; color: #0066cc;">
                        TOTAL A PAGAR
                    </p:column>
                </p:row>
                <p:row >
                    <p:column headerText="BASE DEL CÁLCULO 1" colspan="5">
                        <pe:inputNumber value="#{editarLiquidacionPH.procesoPH.baseCalculo}" decimalPlaces="0" symbol="%"  symbolPosition="s" rendered="#{!editarLiquidacionPH.isPropiedadHorizontal}" readonly="true" />
                    </p:column>
                    <p:column headerText="BASE DEL CÁLCULO 2" colspan="5">
                        <pe:inputNumber value="#{editarLiquidacionPH.procesoPH.baseCalculo}" decimalPlaces="2" symbol="%"  symbolPosition="s" rendered="#{editarLiquidacionPH.isPropiedadHorizontal}" readonly="true" />
                    </p:column>
                    <p:column headerText="TOTAL A PAGAR" colspan="5">
                        <p:inputText id="totalpagar" value="#{editarLiquidacionPH.ht.valorLiquidacion}"  readonly="true"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="8">
                        Director(a) de Edificaciones: <br/>
                        <p:selectOneMenu value="#{editarLiquidacionPH.procesoPH.firma}" effect="fade" converter="entityConverter"  >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />  
                            <f:selectItems value="#{editarLiquidacionPH.listPeFirma}" var="f" itemLabel="#{f.nomCompleto}" itemValue="#{f}"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="7" >
                        Responsable: <br/>
                        <p:inputText value="#{editarLiquidacionPH.realizadorPor}" style="width: 300px" readonly="true"/>
                    </p:column>
                </p:row>
            </p:panelGrid>
            <p:spacer height="30"/>
            <div align="center">
                <p:commandButton actionListener="#{editarLiquidacionPH.guardarProcesoReporte()}" rendered="#{editarLiquidacionPH.guardar}" value="Guardar" icon="ui-icon-disk" style="height: 30px;" styleClass="btnStyle"/>
                <p:commandButton actionListener="#{editarLiquidacionPH.iniciarDatos()}" rendered="#{editarLiquidacionPH.impresion}" value="Imprimir" icon="ui-icon-print" style="height: 30px;" styleClass="btnStyle"/>
                <p:commandButton actionListener="#{editarLiquidacionPH.redirectDashBoard()}" rendered="#{editarLiquidacionPH.dashBoard}" value="Bandeja Tareas" icon="ui-icon-circle-arrow-w" style="height: 30px;" styleClass="btnStyle"/>
            </div>
        </h:form>
        
        <p:dialog header="Agregar Propietario" id="dlgNuevPro" widgetVar="dlgNuevPro" modal="true" height="250" 
                  width="450" resizable="false" >
            <h:form id="formNuProp">
                Es Perona Natural 
                <p:selectBooleanCheckbox value="#{editarLiquidacionPH.propietarioNuevo.esPersona}" >
                    <p:ajax update="formNuProp" />
                </p:selectBooleanCheckbox>
                <br/>
                <p:panelGrid id="pngProp" layout="grid" columns="3" >
                    <p:outputLabel value="Cédula: " rendered="#{editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputMask mask="9999999999" value="#{editarLiquidacionPH.propietarioNuevo.ciRuc}" rendered="#{editarLiquidacionPH.propietarioNuevo.esPersona}" />
                    <p:outputLabel value="RUC: " rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputMask mask="9999999999999" value="#{editarLiquidacionPH.propietarioNuevo.ciRuc}" rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:commandButton actionListener="#{editarLiquidacionPH.buscarPropietario()}" icon="ui-icon-search" iconPos="s" style="height: 30px; color: #ffffff; background: #616161 !important;"/>

                    <p:outputLabel value="Nombres: " />
                    <p:inputText value="#{editarLiquidacionPH.propietarioNuevo.nombres}" style="width: 180px" rendered="#{editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{editarLiquidacionPH.propietarioNuevo.razonSocial}" style="width: 180px" rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:outputLabel/>

                    <p:outputLabel value="Apellidos: " rendered="#{editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{editarLiquidacionPH.propietarioNuevo.apellidos}" style="width: 180px" rendered="#{editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:outputLabel value="Representante Legal: " rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{editarLiquidacionPH.representanteLegal}" readonly="true"  rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:commandButton id="busReprestL" actionListener="#{editarLiquidacionPH.seleccionarReprest()}"  rendered="#{!editarLiquidacionPH.propietarioNuevo.esPersona}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-search" />
                </p:panelGrid>
                <br/>
                <p:commandButton value="Agregar" type="button" actionListener="#{editarLiquidacionPH.agregarPropietario()}" style="float: right" styleClass="btnStyle"/>
            </h:form>    
        </p:dialog>
        
        <p:dialog id="dlgSelectReprest" header="Representantes" widgetVar="dlgSelectReprest" resizable="false" modal="false" position="center" closable="true" width="800">
            <h:form id="formSelectInterv">
                <p:dataTable id="dtIntervLazy" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,30,50" scrollHeight="350" scrollable="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             value="#{editarLiquidacionPH.enteLazy}" var="user" emptyMessage="No se encontró ningún Item">
                    <p:column headerText="C.I./R.U.C." style="text-align: center;" filterBy="#{user.ciRuc}" filterStyle="width: 80%;" width="120">
                        <h:outputText value="#{user.ciRuc}" style="text-align: center; font-size: 12px"/>
                    </p:column>
                    <p:column headerText="Nombres" style="text-align: center" filterBy="#{user.nombres}" filterStyle="width: 80%;" >
                        <h:outputText value="#{user.nombres}"/>
                    </p:column>
                    <p:column headerText="Apellidos" style="text-align: center" filterBy="#{user.apellidos}" filterStyle="width: 80%;" >
                        <h:outputText value="#{user.apellidos}"/>
                    </p:column>   
                    <p:column headerText="Selecc." style="text-align: center;" width="60">
                        <p:commandButton icon="ui-icon-plusthick" style="height: 20px;" styleClass="btnStyle" actionListener="#{editarLiquidacionPH.agregarRepresentante(user)}" />                           
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
        
        <p:dialog id="dlgObs" widgetVar="obs" header="#{editarLiquidacionPH.taskDataByTaskID.name}" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObsCor">
                <h1>Ingrese las observaciones</h1>
                <div align="center">
                    <p:inputTextarea id="obsservacion" value="#{editarLiquidacionPH.observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                    <br/>
                    <p:commandButton id="btnAprobar" value="Generar Liquidación" actionListener="#{editarLiquidacionPH.imprimir()}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-check" iconPos="s" />
                    <p:commandButton id="btnSubir" value="Salir" onclick="PF('obs').hide()" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-check" iconPos="s" />
                </div>
            </h:form>
        </p:dialog>
        
    </ui:define>

</ui:composition>
