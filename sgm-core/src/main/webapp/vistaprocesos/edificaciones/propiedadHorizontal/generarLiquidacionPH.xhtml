<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="events">

    </ui:define>

    <ui:define name="page_title">
        Generar Liquidación P.H.
    </ui:define>

    <ui:define name="content">
        <h:form id="formGenLiqPH">
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;">
                <p:outputLabel value="Tarea: #{generarLiquidacionPH.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="No Trámite: #{generarLiquidacionPH.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{generarLiquidacionPH.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
            <h:panelGrid columns="2" width="100%" >
                <h:panelGroup style="width: 100%;">
                    <p:outputLabel value="Entrego Carta de adosamiento"/>
                    <h:selectOneRadio styleClass="noBorder" id="catRet" value="#{generarLiquidacionPH.procesoPH.cartaAdosamiento}" style="width: 150px" >                                             
                        <f:selectItem itemLabel="Si" itemValue="#{true}" />  
                        <f:selectItem itemLabel="No" itemValue="#{false}"  /> 
                        <p:ajax update="formGenLiqPH" />
                    </h:selectOneRadio>
                </h:panelGroup>
                <p:dataTable id="dtCartaAdos" value="#{generarLiquidacionPH.cartaAdosamiento}" var="cart" style="width: 60%" reflow="true"
                             emptyMessage="No ha cargado documento alguno" rendered="#{generarLiquidacionPH.procesoPH.cartaAdosamiento}" >
                    <f:facet name="header">
                        Carta de adosamiento
                        <p:commandLink value="Adjuntar Carta" onclick="PF('dlgDocCarta').show()" rendered="#{generarLiquidacionPH.procesoPH.cartaAdosamiento}" style="float: right" />
                    </f:facet>
                    <p:column headerText="Archivo" style="width: 60%">
                        #{cart.nombre}
                    </p:column>
                    <p:column headerText="Tipo" style="width: 20%">
                        #{cart.tipo}
                    </p:column>
                    <p:column headerText="Opci&#243;n" style="width: 20%">
                        <p:commandLink value="Eliminar" actionListener="#{generarLiquidacionPH.eliminarCartaAdosamiento(cart)}" update="formGenLiqPH:dtCartaAdos" />
                    </p:column>
                </p:dataTable>
            </h:panelGrid>
            <p:panelGrid id="pgliqPH">
                <f:facet name="header" >
                    <p:column colspan="17" styleClass="headerWhite" style="color: #0066cc; text-align: center; font-size: 14pt;">
                        Código Predial:
                    </p:column>
                </f:facet>
                <p:row >
                    <p:column>Sector<br/><p:inputText value="#{generarLiquidacionPH.predio.sector}" maxlength="4" style="width: 50px;"/></p:column>
                    <p:column>Mnz. <p:inputText value="#{generarLiquidacionPH.predio.mz}" maxlength="4" style="width: 80%;"/></p:column>
                    <p:column>Cdla. <p:inputText value="#{generarLiquidacionPH.predio.cdla}" maxlength="4" style="width: 80%;"/></p:column>
                    <p:column>Mz. Div <p:inputText value="#{generarLiquidacionPH.predio.mzdiv}" maxlength="4" style="width: 70%;"/></p:column>
                    <p:column>Solar <p:inputText value="#{generarLiquidacionPH.predio.solar}" maxlength="4" style="width: 80%;"/></p:column>
                    <p:column>Div1 <p:inputText value="#{generarLiquidacionPH.predio.div1}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div2 <p:inputText value="#{generarLiquidacionPH.predio.div2}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div3 <p:inputText value="#{generarLiquidacionPH.predio.div3}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div4 <p:inputText value="#{generarLiquidacionPH.predio.div4}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div5 <p:inputText value="#{generarLiquidacionPH.predio.div5}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div6 <p:inputText value="#{generarLiquidacionPH.predio.div6}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div7 <p:inputText value="#{generarLiquidacionPH.predio.div7}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div8 <p:inputText value="#{generarLiquidacionPH.predio.div8}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>Div9 <p:inputText value="#{generarLiquidacionPH.predio.div9}" maxlength="1"  style="width: 80%;"/></p:column>
                    <p:column>
                        <p:commandLink actionListener="#{generarLiquidacionPH.consultarCodPredio()}" update="formGenLiqPH" style=" height: 30px;" >
                            <p:graphicImage value="/css/homeIconsImages/buscar.png" height="20" width="20"/>
                        </p:commandLink>
                    </p:column>
                </p:row>
                <!--Datos Propietario-->
                <p:row>
                    <p:column colspan="15" styleClass="ui-widget-header headerWhite" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">
                        Datos de Propietario
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="15">
                        <p:dataTable id="dtProp" value="#{generarLiquidacionPH.listaPropietarios}" var="prop" style="width: 100%" reflow="true" emptyMessage="No hay asignado Propietarios al Predio">
                            <f:facet name="header">
                                <div align="right">
                                    <p:commandLink value="Agregar Propietario" actionListener="#{generarLiquidacionPH.renderPersNat()}" style="color: #0033FF !important; font-weight: bold; font-size: 14px;"  disabled="true"/>
                                </div>
                            </f:facet>
                            <p:column headerText="#C.I. O R.U.C" style="text-align: center;font-weight: bold">
                                <p:outputLabel value="#{prop.ente.ciRuc}"/>
                            </p:column>
                            <p:column headerText="Propietario" style="text-align: center;font-weight: bold">
                                <p:outputLabel value="#{prop.ente.nombres} #{prop.ente.apellidos}" rendered="#{prop.ente.esPersona}"/>
                                <p:outputLabel value="#{prop.ente.razonSocial}" rendered="#{!prop.ente.esPersona}"/>
                            </p:column>
                            <p:column headerText="Opción" style="text-align: center;font-weight: bold">
                                <p:commandLink value="Eliminar" actionListener="#{generarLiquidacionPH.eliminarProp(prop)}" update="formGenLiqPH:dtProp" process="dtProp"/>
                            </p:column>
                        </p:dataTable>
                    </p:column>
                </p:row>
                <!--Urbanización-->
                <p:row>
                    <p:column styleClass="ui-widget-header headerWhite" colspan="17" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">Ubicación</p:column>
                </p:row>
                <p:row>
                    <p:column colspan="5">
                        Cantón: <!--p:inputText value="# {generarLiquidacionPH.predio.nombreUrb}"  style="width: 70%" readonly="true" /-->
                        <br/>
                        <p:selectOneMenu value="#{generarLiquidacionPH.canton}" effect="fade" converter="entityConverter"  >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" itemDisabled="true" />  
                            <f:selectItems value="#{generarLiquidacionPH.catCantonsList}" var="c" itemLabel="#{c.nombre}" itemValue="#{c}" itemDisabled="true"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="3">
                        Parroquia: <!--p:inputText value="# {generarLiquidacionPH.predio.ciudadela.codParroquia.descripcion}" style="width: 50%" readonly="true" /-->
                        <br/>
                        <p:selectOneMenu value="#{generarLiquidacionPH.parroquia}" effect="fade" converter="entityConverter"  >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" itemDisabled="true" />  
                            <f:selectItems value="#{generarLiquidacionPH.catParroquiaList}" var="p" itemLabel="#{p.descripcion}" itemValue="#{p}" itemDisabled="true"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="3">
                        Urbanización: 
                        <br/><p:inputText value="#{generarLiquidacionPH.predio.ciudadela.nombre}" readonly="true" style="width: 98%" />
                    </p:column>
                    <p:column colspan="4">
                        Calle: 
                        <br/><p:inputText value="#{generarLiquidacionPH.predio.calle}" style="width: 70%" readonly="true"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="7">
                        Código catastral Actual: <p:inputText value="#{generarLiquidacionPH.predio.codigoPredial}" readonly="true" style="width: 70%"/>
                    </p:column>
                    <p:column colspan="4">
                        Mz: <p:inputText value="#{generarLiquidacionPH.predio.urbMz}" readonly="true"/>
                    </p:column>
                    <p:column colspan="4">
                        Solar: <p:inputText value="#{generarLiquidacionPH.predio.urbSolarnew}" readonly="true"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column styleClass="ui-widget-header headerWhite" colspan="8" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">
                        CARACTERÍSTICAS DEL PREDIO
                    </p:column>
                    <p:column styleClass="ui-widget-header headerWhite" colspan="7" style="text-align: center; color: #0066cc; padding-top: 14pt; font-size: 14px;">
                        DESCRIPCIÓN DE LA EDIFICACIÓN
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="8">
                        <p:panelGrid id="pgCaractPred" columns="2" layout="grid">
                            <p:outputLabel value="N&deg;./Piso sobre nivel bordillo"/>
                            <p:inputText value="#{generarLiquidacionPH.procesoPH.numPisosSobreBord}" readonly="true"/>

                            <p:outputLabel value="N&deg;./Piso bajo nivel bordillo"/>
                            <p:inputText value="#{generarLiquidacionPH.procesoPH.numPisosBajoBord}" readonly="true" />
                            
                            <p:outputLabel value="Factor Multiplicacion (Valor por Metro)"/>
                            <pe:inputNumber value="#{generarLiquidacionPH.procesoPH.valorXMetro}" readonly="#{!generarLiquidacionPH.isPropiedadHorizontal}" maxValue="999999999999.9999" />
                            
                            <p:outputLabel value="Factor Depreciacion"/>
                            <pe:inputNumber value="#{generarLiquidacionPH.procesoPH.depreciacion}" readonly="#{!generarLiquidacionPH.isPropiedadHorizontal}" maxValue="999999999999.9999" />
                                                                                    
                            <p:outputLabel value="Área de Edificación"/>
                            <pe:inputNumber value="#{generarLiquidacionPH.procesoPH.areaEdificacion}" readonly="#{!generarLiquidacionPH.isPropiedadHorizontal}" maxValue="999999999999.9999" >
                                <p:ajax event="blur" listener="#{generarLiquidacionPH.calcularAvaluoConstruccion()}" update="formGenLiqPH:avaluoConstrid" process="@all"/>
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo de Construcción"/>
                            <pe:inputNumber id="avaluoConstrid" value="#{generarLiquidacionPH.procesoPH.avaluoConstruccion}" maxValue="99999999999999999999.9999" >
                                <p:ajax event="blur" listener="#{generarLiquidacionPH.avaluoPropiedad()}" update="formGenLiqPH:avaluoid,formGenLiqPH:totalpagar"/>
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo del Solar"/>
                            <pe:inputNumber value="#{generarLiquidacionPH.procesoPH.avaluoSolar}" maxValue="99999999999999999999.9999" >
                                <p:ajax event="blur" listener="#{generarLiquidacionPH.avaluoPropiedad()}" update="formGenLiqPH:avaluoid,formGenLiqPH:totalpagar" />
                            </pe:inputNumber>

                            <p:outputLabel value="Avaluo de la Propiedad"/>
                            <pe:inputNumber id="avaluoid" value="#{generarLiquidacionPH.procesoPH.avaluoEdificacion}" readonly="true"  maxValue="99999999999999999999.9999"/>

                        </p:panelGrid>
                    </p:column>
                    <p:column colspan="7">
                        <p:inputTextarea value="#{generarLiquidacionPH.procesoPH.descripcion}" rows="10" style="width: 95%;"/>
                    </p:column>
                </p:row>

                <p:row>
                    <p:column styleClass="ui-widget-header" colspan="5" style="text-align: center; color: #0066cc;">
                        BASE DEL CÁLCULO 1
                    </p:column>
                    <p:column styleClass="ui-widget-header" colspan="5" style="text-align: center; color: #0066cc;">
                        BASE DEL CÁLCULO 2
                    </p:column>
                    <p:column styleClass="ui-widget-header" colspan="5" style="text-align: center; color: #0066cc;">
                        TOTAL A PAGAR
                    </p:column>
                </p:row>
                <p:row >
                    <p:column headerText="BASE DEL CÁLCULO 1" colspan="5">
                        <pe:inputNumber value="#{generarLiquidacionPH.baseCalculo1}" decimalPlaces="2" symbol="%"  symbolPosition="s" readonly="true" />
                    </p:column>
                    <p:column headerText="BASE DEL CÁLCULO 2" colspan="5">
                        <pe:inputNumber value="#{generarLiquidacionPH.baseCalculo2}" decimalPlaces="2" symbol="%"  symbolPosition="s" readonly="true" />
                    </p:column>
                    <p:column headerText="TOTAL A PAGAR" colspan="5">
                        <p:inputText id="totalpagar" value="#{generarLiquidacionPH.ht.valorLiquidacion}"  readonly="true"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column colspan="8">
                        Director(a) de Edificaciones: <br/>
                        <p:selectOneMenu id="firm" value="#{generarLiquidacionPH.procesoPH.firma}" converter="entityConverter" immediate="true" caseSensitive="true" >  
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />  
                            <f:selectItems value="#{generarLiquidacionPH.listPeFirma}" var="f" itemLabel="#{f.nomCompleto}" itemValue="#{f}"/>  
                        </p:selectOneMenu>
                    </p:column>
                    <p:column colspan="7" >
                        Responsable: <br/>
                        <p:inputText value="#{generarLiquidacionPH.realizadorPor}" style="width: 300px" readonly="true"/>
                    </p:column>
                </p:row>
            </p:panelGrid>
            <p:spacer height="30"/>
            <div align="center">
                <p:commandButton actionListener="#{generarLiquidacionPH.validar()}" rendered="#{generarLiquidacionPH.guardar}" value="Guardar" icon="ui-icon-disk" style="height: 30px;" styleClass="btnStyle"/>
                <p:commandButton actionListener="#{generarLiquidacionPH.imprimir()}" rendered="#{generarLiquidacionPH.impresion}" value="Imprimir" icon="ui-icon-print" style="height: 30px;" styleClass="btnStyle"/>
                <p:commandButton actionListener="#{generarLiquidacionPH.redirectDashBoard()}" rendered="#{generarLiquidacionPH.dashBoard}" value="Bandeja Tareas" icon="ui-icon-circle-arrow-w" style="height: 30px;" styleClass="btnStyle"/>
            </div>
        </h:form>

        <p:dialog header="Agregar Propietario" id="dlgNuevPro" widgetVar="dlgNuevPro" modal="true" height="250" 
                  width="450" resizable="false" >
            <h:form id="formNuProp">
                Es Perona Natural 
                <p:selectBooleanCheckbox value="#{generarLiquidacionPH.propietarioNuevo.esPersona}" >
                    <p:ajax update="formNuProp" />
                </p:selectBooleanCheckbox>
                <br/>
                <p:panelGrid id="pngProp" layout="grid" columns="3" >
                    <p:outputLabel value="Cédula: " rendered="#{generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputMask mask="9999999999" value="#{generarLiquidacionPH.propietarioNuevo.ciRuc}" rendered="#{generarLiquidacionPH.propietarioNuevo.esPersona}" />
                    <p:outputLabel value="RUC: " rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputMask mask="9999999999999" value="#{generarLiquidacionPH.propietarioNuevo.ciRuc}" rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:commandButton actionListener="#{generarLiquidacionPH.buscarPropietario()}" icon="ui-icon-search" iconPos="s" style="height: 30px; color: #ffffff; background: #616161 !important;"/>

                    <p:outputLabel value="Nombres: " />
                    <p:inputText value="#{generarLiquidacionPH.propietarioNuevo.nombres}" style="width: 180px" rendered="#{generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{generarLiquidacionPH.propietarioNuevo.razonSocial}" style="width: 180px" rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:outputLabel/>

                    <p:outputLabel value="Apellidos: " rendered="#{generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{generarLiquidacionPH.propietarioNuevo.apellidos}" style="width: 180px" rendered="#{generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:outputLabel value="Representante Legal: " rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:inputText value="#{generarLiquidacionPH.representanteLegal}" readonly="true"  rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}"/>
                    <p:commandButton id="busReprestL" actionListener="#{generarLiquidacionPH.seleccionarReprest()}"  rendered="#{!generarLiquidacionPH.propietarioNuevo.esPersona}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-search" />
                </p:panelGrid>
                <br/>
                <p:commandButton value="Agregar" actionListener="#{generarLiquidacionPH.agregarPropietario()}" update="formGenLiqPH:dtProp" style="float: right" styleClass="btnStyle"/>
            </h:form>    
        </p:dialog>

        <p:dialog id="dlgSelectReprest" header="Representantes" widgetVar="dlgSelectReprest" resizable="false" modal="false" position="center" closable="true" width="800">
            <h:form id="formSelectInterv">
                <p:dataTable id="dtIntervLazy" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,30,50" scrollHeight="350" scrollable="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             value="#{generarLiquidacionPH.enteLazy}" var="user" emptyMessage="No se encontró ningún Item">
                    <p:column headerText="C.I./R.U.C." style="text-align: center;" filterBy="#{user.ciRuc}" filterStyle="width: 80%;" width="120">
                        <h:outputText value="#{user.ciRuc}" style="text-align: center; font-size: 12px"/>
                    </p:column>
                    <p:column headerText="Nombres" style="text-align: center" filterBy="#{user.nombres}" filterStyle="width: 80%;" >
                        <h:outputText value="#{user.nombres}"/>
                    </p:column>
                    <p:column headerText="Apellidos" style="text-align: center" filterBy="#{user.apellidos}" filterStyle="width: 80%;" >
                        <h:outputText value="#{user.apellidos}"/>
                    </p:column>   
                    <p:column headerText="Selecc." style="text-align: center;" width="60">
                        <p:commandButton icon="ui-icon-plusthick" style="height: 20px;" styleClass="btnStyle" actionListener="#{generarLiquidacionPH.agregarRepresentante(user)}" />                           
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
        
        <p:dialog widgetVar="dlgDocCarta" modal="true">
            <h:form>
                <p:fileUpload  fileUploadListener="#{generarLiquidacionPH.handleFileUploadCarta}" multiple="true" mode="advanced"
                               label="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar" 
                               skinSimple="true" sizeLimit="35000000" update="formGenLiqPH:dtCartaAdos, frmConf"
                               allowTypes="/(\.|\/)(png|jpg)$/" oncomplete="PF('dlgDocCarta').hide()" onstart="#{generarLiquidacionPH.emptyCartaAdos()}"/>

                <div align="center">
                    <p:commandButton id="AgrCarta" value="Aceptar" onclick="PF('dlgDocCarta').hide()" styleClass="btnStyle" style="height: 30px;"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog appendTo="@(body)" id="confSave" widgetVar="confCartaAdo" modal="true" height="150" width="350" position="center" resizable="false" closable="true" header="Guardar Liquidación Propiedad Horizontal.">
            <h:form id="frmConf">
                <p:outputLabel value="#{generarLiquidacionPH.mensaje}" style="font-weight: bold; font-size: 14px;" />
                <br/>
                <p:commandLink value="Adjuntar Carta" onclick="PF('dlgDocCarta').show();" rendered="#{generarLiquidacionPH.emptyCartaAdos()}" style="font-size: 14px;" >
                </p:commandLink>
                <br/>
                <br/>
                <center>
                    <p:outputLabel value="¿Desea Continuar?" style="font-weight: bold; font-size: 14px;"/>
                    <br/>
                    <p:commandButton value="Si" icon="ui-icon-check" oncomplete="PF('confCartaAdo').hide()" actionListener="#{generarLiquidacionPH.guardarProcesoReporte()}" style="height: 30px; " styleClass="btnStyle"/>
                    <p:commandButton value="No" icon="ui-icon-closethick" onclick="PF('confCartaAdo').hide()" style="height: 30px;" styleClass="btnStyle" type="button"/>
                </center>
            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>
