<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:poue="http://primefaces.org/ui/extensions"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">

   
    <ui:define name="page_title">
        Multas
    </ui:define>

    <ui:define name="top" >
        <h:panelGroup rendered="#{multasView.ht.id != null}">
            <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;font-size: 14px;" >
                <p:outputLabel value="Trámite: #{multasView.ht.id}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Tarea: #{multasView.taskDataByTaskID.name}" style="font-weight: bolder;color: #005f9c"/>
                <p:outputLabel value="Responsable: #{multasView.taskDataByTaskID.assignee}" style="font-weight: bolder;color: #005f9c"/>
            </p:panelGrid>
        </h:panelGroup>
    </ui:define>

    <ui:define name="content">
        <h:form id="frmMain">
            <p:tabView id="tvSolicitud">
                <p:tab title="Datos del permiso" rendered="#{multasView.permiso != null}">
                    <p:panelGrid style="width: 100%; margin-bottom: 15px;">
                        <p:row>
                            <p:column colspan="3">
                                <p:outputLabel value="SOLICITANTE: #{multasView.ht.solicitante.ciRuc} - #{multasView.entradas['solicitud'].solicitante.apellidos} #{multasView.entradas['solicitud'].solicitante.nombres} #{multasView.entradas['solicitud'].solicitante.razonSocial}"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel value="SOLICITUD: #{multasView.permiso.id}"/>
                            </p:column>
                            <p:column>
                                <p:outputLabel value="FECHA INGRESO: "/><p:outputLabel value="#{multasView.permiso.fechaEmision}"><f:convertDateTime pattern="dd/MM/yyyy"/></p:outputLabel>
                            </p:column>
                            <p:column>
                                <p:outputLabel value="PRIMERA VEZ: "/>
                                <p:selectBooleanCheckbox value="#{multasView.permiso.primeraVez}" disabled="true" style="margin-left: 15px; margin-top: 5px;"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="3">
                                <p:outputLabel value="CONTADOR: #{multasView.permiso.contador.nombreCompleto}"/>
                            </p:column>
                            
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel value="AFILIACIÓN: #{multasView.permiso.afiliacionCamara.descripcion}"/>
                            </p:column>
                            <p:column >
                                <p:outputLabel value="NO. DE TRABAJADORES: #{multasView.permiso.numTrabajadores}"/>
                            </p:column>
                            <p:column >
                                <p:outputLabel value="NO. DE DECLARACIÓN: #{multasView.permiso.numDeclaracion}"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <center>
                        <p:dataTable style="margin-bottom: 15px; width: 60%;" value="#{multasView.entradas['localComercialList']}" var="r" rows="5" emptyMessage="Sin datos...">
                            <f:facet name="header">
                                Local comercial
                            </f:facet>
                            <p:column headerText="Nombre del local" style="text-align: center;" width="20%">
                                <h:outputText value="#{r.nombreLocal}"/>
                            </p:column>
                            <p:column headerText="Propietario" style="text-align: center;" width="35%">
                                <h:outputText value="#{r.propietario.nombreCompleto}"/>
                            </p:column>
                            <p:column headerText="Num. del Local" style="text-align: center;" width="40%">
                                <h:outputText value="#{r.numLocal}"/>
                            </p:column>
                            <p:column headerText="Ubicación" style="text-align: center;" width="40%">
                                <h:outputText value="#{r.ubicacion.descripcion}"/>
                            </p:column>
                            <p:column headerText="Tipo de Local" style="text-align: center;" width="40%">
                                <h:outputText value="#{r.tipoLocal.descripcion}"/>
                            </p:column>
                        </p:dataTable>
                        
                        <p:panelGrid columns="1">
                            <p:row>
                                <p:column>
                                    <h:outputText value="Ingrese el valor de la multa: "/>
                                    <pe:inputNumber value="#{multasView.multa.valor}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="Estado del local comercial: "/>
                                    <center>
                                        <p:selectOneRadio id="sel2" value="#{multasView.permiso.localComercial.estadoLocalComercial}"  layout="grid" columns="1">
                                            <f:selectItem itemLabel="Habilitado" itemValue="1" />
                                            <f:selectItem itemLabel="Inhabilitado" itemValue="2" />
                                            <f:selectItem itemLabel="Clausurado" itemValue="3" />
                                        </p:selectOneRadio>
                                    </center>
                                </p:column>
                            </p:row>       
                            <p:row>
                                <p:column>
                                    <center>
                                        <p:commandButton value="Multar" update="frmObs" styleClass="btnStyle" actionListener="#{multasView.setMultar(true)}" onclick="PF('obs').show()"/>
                                        <p:commandButton value="No multar" update="frmObs" styleClass="btnStyle" actionListener="#{multasView.setMultar(false)}" onclick="PF('obs').show()"/>
                                    </center>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        
                    </center>
                </p:tab>
                
                <!-- -->
                
                <p:tab title="Ingreso de Multa" rendered="#{multasView.permiso == null and multasView.ht.id != null}">
                    <p:fieldset legend="SOLICITANTE DE LA DEMANDA" >
                        <p:panelGrid style="width: 80%;" styleClass="noBorder">
                            <p:row>
                                <p:column style="font-weight: bolder;">Nombres/Razon Social: 
                                    <p:inputText value="#{multasView.ht.nombrePropietario}" size="60" readonly="true" style="text-transform: uppercase"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:fieldset>
                    
                    <!-- -->
                    
                    <p:fieldset legend="INFRACTOR" >
                        <p:panelGrid style="width: 80%;" styleClass="noBorder">
                            <p:row>
                                <p:column style="width: 80%">
                                    <p:outputLabel value="CI/RUC: #{multasView.demandado.ciRuc} - Nombres: #{multasView.demandado.esPersona ? multasView.demandado.nombreCompleto : multasView.demandado.razonSocial}"/>
                                </p:column>
                                <p:column>
                                    <p:commandButton value="Buscar" update="formNewClient" styleClass="btnStyle" style="font-size: 13px;" icon="ui-icon-search" actionListener="#{multasView.showDlgEntes(1)}" />
                                </p:column>

                            </p:row>
                        </p:panelGrid>
                    </p:fieldset>
                    
                    <!-- -->
                    
                    <p:fieldset legend="MULTA" >
                        <p:panelGrid columns="1" style="width: 80%;">                            
                            <p:row>
                                <p:column>
                                    <center>
                                        <h:outputText value="Ingrese el valor de la multa: "/>
                                        <pe:inputNumber value="#{multasView.multa.valor}"/>
                                    </center>
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <center>
                                        <p:commandButton value="Multar" update="frmObs" actionListener="#{multasView.setMultar(true)}" styleClass="btnStyle" onclick="PF('obs').show()"/>
                                        <p:commandButton value="No multar" update="frmObs" actionListener="#{multasView.setMultar(false)}" styleClass="btnStyle" onclick="PF('obs').show()"/>
                                    </center>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:fieldset>
                </p:tab>
                
                <!-- -->
                
                <p:tab title="Datos de la multa" rendered="#{multasView.ht.id == null}">
                    <center>
                        <p:panelGrid  columns="2">
                            <p:panelGrid columns="2">
                                <h:outputText value="Multa a: " style="display: block;"/>
                                <p:selectOneMenu id="opts" value="#{multasView.tipoMulta}"  effect="fold"  style="width:180px;">
                                    <f:selectItem itemLabel="A ciudadano" itemValue="1" />  
                                    <f:selectItem itemLabel="A predio" itemValue="2" />  
                                    <f:selectItem itemLabel="A local comercial" itemValue="3" />
                                    <p:ajax update="frmMain" listener="#{multasView.inicializarVariables()}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>

                            <p:panelGrid columns="3" rendered="#{multasView.tipoMulta == 1}">
                                <h:outputText value="Número de Cédula" style="display: block;"/>
                                <p:inputText value="#{multasView.cedulaRuc}" style="display: block; margin: 0 auto;"/>
                                <p:commandButton update="frmMain" actionListener="#{multasView.buscarEnte()}" ajax="false" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" />
                            </p:panelGrid>
                            
                            <p:panelGrid columns="1" rendered="#{multasView.tipoMulta == 2}">
                                <p:commandButton value="Buscar Predio" actionListener="#{multasView.mostrarPredios()}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-search" >
                                    <p:ajax update="frmMain" event="dialogReturn" listener="#{multasView.seleccionarObject}" />
                                </p:commandButton>
                            </p:panelGrid>
                            
                            <p:panelGrid columns="1" rendered="#{multasView.tipoMulta == 3}">
                                <p:commandButton value="Buscar Local Comercial" actionListener="#{multasView.mostrarPredios()}" style="height: 30px;" styleClass="btnStyle" icon="ui-icon-search" >
                                    <p:ajax update="frmMain" event="dialogReturn" listener="#{multasView.seleccionarObject}" />
                                </p:commandButton>
                            </p:panelGrid>
                        </p:panelGrid>
                        
                        <!-- -->
                        
                        <p:panelGrid rendered="#{multasView.tipoMulta == 1 and multasView.enteEncontrado != null}">
                            <dialog:datosEntes  ente="#{multasView.enteEncontrado}"
                                                esPersona="#{multasView.enteEncontrado.esPersona}"
                                                buscar="false"
                                                header="Datos del Ente" 
                                                width="400"
                                                id="dte"/>
                            <center>
                                <p:panelGrid columns="1">
                                    <p:row>
                                        <p:column>
                                            <h:outputText value="Ingrese el valor de la multa: "/>
                                            <pe:inputNumber value="#{multasView.multa.valor}"/>
                                        </p:column>
                                    </p:row>                                
                                    <p:row>
                                        <p:column>
                                            <center>
                                                <p:commandButton value="Continuar" update="frmObs" onclick="PF('obs').show()"/>
                                                <p:commandButton value="Cancelar" ajax="false" actionListener="#{multasView.continuar()}"/>
                                            </center>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </center>
                        </p:panelGrid>
                        
                        <!-- -->
                        
                        <p:panelGrid rendered="#{multasView.tipoMulta == 2 and multasView.predio != null}">
                            <dialog:datosPredio  predio="#{multasView.predio}"
                                                buscar="false"
                                                header="Datos del Predio" 
                                                width="400"
                                                id="dte2"/>
                            <center>
                                <p:panelGrid columns="1">
                                    
                                    <p:row>
                                        <p:column>
                                            <h:outputText value="Ingrese el valor de la multa: "/>
                                            <pe:inputNumber value="#{multasView.multa.valor}"/>
                                        </p:column>
                                    </p:row>    
                                    
                                    
                                    
                                    <p:row>
                                        <p:column>
                                            <center>
                                                <p:commandButton value="Continuar" update="frmObs" onclick="PF('obs').show()"/>
                                                <p:commandButton value="Cancelar" ajax="false" actionListener="#{multasView.continuar()}"/>
                                            </center>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </center>
                        </p:panelGrid>
                        
                        <p:panelGrid rendered="#{multasView.tipoMulta == 3 and multasView.localComercial != null}">
                            <dialog:datosLocalComercial  local="#{multasView.localComercial}"
                                                buscar="false"
                                                header="Datos del local comercial" 
                                                width="400"
                                                id="dte3"/>
                            <center>
                                <p:panelGrid columns="1">
                                    <p:row>
                                        <p:column>
                                            <h:outputText value="Ingrese el valor de la multa: "/>
                                            <pe:inputNumber value="#{multasView.multa.valor}"/>
                                        </p:column>
                                    </p:row>
                                    
                                    <p:row>
                                        <p:column>
                                            <h:outputText value="Estado del local comercial: "/>
                                            <center>
                                                <p:selectOneRadio id="seleccion" value="#{multasView.localComercial.estadoLocalComercial}"  layout="grid" columns="1">
                                                    <f:selectItem itemLabel="Habilitado" itemValue="1" />
                                                    <f:selectItem itemLabel="Inhabilitado" itemValue="2" />
                                                    <f:selectItem itemLabel="Clausurado" itemValue="3" />
                                                </p:selectOneRadio>
                                            </center>
                                        </p:column>
                                    </p:row>  
                                    
                                    <p:row>
                                        <p:column>
                                            <center>
                                                <p:commandButton value="Continuar" update="frmObs" onclick="PF('obs').show()"/>
                                                <p:commandButton value="Cancelar" ajax="false" actionListener="#{multasView.continuar()}"/>
                                            </center>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </center>
                        </p:panelGrid>
                        
                    </center>
                    
                </p:tab>
                
                <p:tab title="Detalle trámite" rendered="#{multasView.ht.id != null}">
                    <dialog:detalleTareas archivos="#{multasView.listAttAttachmentByProcessInstance}"
                                  observaciones="#{multasView.ht.observacionesCollection}" />
                </p:tab>
            </p:tabView>
        </h:form>
        
        <!-- -->
        
        <p:dialog id="dlgObs" widgetVar="obs" header="Observación de la multa" appendTo="@(body)" modal="true" width="500" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmObs">
                <p:panel id="pobs" header="Ingrese sus observaciones" style="width: 100%">
                    
                    <div align="center">
                        <p:inputTextarea id="obsservacion" value="#{multasView.entradas['obs'].observacion}" rows="4" style="width: 100%; text-transform: uppercase" required="true" placeholder="Las observaciones son obligatorias para continuar con el tramite"/>
                        <br/>
                        <p:commandButton id="btnValidar" value="Continuar" actionListener="#{multasView.completarTarea()}" rendered="#{multasView.ht.id == null}" oncomplete="PF('obs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>
                        <p:commandButton id="btnValidar2" value="Continuar" actionListener="#{multasView.completarTareaFlujo()}" rendered="#{multasView.ht.id != null}" oncomplete="PF('obs').hide()" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px"/>                        
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>
        
        <!-- -->
        
        <p:dialog id="dlgNuevoCliente" header="Infractor" widgetVar="dlgNewClient" modal="true" resizable="false" closeOnEscape="false" position="center">
            <h:form  id="formNewClient">
                <p:panelGrid styleClass="noBorder" style="width: 100%">
                    <p:row>
                        <p:column style="text-align: right"><p:outputLabel value="Tipo Persona:" style="font-weight: bolder"/></p:column>
                        <p:column>
                            <p:selectOneMenu value="#{multasView.tipoEnte}" style="width: 160px;">
                                <f:selectItem itemLabel="Natural" itemValue="1" />
                                <f:selectItem itemLabel="Jurídica" itemValue="2" />
                                <p:ajax update="tabNewEnte"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:tabView id="tabNewEnte" style="width: 520px;height: 400px">
                    <p:tab title="Datos Principales">
                        <p:panelGrid styleClass="noBorder" style="width: 100%">
                            <p:row>
                                <p:column colspan="4">
                                    <p:outputLabel value="NOTA: CAMPOS OBLIGATORIOS (*)" style="font-weight: bolder;color: #0033FF"/>
                                </p:column>
                            </p:row>
                            
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{multasView.tipoEnte==1?'(*)Cédula:':multasView.tipoEnte==2?'(*)R.U.C.:':multasView.tipoEnte==3?'(*)Identificación:':''}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:inputText value="#{multasView.demandado.ciRuc}" rendered="#{multasView.tipoEnte==1 or multasView.tipoEnte==2}">
                                        <p:ajax event="blur" listener="#{multasView.existeCedula()}" update="formNewClient"/>
                                    </p:inputText>
                                    <p:inputText readonly="true" value="Lo asigna el sistema" disabled="#{multasView.tipoEnte==3}" rendered="#{multasView.tipoEnte==3}"/>
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="Fec. Nacimiento:" rendered="#{multasView.tipoEnte==1 or managedEnte.tipoEnte==3}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Fec. Constitución:" rendered="#{multasView.tipoEnte==2}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:calendar value="#{multasView.demandado.fechaNacimiento}" placeholder="DÍA-MES-AÑO" maxdate="sysdate" pattern="dd-MM-yyyy" mask="true" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Nombres:" rendered="#{multasView.tipoEnte==1 or (multasView.tipoEnte==3 and !multasView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="(*)Razón Social:" rendered="#{multasView.tipoEnte==2 or (multasView.tipoEnte==3 and multasView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{multasView.demandado.nombres}" rendered="#{multasView.tipoEnte==1 or (multasView.tipoEnte==3 and !multasView.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{multasView.demandado.razonSocial}" rendered="#{multasView.tipoEnte==2 or (multasView.tipoEnte==3 and multasView.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Apellidos:" rendered="#{multasView.tipoEnte==1 or (multasView.tipoEnte==3 and !multasView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Nombre Comercial:" rendered="#{multasView.tipoEnte==2 or (multasView.tipoEnte==3 and multasView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{multasView.demandado.apellidos}" rendered="#{multasView.tipoEnte==1 or (multasView.tipoEnte==3 and !multasView.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{multasView.demandado.nombreComercial}" rendered="#{multasView.tipoEnte==2 or (multasView.tipoEnte==3 and multasView.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Dirección:" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{multasView.demandado.direccion}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:tab>
                </p:tabView>
                <div align="center">
                    <p:commandButton value="Guardar" icon="ui-icon-disk" update="frmMain" onclick="PF('dlgNewClient').hide()"/>
                </div>
            </h:form>
        </p:dialog>
        
        <!-- -->
        
        <dialog:dialogNumLiquidacion id="numTra" actionButton="#{multasView.continuar()}" headerDialog="Información de Tramite"
                                     desc="" idLiq="Número: #{multasView.ht.id}"/>
        
        
        
    </ui:define>
</ui:composition>