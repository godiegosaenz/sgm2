<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dlg="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="head">
        <!--<script src="../../resources/pfJs/keyPress.js" type="text/javascript"></script>-->
    </ui:define>
    <ui:define name="content">
        <div align="center">
            <h2>Gestion de predios</h2>
        </div>
        <h:form id="frmMain">

            <div align="center">
                <p:panelGrid layout="grid" columns="2" style="width: 40%" rendered="#{fichaPredial.editable and appConfig.mainConfig.fichaPredial.mostrarPorcentajeEdificacion}">
                    <h:outputText value="Propiedad Horizontal"/>
                    <p:inputSwitch value="#{gestionFicha.ph}" offLabel="No" onLabel="Si" label="Propiedad Horizontal">
                        <p:ajax listener="#{gestionFicha.habPh()}" update="frmMain"/>
                    </p:inputSwitch>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnBuscarMatriz" value="Buscar Matriz" actionListener="#{gestionFicha.listarPredios()}" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-search" iconPos="right" rendered="#{gestionFicha.busqueda}">
                                <p:ajax event="dialogReturn" listener="#{gestionFicha.seleccionarPredio}" update="frmMain,:frmPh" oncomplete="PF('dlgph').show()"/>
                            </p:commandButton>
                        </div>
                    </f:facet>
                </p:panelGrid>
            </div>
            <p:panel id="pnormal" header="Datos Prediales" style="width: 100%">
                <p:panelGrid layout="grid" columns="4" style="width: 100%">
                    <h:outputText value="Matricula Inmobiliaria" style="font-weight: bolder"/>
                    <h:outputText value="#{gestionFicha.predio.numPredio}"/>
                    <h:outputText value="Ficha Registral " style="font-weight: bolder"/>
                    <p:inputText type="number" value="#{gestionFicha.predio.numeroFicha}"/>
                </p:panelGrid>
                <p:dataList value="#{gestionFicha.parroquias}" var="pq1" paginatorAlwaysVisible="false" paginatorPosition="top"
                            paginator="true" rows="8">
                    <f:facet name="header">
                        Descripcion de Codigo de Parroquias
                    </f:facet>
                    #{pq1.codigoParroquia}, #{pq1.descripcion}
                </p:dataList>
                <p:fieldset legend="Codigo Catastral" toggleable="true">
                    <p:outputLabel value="Es nueva Manzana?" /> <p:spacer width="10"/>
                    <p:selectBooleanCheckbox id="isNuevaMz" value="#{gestionFicha.isNuevaManzana}">
                        <p:ajax update=":frmMain:isNuevaMz"/>
                    </p:selectBooleanCheckbox>
                    <p:panelGrid style="margin-top:20px" >
                        <f:facet name="header">
                            <p:row>
                                <p:column>
                                    <p:outputLabel for="provincia"  value="Provincia" styleClass="DispBlock Wid100" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:outputLabel for="canton"  value="Cantón" styleClass="DispBlock Wid100" style="font-weight: bolder"/>
                                </p:column>
                                <p:column><p:outputLabel for="parroquia"  value="Parroquia" styleClass="DispBlock Wid100" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel for="zona"  value="Zona" styleClass="DispBlock Wid100" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel for="sector"  value="Sector" styleClass="DispBlock Wid100" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel for="mz"  value="Mz" styleClass="DispBlock Wid100" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel for="lote"  value="Lote" styleClass="DispBlock Wid100" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel value="Bloque"  style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel value="Piso" style="font-weight: bolder"/></p:column>
                                <p:column><p:outputLabel value="Unidad" style="font-weight: bolder"/></p:column>
                            </p:row>
                        </f:facet>
                        <p:row>
                            <p:column>
                                <p:inputText id="provincia" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="provincia : #{gestionFicha.predio.provincia}" maxlength="2" value="#{gestionFicha.predio.provincia}" style="text-align: center; width: 86%"  required="true"/>
                            </p:column>
                            <p:column>
                                <p:inputText id="canton" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Canton : #{gestionFicha.predio.canton}" maxlength="2" value="#{gestionFicha.predio.canton}" style="text-align: center; width: 86%"  required="true" />
                            </p:column>
                            <p:column>
                                <p:inputText id="parroquia" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"    title="Parroquia : #{gestionFicha.predio.parroquia}" maxlength="2" value="#{gestionFicha.predio.parroquia}" style="text-align: center; width: 86%"  required="true">
                                    <p:ajax update=":frmMain:parroquia"/>
                                </p:inputText>
                            </p:column>
                            <p:column>
                                <p:inputText id="zona" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Zona : #{gestionFicha.predio.zona}" maxlength="2" value="#{gestionFicha.predio.zona}"  style="text-align: center; width: 86%" required="true">    
                                    <p:ajax update=":frmMain:zona"/>
                                </p:inputText>
                            </p:column>
                            <p:column rendered="#{!appConfig.mainConfig.fichaPredial.libertad}">
                                <p:inputText id="sector" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Sector : #{gestionFicha.predio.sector}" maxlength="2" value="#{gestionFicha.predio.sector}"  style="text-align: center; width: 86%" required="true" >
                                    <p:ajax update=":frmMain:sector :frmMain:lote :frmMain:mz" listener="#{gestionFicha.eventManzanaBySector(gestionFicha.predio)}"/>
                                </p:inputText>
                            </p:column>
                            <p:column rendered="#{appConfig.mainConfig.fichaPredial.libertad}">
                                <p:inputText id="sectorLibertad" placeholder="000" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Sector : #{gestionFicha.predio.sector}" maxlength="3" value="#{gestionFicha.predio.sector}"  style="text-align: center; width: 86%" required="true" >    
                                    <p:ajax update=":frmMain:sectorLibertad"/>
                                </p:inputText>
                            </p:column>                            
                            <p:column>
                                <p:inputText id="mz" placeholder="000" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Mz : #{gestionFicha.predio.mz}" maxlength="3" value="#{gestionFicha.predio.mz}"  style="text-align: center; width: 86%" required="true">
                                    <p:ajax update=":frmMain:lote :frmMain:mz" listener="#{gestionFicha.getLastSolarPredioInManzana(gestionFicha.predio)}" /> 
                                </p:inputText>

                            </p:column>
                            <p:column>
                                <p:inputText id="lote" placeholder="000" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Lote : #{gestionFicha.predio.solar}" maxlength="3"  value="#{gestionFicha.predio.solar}" style="text-align: center; width: 86%" required="true" />
                            </p:column>
                            <p:column>
                                <p:inputText id="bloque" placeholder="000" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Bloque : #{gestionFicha.predio.bloque}"  maxlength="3" value="#{gestionFicha.predio.bloque}" style="text-align: center; width: 86%"/>
                            </p:column>
                            <p:column>
                                <p:inputText id="piso" placeholder="00" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Piso : #{gestionFicha.predio.piso}"  maxlength="2" value="#{gestionFicha.predio.piso}"  style="text-align: center; width: 86%"/>
                            </p:column>
                            <p:column>
                                <p:inputText id="Unidad" placeholder="000" onkeypress="validateIntegerValueAndFocusNext(event, '')"   title="Unidad : #{gestionFicha.predio.unidad}"  maxlength="3" value="#{gestionFicha.predio.unidad}" style="text-align: center; width: 86%" />
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                </p:fieldset>
                <p:fieldset legend="Datos Complementarios" toggleable="true">
                    <p:panelGrid layout="grid" columns="4" style="width: 100%">
                        <p:outputLabel for="predio_tipo"  value="Espacio Urbano :" styleClass="DispBlock Wid100" style="font-weight: bolder"/>
                        <p:selectOneMenu id="predio_tipo" value="#{gestionFicha.predio.tipoConjunto}" required="true" effect="fade" converter="entityConverter">
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                            <f:selectItems value="#{gestionFicha.tiposConjunto}" var="tconj" itemLabel="#{tconj.nombre}" itemValue="#{tconj}"/>
                            <p:ajax update=":frmMain:ciudadela" />
                        </p:selectOneMenu>
                        <p:outputLabel for="ciudadela" value="Ciudadela/Urbanización" styleClass="DispBlock Wid100" />
                        <p:selectOneMenu id="ciudadela" value="#{gestionFicha.predio.ciudadela}" effect="fade" required="true" converter="entityConverter" filter="true" filterMatchMode="contains">
                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                            <f:selectItems value="#{gestionFicha.ciudadelas}" var="cx" itemLabel="#{cx.nombre}" itemValue="#{cx}"/>
                        </p:selectOneMenu>
                        <!--                        <h:outputText value="Sector Homogeneo de Valor"/>
                                                <p:selectOneMenu id="subsector" value="# {gestionFicha.predio.subsector}" var="sv" converter="entityConverter" style="width: 80%"
                                                                 label="subsector" requiredMessage="El campo subsector es obligatorio" filter="true" filterMatchMode="contains">
                                                    <f:selectItem itemLabel="Elija un subsector" itemValue="# {null}"/>
                                                    <f:selectItems var="sbs" value="# {gestionFicha.subsectores}" itemLabel="# {sbs.sector} - # {sbs.detalle}" itemValue="# {sbs}"/>
                                                    <p:column style="width:20%">
                                                        <h:outputText styleClass="# {sv.sector}" />
                                                    </p:column>
                                                    <p:column style="width:60%">
                                                        <h:outputText value="# {sv.detalle}" />
                                                    </p:column>
                                                </p:selectOneMenu> -->
                        <h:outputText value="Nombre Predio"/>
                        <p:inputText id="secUrb" value="#{gestionFicha.predio.nombreEdificio}" />
                    </p:panelGrid>
                </p:fieldset>

                <div align="center">
                    <p:commandButton value="Guardar" style="font-size: 15px; font-weight: bolder;"
                                     styleClass="btnStyle" icon="ui-icon-disk" type="submit"
                                     actionListener="#{gestionFicha.registrar()}" update=":frmMain :frmEstatus" rendered="#{!gestionFicha.busqueda}"/>
                </div>

            </p:panel>
        </h:form>
        <p:dialog id="dlgMatricula" widgetVar="dlgMatricula" header="Matricula inmobiliaria" width="350" height="150" closable="true" closeOnEscape="false" resizable="false">
            <h:form id="frmEstatus">
                <div align="center">
                    <p:panelGrid style="width: 100%" layout="grid" columns="1">
                        <h:outputText value="MATRICULA INMOBILIARIA " style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.numPredio}" style="font-weight: bolder; color: #0066cc"/>
                        <f:facet name="footer">
                            <div align="center">
                                <p:commandButton id="btnContinuar" value="Continuar" actionListener="#{gestionFicha.continuar()}" update="frmMain" oncomplete="PF('dlgMatricula').hide()"/>
                            </div>
                        </f:facet>
                    </p:panelGrid>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgph" widgetVar="dlgph" header="Datos de la propiedad horizontal" modal="true" width="80%" height="550" closable="true" closeOnEscape="false" resizable="true">
            <h:form id="frmPh">
                <div align="center">
                    <p:panelGrid id="pgPagre" style="width: 80%" layout="grid" columns="2">
                        <f:facet name="header">
                            <h:outputText value="Datos del predio Matriz" style="font-weight: bolder; color: #000;"/>
                        </f:facet>
                        <h:outputText value="Matricula Inmobiliaria" style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.numPredio}"/>
                        <h:outputText value="Clave catastral" style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.claveCat}"/>
                        <h:outputText value="Ubicacion " style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.ciudadela.nombre}"/>
                        <h:outputText value="Subsector " style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.subsector.sector} - #{gestionFicha.predio.subsector.detalle}"/>
                        <h:outputText value="Area solar " style="font-weight: bolder;"/>
                        <h:outputText value="#{gestionFicha.predio.areaSolar}"/>
                    </p:panelGrid>
                    <center>
                        <h:outputText value="Bloque " style="font-weight: bolder;"/>
                        <p:inputText type="number" value="#{gestionFicha.predio.bloque}" maxlength="3"/>
                        <p:spacer width="10"/>
                        <h:outputText value="# Pisos " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="verticales" value="#{gestionFicha.maxv}" maxlength="3"/>
                    </center>
                    <p:panelGrid style="width: 80%" layout="grid" columns="4">
                        <f:facet name="header" >
                            <h:outputText value="Especificaciones de la propiedad horizontal" style="font-weight: bolder; color: #000;"/>
                        </f:facet>
                        <h:outputText value="# Departamentos por piso " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="depts" value="#{gestionFicha.maxh}" maxlength="3"/>
                        <h:outputText value="# Bodegas por piso " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="bodegas" value="#{gestionFicha.bod}" maxlength="3"/>
                        <h:outputText value="# Parqueos por piso " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="parqueo" value="#{gestionFicha.pq}" maxlength="3"/>
                        <h:outputText value="# Locales Comerciales " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="locComer" value="#{gestionFicha.locComer}" maxlength="3"/>
                        <h:outputText value="# Otros " style="font-weight: bolder;"/>
                        <p:inputText type="number" id="otros" value="#{gestionFicha.otros}" maxlength="3"/>
                        <f:facet name="footer">
                            <div align="center">
                                <p:commandButton id="btnContinuar" value="Procesar" actionListener="#{gestionFicha.crearAlicuotas()}" update="tprops"/>
                            </div>
                        </f:facet>
                    </p:panelGrid>
                    <p:tabView id="tprops" style="width: 100%">
                        <p:tab id="verticales" title="Cuadro de alicuotas">
                            <p:dataTable id="dtVerticales" value="#{gestionFicha.verticales}" var="v" paginator="true" rows="10" rowsPerPageTemplate="10,15" paginatorPosition="top"
                                         editable="true" editMode="cell" widgetVar="ev" rowIndexVar="index">
                                <p:ajax event="cellEdit" listener="#{gestionFicha.onCellEdit}" update="dtVerticales" />
                                <p:column headerText="Codigo">
                                    <h:outputText value="#{v.sector}-#{v.mz}-#{v.solar}-#{v.bloque}-#{v.piso}-#{v.unidad}"/>
                                </p:column>
                                <p:column headerText="Piso">
                                    <h:outputText value="#{v.phv}" />
                                </p:column>
                                <p:column headerText="Unidad">
                                    <h:outputText value="#{v.phh}" />
                                </p:column>
                                <p:column headerText="Descripción">
                                    <h:outputText value="#{v.nombreEdificio}" />
                                </p:column>
                                <p:column headerText="% Alicuota">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{v.alicuotaUtil}" /></f:facet>
                                        <f:facet name="input"><p:inputText id="valic" value="#{v.alicuotaUtil}" style="width:96%"/></f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Num. Departamento">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{v.numDepartamento}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{v.numDepartamento}" style="width:96%"/></f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column  headerText="Inhabilitar" style="width: 10%; text-align: center">
                                    <p:selectBooleanCheckbox id="crear" value="#{v.crear}"/>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                    <div align="center">
                        <!--<p:commandButton id="btnGenerarPH" value="Validar Propiedad" icon="ui-icon-check" oncomplete="PF('dlgSubirDocumento').show()" update=":frmSubirDocumentosDialog"/>-->
                        <p:commandButton value="Validar Propiedad"
                                         process="@all" actionListener="#{gestionFicha.registrarPH()}" update=":frmResultado"  />
                    </div>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgResultado" widgetVar="dlgResultado" header="Propiedades Horizontales" modal="true" appendTo="@(body)" closable="true" width="50%" resizable="false">
            <h:form id="frmResultado">
                <p:dataTable id="dtResultado" value="#{gestionFicha.resultado}" var="r" paginator="true" rows="20" resizeMode="true" paginatorPosition="top">
                    <p:column headerText="Matricula">
                        <h:outputText value="#{r.numPredio}"/>
                    </p:column>
                    <p:column headerText="Solar">
                        <h:outputText value="#{r.solar}"/>
                    </p:column>
                    <p:column headerText="Alicuota">
                        <h:outputText value="#{r.alicuotaUtil}"/>
                    </p:column>
                    <p:column headerText="PHV">
                        <h:outputText value="#{r.phv}"/>
                    </p:column>
                    <p:column headerText="PHH">
                        <h:outputText value="#{r.phh}"/>
                    </p:column>
                    <p:column headerText="Descripcion">
                        <h:outputText value="#{r.numDepartamento}"/>
                    </p:column>
                    <f:facet name="footer">
                        <div align="center">
                            <p:commandButton id="btnSalir" value="Cerrar" actionListener="#{gestionFicha.salirPH()}"/>
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgSubirDocumento" header="Antes de Continuar debe de Subir Documentos"
                  height="300" width="500" responsive="true" closable="true" closeOnEscape="true"
                  modal="true" appendTo="@(body)" >

            <h:form id="frmSubirDocumentosDialog">
                <!--<p:panelGrid columns="8">-->
                <p:outputLabel value="SELECCIONE PDF DE DECLARATORIA DE PROPIEDAD HORINZONTAL"/>
                <p:fileUpload fileUploadListener="#{gestionFicha.handleFileDocumentBySave}" dragDropSupport="false"
                              multiple="false"
                              mode="advanced"
                              uploadLabel="Subir"
                              cancelLabel="Cancelar"
                              label="Seleccionar"
                              skinSimple="true"
                              sizeLimit="350000000" styleClass="btnStyle"
                              sequential="true"
                              fileLimit="10" allowTypes="/(\.|\/)(pdf)$/" />
                <center>
                    <p:commandButton value="Aceptar"
                                     process="@all" actionListener="#{gestionFicha.registrarPH()}" update=":frmResultado"  />
                </center>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>