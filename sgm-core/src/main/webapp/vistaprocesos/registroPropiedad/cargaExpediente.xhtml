<ui:composition
    template="/template/template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:samdoc="http://xmlns.jcp.org/jsf/composite/samdoc">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{cargaExpediente.doPreRenderView()}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="top"><h3>Carga de Documentos Repositorio</h3></ui:define>
    <ui:define name="content">
        <h:form id="mainForm">
            <p:dataTable id="dtMovimientos" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" 
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{cargaExpediente.movsLazy}" var="mov" emptyMessage="No se encontró ningún Item."
                         style="text-align: center;" filterEvent="enter" resizableColumns="true">
                <p:column headerText="Libro" filterBy="#{mov.libro.nombre}" filterStyle="width: 95%">
                    <h:outputText  value="#{mov.libro.nombre}"/>
                </p:column>
                <p:column headerText="No Insc." filterBy="#{mov.numInscripcion}" filterStyle="width: 95%" sortBy="#{mov.numInscripcion}" width="100">
                    <h:outputText value="#{mov.numInscripcion}"/>
                </p:column>
                <p:column headerText="No Rep."  filterBy="#{mov.numRepertorio}" filterStyle="width: 95%" sortBy="#{mov.numRepertorio}" width="100">
                    <h:outputText value="#{mov.numRepertorio}"/>
                </p:column>
                <p:column headerText="Tomo"  filterBy="#{mov.numTomo}" filterStyle="width: 95%" sortBy="#{mov.numTomo}" width="100">
                    <h:outputText value="#{mov.numTomo}"/>
                </p:column> 
                <p:column headerText="Folio" filterBy="#{mov.folioInicio}" sortBy="#{mov.folioInicio}" width="100" filterStyle="width: 90%">
                    <h:outputText value="#{mov.folioInicio}"/>
                </p:column>
                <p:column headerText="Fec.Inscripcion" sortBy="#{mov.fechaInscripcion}" width="100">
                    <h:outputText value="#{mov.fechaInscripcion}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </p:column>    
                <p:column headerText="Info." width="50">
                    <p:commandLink actionListener="#{cargaExpediente.showDlgMovSelect(mov)}">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Carga" width="50">
                    <p:commandLink actionListener="#{cargaExpediente.cargarDocumentoInscripcion(mov)}">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>   
                    </p:commandLink>
                </p:column>
            </p:dataTable>
            <!--<p:fieldset legend="Parametros de Carga">
                <p:panelGrid styleClass="noBorder" columns="7">
                    Libro:
                    <p:selectOneMenu value="# {cargaExpediente.libro}" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="# {null}" />  
                        <f:selectItems value="# {cargaExpediente.libros}" var="libro" itemLabel="# {libro.nombre}" itemValue="# {libro}"/>  
                    </p:selectOneMenu>
                    Fecha Inscripcion:
                    <p:calendar value="# {cargaExpediente.fecha}" pattern="dd/MM/yyyy" placeholder="dd/MM/yyyy" maxdate="sysdate"/>
                    No Tomo:
                    <pe:inputNumber value="# {cargaExpediente.tomo}" decimalPlaces="0"/>
                    <p:commandButton value="Validar" icon="ui-icon-check" styleClass="btnStyle" actionListener="# {cargaExpediente.carga()}"/>
                    No Inscripcion:
                    <pe:inputNumber value="# {cargaExpediente.inscripcion}" decimalPlaces="0"/>
                    Folio Inicial:
                    <pe:inputNumber value="# {cargaExpediente.folioInicio}" decimalPlaces="0"/>
                    Folio Final:
                    <pe:inputNumber value="# {cargaExpediente.folioFin}" decimalPlaces="0"/>
                    <p:commandButton value="Nueva Carga" icon="ui-icon-refresh" styleClass="btnStyle" actionListener="# {cargaExpediente.refreshPage()}"/>
                </p:panelGrid>
            </p:fieldset>-->
        </h:form>
        <!--<h:panelGroup id="panelUpload">
            <samdoc:upload id="uploadDoc" rendered="# {cargaExpediente.show}"
                       nombreLibro="# {cargaExpediente.libro.nombreCarpeta}" 
                       anioInscripcion="# {cargaExpediente.anio}" 
                       numeroTomo="# {cargaExpediente.tomo}" 
                       folioInicial="# {cargaExpediente.folioInicio}" 
                       folioFinal="# {cargaExpediente.folioFin}" 
                       numeroInscripcion="# {cargaExpediente.inscripcion}" 
                       respuesta="# {cargaExpediente.respuesta}" 
                       subidaListener="# {cargaExpediente.cargaDocumento()}" 
                       />
        </h:panelGroup>-->


        <p:dialog id="dlgMovimientoRegistral" header="Movimiento Registral Seleccionado" widgetVar="dlgMovRegSelec" 
                  resizable="false" modal="true" closeOnEscape="true" width="800" height="550">
            <h:form id="formMovRegSelec">
                <p:fieldset legend="Datos de la Inscripcion">
                    <p:panelGrid styleClass="noBorder" style="width: 100%;font-size: 12px;font-weight: bolder;">
                        <p:row>
                            <p:column>
                                Num.Inscrip.:
                                <p:outputLabel value="#{cargaExpediente.movimiento.numInscripcion}"/>
                            </p:column>
                            <p:column>
                                Fecha Inscrip.:
                                <p:outputLabel value="#{cargaExpediente.movimiento.fechaInscripcion}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column>
                                Num.Rep.: 
                                <p:outputLabel  value="#{cargaExpediente.movimiento.numRepertorio}"/>
                            </p:column>
                        </p:row>                  
                        <p:row>
                            <p:column>
                                Libro: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.libro.nombre}"/>
                            </p:column>
                            <p:column colspan="2">
                                Acto: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.acto.nombre}"/>
                            </p:column>
                        </p:row>                  
                        <p:row>
                            <p:column>
                                Tomo: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.numTomo}"/>
                            </p:column>
                            <p:column>
                                Folio Inicio: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.folioInicio}"/>
                            </p:column>
                            <p:column>
                                Folio Fin: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.folioFin}"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                Canton: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.codigoCan.nombre}"/>
                            </p:column>
                            <p:column>
                                Fech/Otorg.:
                                <p:outputLabel value="#{cargaExpediente.movimiento.fechaOto}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column>
                                Not./Juz.: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.enteJudicial.nombre}"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                Escri/Juicio/Resolu: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.escritJuicProvResolucion}"/>
                            </p:column>
                            <p:column>
                                Estado/Mov: 
                                <p:outputLabel value="#{cargaExpediente.movimiento.estado}"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                </p:fieldset>
                <p:tabView>
                    <p:tab title="Intervinientes">
                        <p:dataTable emptyMessage="No hay datos para mostrar..." var="inter" scrollable="true" 
                                     value="#{cargaExpediente.modelo.listMovCli}" scrollHeight="240">
                            <p:column headerText="C.I/R.U.C" style="text-align: center" width="15%">
                                <p:outputLabel value="#{inter.enteInterv.cedRuc}"/>
                                <!-- <p:outputLabel value="# {inter.ente.catEntePersona.ci}" rendered="# {inter.ente.isPersona}"/> -->
                            </p:column>
                            <p:column headerText="Nombre del Cliente" style="text-align: center">
                                <p:outputLabel value="#{inter.enteInterv.nombre}"/>
                                <!-- <p:outputLabel value="# {inter.ente.catEntePersona.nombres} # {inter.ente.catEntePersona.apellidos}" rendered="# {inter.ente.isPersona}"/> -->
                            </p:column>
                            <p:column headerText="Papel" style="text-align: center" width="20%">
                                <p:outputLabel value="#{inter.papel.papel}"/>
                            </p:column>
                            <p:column headerText="Domicilio" style="text-align: center">
                                <p:outputLabel value="#{inter.domicilio.nombre}"/>
                            </p:column>
                            <p:column headerText="Estado" style="text-align: center">
                                <p:outputLabel value="#{inter.estado}"/>
                            </p:column>
                            <p:column headerText="Relacion" style="text-align: center">
                                <p:outputLabel value="#{inter.nombres}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Bienes">
                        <p:dataTable value="#{cargaExpediente.modelo.fichas}" var="fich" style="width: 100%;text-align: center" scrollable="true" 
                                     scrollHeight="250" rowIndexVar="rowIndex" emptyMessage="No se encontraron elementos...">
                            <p:column headerText="No" width="60">
                                #{rowIndex+1}
                            </p:column>
                            <p:column headerText="Num. Ficha" width="100">
                                <p:outputLabel value="#{fich.numFicha}"/>
                            </p:column>
                            <p:column headerText="Tipo Ficha">
                                <p:outputLabel value="#{fich.tipo.nombre}"/>
                            </p:column>
                            <p:column headerText="Codigo Predial">
                                <p:outputLabel value="#{fich.codigoPredial}"/>
                            </p:column>
                            <p:column headerText="Fec.Apertura" width="100">
                                <p:outputLabel value="#{fich.fechaApe}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Observacion">
                        <p:inputTextarea value="#{cargaExpediente.movimiento.observacion}" readonly="true"
                                         autoResize="false" scrollHeight="200" style="width: 100%; height: 250px"/>
                    </p:tab>
                    <p:tab title="Referencia(s)">
                        <p:dataTable style="text-align: center;width: 100%" scrollable="true" scrollHeight="250" scrollWidth="1000" rowIndexVar="indexMovRef"
                                     value="#{cargaExpediente.modelo.listMovRef}" var="movRef" 
                                     emptyMessage="Movimiento sin referencia(s)." resizableColumns="true">
                            <p:column headerText="No" width="30">
                                #{indexMovRef+1}
                            </p:column>
                            <p:column headerText="Libro">
                                <p:outputLabel value="#{movRef.movimientoReff.libro.nombre}"/>
                            </p:column>
                            <p:column headerText="Acto">
                                <p:outputLabel value="#{movRef.movimientoReff.acto.nombre}"/>
                            </p:column>
                            <p:column headerText="Inscripcion" width="100">
                                <p:outputLabel value="#{movRef.movimientoReff.numInscripcion}"/>                                   
                            </p:column>
                            <p:column headerText="Repertorio" width="100">
                                <p:outputLabel value="#{movRef.movimientoReff.numRepertorio}"/>                                   
                            </p:column>
                            <p:column headerText="Folio" width="100">
                                <p:outputLabel value="#{movRef.movimientoReff.folioInicio}"/>                                   
                            </p:column>
                            <p:column headerText="Fec.Inscripcion" width="110">
                                <p:outputLabel value="#{movRef.movimientoReff.fechaInscripcion}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>                                   
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Descarga">
                        <iframe src="#{samdocUploadCompUtil.samdocUrl}#{cargaExpediente.urlDownload}"></iframe>
                    </p:tab>
                </p:tabView>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="dlgDigitalizacion" header="Subir Inscripcion" modal="true" resizable="false" position="center">
            <samdoc:upload id="uploadDoc"
                           nombreLibro="#{cargaExpediente.movimiento.libro.nombreCarpeta}" 
                           anioInscripcion="#{cargaExpediente.anio}" 
                           numeroTomo="#{cargaExpediente.movimiento.numTomo}" 
                           folioInicial="#{cargaExpediente.movimiento.folioInicio}" 
                           folioFinal="#{cargaExpediente.movimiento.folioFin}" 
                           numeroInscripcion="#{cargaExpediente.movimiento.numInscripcion}" 
                           respuesta="#{cargaExpediente.respuesta}" 
                           subidaListener="#{cargaExpediente.respuestaCargaDocumento()}" 
                           />
        </p:dialog>


    </ui:define>
</ui:composition>