<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    template="/template/template.xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{liquidacionesIngresadasRp.doPreRenderView()}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="top"><h3>Liquidaciones Ingresadas</h3></ui:define>
    <ui:define name="content">
        <h:form id="mainForm">
            <p:dataTable id="dtLiquidaciones" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" 
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{liquidacionesIngresadasRp.liquidacionesLazy}" var="liq" emptyMessage="No se encontró ningún Item."
                         style="text-align: center" filterEvent="enter">
                <p:column headerText="Num. Trámite" width="120" filterBy="#{liq.numTramiteRp}" sortBy="#{liq.numTramiteRp}">
                    <p:outputLabel value="#{liq.numTramiteRp}"/>
                </p:column>
                <p:column headerText="Num. Seguimiento" width="150" filterBy="#{liq.historicTramite.id}">
                    <p:outputLabel value="#{liq.historicTramite.id}"/>
                </p:column>
                <p:column headerText="Beneficiario" filterStyle="width: 75%" filterBy="#{liq.historicTramite.nombrePropietario}">
                    <p:outputLabel value="#{liq.historicTramite.nombrePropietario}"/>
                </p:column>
                <p:column headerText="Fecha Liq." sortBy="#{liq.fecha}" width="120">
                    <p:outputLabel value="#{liq.fecha}"><f:convertDateTime pattern="dd-MM-yyyy HH:mm"/></p:outputLabel>
                </p:column>
                <p:column headerText="Tickets" width="60">
                    <p:commandLink actionListener="#{liquidacionesIngresadasRp.dlgImprimirReport(liq)}">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Detalle" width="60">
                    <p:commandLink actionListener="#{liquidacionesIngresadasRp.visualizarDatos(liq)}">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Editar" width="60" rendered="#{liquidacionesIngresadasRp.showEdit}">
                    <p:commandLink actionListener="#{liquidacionesIngresadasRp.editarLiquidacion(liq)}" disabled="#{liq.estado != 1}">
                        <p:graphicImage value="/css/homeIconsImages/edit.png"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Ingresar" width="60" rendered="#{liquidacionesIngresadasRp.showIn}">
                    <p:commandLink actionListener="#{liquidacionesIngresadasRp.showDlgIngresoTramite(liq)}" disabled="#{liq.estado != 1}">
                        <p:graphicImage value="/css/homeIconsImages/ir.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="ReAsig." width="60" rendered="#{liquidacionesIngresadasRp.showIn}">
                    <p:commandLink actionListener="#{liquidacionesIngresadasRp.showDlgReAsignarUser(liq)}" disabled="#{liq.estado == 1}">
                        <p:graphicImage value="/css/homeIconsImages/user.png" height="16"/>
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>

        <p:dialog id="dlgImprimirDocs" header="Imprimir Documentos Liquidacion" widgetVar="dlgImprimir" modal="true"
                  resizable="false" closeOnEscape="true" >
            <h:form id="formImprimir">
                <p:panelGrid styleClass="noBorder">
                    <p:row>
                        <p:column style="text-align: center" colspan="3">
                            <p:outputLabel value="Número de Seguimiento: #{liquidacionesIngresadasRp.ht.id}" 
                                           style="font-weight: bolder;font-size: 16px"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column style="text-align: center" colspan="3">
                            <p:outputLabel value="Seleccione el Documento a imprimir..." style="font-weight: bolder"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:commandButton value="Ticket" actionListener="#{liquidacionesIngresadasRp.imprimirTicket()}"
                                             styleClass="btnStyle" icon="ui-icon-document"/>
                        </p:column>
                        <p:column>
                            <p:commandButton value="Preforma" actionListener="#{liquidacionesIngresadasRp.imprimirPreforma()}"
                                             styleClass="btnStyle" icon="ui-icon-document"/>
                        </p:column>
                        <p:column>
                            <p:commandButton value="Acuerdo" actionListener="#{liquidacionesIngresadasRp.imprimirAcuerdo()}"
                                             styleClass="btnStyle" icon="ui-icon-document"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="3" style="text-align: center">
                            <p:spacer height="20"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="3" style="text-align: center">
                            <p:commandButton value="CERRAR" oncomplete="PF('dlgImprimir').hide();"
                                             styleClass="btnStyle" icon="ui-icon-close" iconPos="s"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgVerInfo" header="Informacion de Tramite" widgetVar="dlgVerInfoRp" resizable="false"
                  closeOnEscape="true" modal="true" width="600" height="500">
            <h:form id="formInformLiq">
                <p:tabView>
                    <p:tab title="Liquidacion">
                        <p:panelGrid styleClass="noBorder" style="width: 100%;font-weight: bolder;">
                            <p:row>
                                <p:column>
                                    Num. Tramite:
                                </p:column>
                                <p:column>
                                    #{liquidacionesIngresadasRp.liq.numTramiteRp}
                                </p:column>
                                <p:column>
                                    Num. Seguimiento:
                                </p:column>
                                <p:column>
                                    #{liquidacionesIngresadasRp.ht.id}
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    CI/RUC Solicitante:
                                </p:column>
                                <p:column>
                                    #{liquidacionesIngresadasRp.ht.solicitante.ciRuc}
                                </p:column>
                                <p:column>
                                    Fecha Liq.:
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="#{liquidacionesIngresadasRp.liq.fecha}" style="font-weight: bolder;">
                                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm"/>
                                    </p:outputLabel>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Solicitante:
                                </p:column>
                                <p:column colspan="3">
                                    <p:outputLabel value="#{liquidacionesIngresadasRp.ht.solicitante.nombres} #{liquidacionesIngresadasRp.ht.solicitante.apellidos}" style="font-weight: bolder" rendered="#{liquidacionesIngresadasRp.ht.solicitante.esPersona}"/>
                                    <p:outputLabel value="#{liquidacionesIngresadasRp.ht.solicitante.razonSocial}" style="font-weight: bolder" rendered="#{!liquidacionesIngresadasRp.ht.solicitante.esPersona}"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Beneficiario:
                                </p:column>
                                <p:column colspan="3">
                                    #{liquidacionesIngresadasRp.ht.nombrePropietario}
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Correos:
                                </p:column>
                                <p:column colspan="3">
                                    #{liquidacionesIngresadasRp.ht.correos}
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Telefonos:
                                </p:column>
                                <p:column colspan="3">
                                    #{liquidacionesIngresadasRp.ht.telefonos}
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Valor Liq.:
                                </p:column>
                                <p:column colspan="3">
                                    <p:outputLabel value="$ #{liquidacionesIngresadasRp.liq.totalPagar} (CANCELADO)" rendered="#{liquidacionesIngresadasRp.estadoPago == 1}" style="font-weight: bolder"/>
                                    <p:outputLabel value="$ #{liquidacionesIngresadasRp.liq.totalPagar} (NO CANCELADO)" rendered="#{liquidacionesIngresadasRp.estadoPago == 2}" style="font-weight: bolder"/>
                                    <p:outputLabel value="INACTIVO"  rendered="#{liquidacionesIngresadasRp.estadoPago == 3}" style="font-weight: bolder"/>
                                    <p:outputLabel value="EXONERADO DE PAGO" rendered="#{liquidacionesIngresadasRp.estadoPago == 4}" style="font-weight: bolder"/>
                                    <p:outputLabel value="ERROR" rendered="#{liquidacionesIngresadasRp.estadoPago == 5}" style="font-weight: bolder"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid><br/>
                        <p:dataTable value="#{liquidacionesIngresadasRp.liq.regpLiquidacionDetallesCollection}" emptyMessage="Sin elementos..."
                                     var="det" scrollable="true" scrollHeight="150" style="text-align: center;width: 99%">
                            <p:column headerText="Cantidad" width="70">
                                <p:outputLabel value="#{det.cantidad}"/>
                            </p:column>
                            <p:column headerText="Actos de Liquidacion" >
                                <p:outputLabel value="#{det.acto.nombre}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Inf. Adicional">
                        <p:dataTable value="#{liquidacionesIngresadasRp.trabajos}" emptyMessage="Sin tareas realizadas." rowIndexVar="indice"
                                     var="tra" scrollable="true" scrollHeight="380" style="text-align: center;width: 99%">
                            <f:facet name="header">
                                Certificados o Inscripciones Realizadas
                            </f:facet>
                            <p:column headerText="No" width="30">
                                <p:outputLabel value="#{indice+1}"/>
                            </p:column>
                            <p:column headerText="Detalle">
                                <p:outputLabel value="#{tra.observacion}"/>
                            </p:column>
                            <p:column headerText="Fecha y hora" width="150">
                                <p:outputLabel value="#{tra.fechaFin}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Tareas">
                        <p:dataTable value="#{liquidacionesIngresadasRp.tareas}" emptyMessage="El tramite no ha sido ingresado."
                                     var="tarea" scrollable="true" scrollHeight="400" style="text-align: center;width: 99%">
                            <p:column headerText="Nombre Tarea">
                                <p:outputLabel value="#{tarea.name}"/>
                            </p:column>
                            <p:column headerText="Usuario" width="100">
                                <p:outputLabel value="#{tarea.assignee eq null? liquidacionesIngresadasRp.usuariosCandidatos(tarea.id) :tarea.assignee}"/>
                            </p:column>
                            <p:column headerText="Fech.Inicio" width="120">
                                <p:outputLabel value="#{tarea.createTime}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"    />
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Fech.Fin" width="120">
                                <p:outputLabel value="#{tarea.endTime}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"    />
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Observaciones">
                        <p:dataTable value="#{liquidacionesIngresadasRp.ht.observacionesCollection}" emptyMessage="Sin elementos..."
                                     var="obs" scrollable="true" scrollHeight="400" style="text-align: center;width: 99%">
                            <p:column headerText="Tarea" width="150">
                                <p:outputLabel value="#{obs.tarea}"/>
                            </p:column>
                            <p:column headerText="Observacion">
                                <p:outputLabel value="#{obs.observacion}"/>
                            </p:column>
                            <p:column headerText="Usuario" width="100">
                                <p:outputLabel value="#{obs.userCre}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Documentos">
                        <dialog:detalleArchivosAct archivos="#{liquidacionesIngresadasRp.listAttach}" />
                    </p:tab>
                </p:tabView>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgIngresoTramite" header="Ingreso Tramite" widgetVar="dlgIngreso" resizable="false"
                  closeOnEscape="true" modal="true">
            <h:form id="formConfirmIngreso">
                <p:panelGrid styleClass="noBorder">
                    <p:row>
                        <p:column colspan="2" style="text-align: center">
                            <p:outputLabel value="Confirmacion de Ingreso de Tramite." 
                                           style="font-weight: bolder;color: #0033FF;font-size: 18px"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Numero de Tramite:" style="font-weight: bolder;color: #0033FF;font-size: 14px"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="#{liquidacionesIngresadasRp.liq.numTramiteRp}"
                                           style="font-size: 14px"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Numero de Seguimiento:" style="font-weight: bolder;color: #0033FF;font-size: 14px"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="#{liquidacionesIngresadasRp.ht.id}" style="font-size: 14px"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Beneficiario:" style="font-weight: bolder;color: #0033FF;font-size: 14px"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="#{liquidacionesIngresadasRp.ht.nombrePropietario}" style="font-size: 14px"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="text-align: center">
                            <p:commandButton value="Aceptar" icon="ui-icon-check" styleClass="btnStyle" disabled="#{liquidacionesIngresadasRp.disable}"
                                             actionListener="#{liquidacionesIngresadasRp.ingresarTramite()}"/>
                            <p:spacer width="30" height="1"/>
                            <p:commandButton value="Cancelar" icon="ui-icon-cancel" styleClass="btnStyle"
                                             oncomplete="PF('dlgIngreso').hide();"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgReasignarTarea" header="ReAsiganar Tarea" widgetVar="dlgReasignar" resizable="false"
                  closeOnEscape="true" modal="true" width="500">
            <h:form id="formreasignar">
                <p:panelGrid styleClass="noBorder" style="font-weight: bolder;font-size: 12px">
                    <p:row>
                        <p:column>
                            *No Tramite:
                        </p:column>
                        <p:column>
                            #{liquidacionesIngresadasRp.ht.numTramiteXDepartamento}
                        </p:column>
                        <p:column>
                            *No Seguimiento:
                        </p:column>
                        <p:column>
                            #{liquidacionesIngresadasRp.ht.id}
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            *Tarea Actual:
                        </p:column>
                        <p:column>
                            #{liquidacionesIngresadasRp.tareaActual.name}
                        </p:column>
                        <p:column>
                            *Usuario Actual:
                        </p:column>
                        <p:column>
                            #{liquidacionesIngresadasRp.tareaActual.assignee}
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:dataTable value="#{liquidacionesIngresadasRp.users}" emptyMessage="Sin elementos..." scrollHeight="350" scrollable="true"
                             var="usuario" style="text-align: center;" rendered="#{liquidacionesIngresadasRp.showUsers}">
                    <p:column headerText="Usuario">
                        <p:outputLabel value="#{usuario.usuario}"/>
                    </p:column>
                    <p:column headerText="Nombre">
                        <p:outputLabel value="#{usuario.ente.nombres}"/>
                    </p:column>
                    <p:column headerText="Selec." width="50">
                        <p:commandLink actionListener="#{liquidacionesIngresadasRp.reasignarTarea(usuario)}">
                            <p:graphicImage value="/css/homeIconsImages/ok.png" height="16"/>
                            <p:confirm header="Confirmacion" message="Reasignar tarea?" icon="ui-icon-alert"/>
                        </p:commandLink>
                    </p:column>
                    <p:confirmDialog global="true">
                        <p:commandButton value="SI" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="NO" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </p:dataTable>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>

