<ui:composition
    template="/template/template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{tareasDinardap.doPreRenderView()}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="content">
        <h:form id="mainForm">
            <p:panelGrid styleClass="noBorder" style="width: 100%">
                <p:outputLabel value="Solicitudes SINE - DINARDAP" style="font-size: 24px;"/>
                <p:commandButton value="Nueva Solicitud" icon="ui-icon-plus" style="float: right" styleClass="btnStyle" actionListener="#{tareasDinardap.showDlgIngreso()}"/>
            </p:panelGrid>
            <p:dataTable id="dtTareasDinardap" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" resizableColumns="true"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{tareasDinardap.tareasLazy}" var="tar" emptyMessage="Sin elementos..." filterEvent="enter" style="text-align: center;"
                         rowStyleClass="#{!tar.realizado ? 'orange' : null}">
                <p:column headerText="No.Solicitud" filterBy="#{tar.numeroSolicitud}" filterStyle="width: 95%">
                    <p:outputLabel value="#{tar.numeroSolicitud}"/>
                </p:column>
                <p:column headerText="Institucion Solicitante" filterBy="#{tar.institucion}" filterStyle="width: 95%">
                    <p:outputLabel value="#{tar.institucion}"/>
                </p:column>
                <p:column headerText="Usuario Solicitante" filterBy="#{tar.solicitante}" filterStyle="width: 95%">
                    <p:outputLabel value="#{tar.solicitante}"/>
                </p:column>
                <p:column headerText="Fecha Ing." width="100" sortBy="#{tar.fecha}">
                    <p:outputLabel value="#{tar.fecha}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:outputLabel>
                </p:column>
                <p:column headerText="Estado" width="100" sortBy="#{tar.realizado}">
                    <p:outputLabel value="FINALIZADO" rendered="#{tar.realizado}"/>
                    <p:outputLabel value="PENDIENTE" rendered="#{!tar.realizado}"/>
                </p:column>
                <p:column headerText="Docs." width="50">
                    <p:commandLink actionListener="#{tareasDinardap.showDocsTarea(tar)}">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Detalle" width="60">
                    <p:commandLink actionListener="#{tareasDinardap.showDetalleTarea(tar)}">
                        <p:graphicImage value="/css/homeIconsImages/detalle.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Tareas" width="60">
                    <p:commandLink actionListener="#{tareasDinardap.showDlgTareas(tar)}">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>

        <p:dialog widgetVar="dlgDetalle" header="Informacion de Solicitud" modal="true" resizable="false" 
                  position="center" width="600" height="350">
            <h:form id="formDetalleTarea">
                <p:panelGrid styleClass="noBorder" columns="2" style="font-size: 12px;font-weight: bolder;">
                    No Solicitud:
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.numeroSolicitud}"/>
                    Institucion Solicitante:
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.institucion}"/>
                    Usuario Solicitante
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.solicitante}"/>
                    Usuario Ingreso:
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.usuario}"/>
                    Estado:
                    <p:outputLabel value="FINALIZADO" rendered="#{tareasDinardap.tareaDinardap.realizado}"/>
                    <p:outputLabel value="PENDIENTE" rendered="#{!tareasDinardap.tareaDinardap.realizado}"/>
                    Fecha Ingreso:
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.fecha}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                    </p:outputLabel>
                    Fecha Fin:
                    <p:outputLabel value="#{tareasDinardap.tareaDinardap.fechaFin}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                    </p:outputLabel>
                    Observacion:
                    <p:inputTextarea value="#{tareasDinardap.tareaDinardap.observacion}" cols="70" autoResize="false"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgIngresoTarea" header="Ingreso de Solicitud" modal="true" resizable="false" 
                  position="center" width="600">
            <h:form id="formInfoTarea">
                <p:tabView id="tabInfoTarea" style="height: 300px;">
                    <p:tab title="Informacion">
                        <p:panelGrid styleClass="noBorder" columns="2" style="font-weight: bolder;">
                            No de Solicitud:
                            <p:inputText value="#{tareasDinardap.tareaDinardap.numeroSolicitud}" size="70"/>
                            Institucion Solicitante:
                            <p:inputText value="#{tareasDinardap.tareaDinardap.institucion}" size="70"/>
                            Usuario Solicitante:
                            <p:inputText value="#{tareasDinardap.tareaDinardap.solicitante}" size="70"/>
                            Observacion:
                            <p:inputTextarea value="#{tareasDinardap.tareaDinardap.observacion}" cols="70" autoResize="false"/>
                        </p:panelGrid>
                    </p:tab>
                    <p:tab title="Documento">
                        <p:fileUpload fileUploadListener="#{tareasDinardap.handleFileUpload}"
                                      label="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar"
                                      update="messages,dtArchivos"
                                      mode="advanced" dragDropSupport="false" multiple="true" sizeLimit="1000000000"
                                      allowTypes="#{tareasDinardap.formatoArchivos}"/>
                        <p:growl id="messages" showDetail="true"/>
                        <p:dataTable id="dtArchivos" value="#{tareasDinardap.files}" emptyMessage="Sin elementos..."
                                     style="text-align: center" scrollable="true" scrollHeight="150" var="docs">
                            <p:column headerText="Nombre">
                                <p:outputLabel value="#{docs.nombre}"/>
                            </p:column>
                            <p:column headerText="Tipo">
                                <p:outputLabel value="#{docs.tipo}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView><br/>
                <center>
                    <p:commandButton value="Guardar Solicitud" icon="ui-icon-disk" styleClass="btnStyle" actionListener="#{tareasDinardap.guardarSolicitud()}"
                                     disabled="#{tareasDinardap.realizado}">
                        <p:confirm header="Confirmacion" message="Seguro de Guardar Solicitud?" icon="ui-icon-alert"/>
                    </p:commandButton>
                    <p:confirmDialog global="true">
                        <p:commandButton value="SI" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="NO" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                    <p:spacer width="30" height="1"/>
                    <p:commandButton value="Aceptar" icon="ui-icon-check" styleClass="btnStyle" disabled="#{!tareasDinardap.realizado}"
                                     actionListener="#{tareasDinardap.aceptarSolicitud()}"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgTareas" header="Tareas de Solicitud" modal="true" resizable="false" position="center"
                  width="600">
            <h:form id="formTareas">
                <p:panelGrid styleClass="noBorder" style="width: 100%;">
                    <p:row rendered="#{!tareasDinardap.tareaDinardap.realizado}">
                        <p:column style="text-align: right;">
                            <p:selectOneMenu value="#{tareasDinardap.opcion}">
                                <f:selectItem itemLabel="Seleccionar..." itemValue="#{0}" />
                                <f:selectItem itemLabel="Realizar Inscripcion" itemValue="#{1}" />
                                <f:selectItem itemLabel="Realizar Certificado Word" itemValue="#{2}" />
                                <f:selectItem itemLabel="Imprimir Ficha Registral" itemValue="#{3}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column>
                            <p:commandButton value="Agregar" icon="ui-icon-plus" styleClass="btnStyle"
                                             actionListener="#{tareasDinardap.crearTarea()}"/>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{tareasDinardap.showIns}">
                        <p:column colspan="2">
                            <p:dataTable value="#{tareasDinardap.listInsc}" var="ins" scrollable="true" scrollHeight="150"
                                         rowIndexVar="indInsc" style="text-align: center;">
                                <f:facet name="header">Tareas de Inscripcion</f:facet>
                                <p:column headerText="Detalle">
                                    #{ins.observacion}
                                </p:column>
                                <p:column headerText="Tarea" width="60">
                                    <p:graphicImage value="/css/homeIconsImages/ok.png" height="16" rendered="#{ins.realizado}"/>
                                    <p:graphicImage value="/css/homeIconsImages/delete.png" height="16" rendered="#{!ins.realizado}"/>
                                </p:column>
                                <p:column headerText="Accion" width="60">
                                    <p:commandLink actionListener="#{tareasDinardap.redirecTarea(ins, 1)}" disabled="#{ins.realizado}">
                                        <p:graphicImage value="/css/homeIconsImages/ir.png" height="16"/>   
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{tareasDinardap.showCer}">
                        <p:column colspan="2">
                            <p:dataTable value="#{tareasDinardap.listCert}" var="cer" scrollable="true" scrollHeight="150"
                                         rowIndexVar="indCert" style="text-align: center;">
                                <f:facet name="header">Tareas de Certificados</f:facet>
                                <p:column headerText="Detalle">
                                    #{cer.observacion}
                                </p:column>
                                <p:column headerText="Tarea" width="60">
                                    <p:graphicImage value="/css/homeIconsImages/ok.png" height="16" rendered="#{cer.realizado}"/>
                                    <p:graphicImage value="/css/homeIconsImages/delete.png" height="16" rendered="#{!cer.realizado}"/>
                                </p:column>
                                <p:column headerText="Accion" width="60">
                                    <p:commandLink actionListener="#{tareasDinardap.redirecTarea(cer, 2)}" disabled="#{cer.realizado}">
                                        <p:graphicImage value="/css/homeIconsImages/ir.png" height="16"/>   
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{!tareasDinardap.tareaDinardap.realizado}">
                        <p:column colspan="2" style="text-align: center;">
                            <p:commandButton value="Finalizar Solicitud" icon="ui-icon-flag" styleClass="btnStyle" actionListener="#{tareasDinardap.finalizarSolicitud()}">
                                <p:confirm header="Confirmacion" message="Seguro de Finalizar Solicitud?" icon="ui-icon-alert"/>
                            </p:commandButton>
                            <p:confirmDialog global="true">
                                <p:commandButton value="SI" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                <p:commandButton value="NO" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </p:confirmDialog>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgDocumentos" header="Documentos de la Solicitud" modal="true" resizable="false" 
                  position="center" width="600">
            <h:form id="formDocumentos">
                <center>
                    <p:outputLabel value="No Solicitud: #{tareasDinardap.tareaDinardap.numeroSolicitud}" style="font-weight: bolder;font-size: 14px;"/>
                    <p:dataTable value="#{tareasDinardap.tareaDinardap.regpTareasDinardapDocs}" var="docs" scrollable="true" scrollHeight="200"
                                 style="text-align: center;" emptyMessage="Esta Tarea no tiene Documentos Adjuntos.">
                        <p:column headerText="Nombre Documento">
                            #{docs.nombreDoc}
                        </p:column>
                        <p:column headerText="Desc." width="50">
                            <p:commandLink actionListener="#{tareasDinardap.descargarDocumento(docs)}">
                                <p:graphicImage value="/css/homeIconsImages/down.png" height="16"/>   
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </center>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>