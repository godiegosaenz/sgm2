<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="content">
        <center>
            <h1>Informes Para Resolución</h1>
        </center>
        <h:form id="mainForm">
            <p:panel header="DATOS">
                <p:panelGrid style="margin: 0 auto; width: 95%;">
                    <p:row>
                        <p:column><p:outputLabel value="Tipo Tramite:" style="font-weight: bold;"/></p:column>
                        <p:column>
                            <p:selectOneMenu  value="#{informesResoluciones.tramiteResolucion}" effect="fade" converter="entityConverter">
                                <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                                <f:selectItems value="#{informesResoluciones.catalogoTramitesResolucion.ctlgItemCollection}" var="t" itemLabel="#{t.valor}" itemValue="#{t}"/>  
                            </p:selectOneMenu>
                        </p:column>
                        <p:column><p:outputLabel value="Observacion:" style="font-weight: bold;"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column><p:outputLabel value="Nombre Solicitante:" style="font-weight: bold;"/></p:column>
                        <p:column><p:inputText value="#{informesResoluciones.solicitante}" size="80" style="font-size: 14px;"/></p:column>
                        <p:column rowspan="3"><p:inputTextarea value="#{informesResoluciones.observacion}" cols="50" rows="4" style="font-size: 14px;"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column><p:outputLabel value="Numero de Memorandum:" style="font-weight: bold;"/></p:column>
                        <p:column><p:inputText value="#{informesResoluciones.memorandum}" size="80" style="font-size: 14px;"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column><p:outputLabel value="Numero de Memo Solicitante:" style="font-weight: bold;"/></p:column>
                        <p:column><p:inputText value="#{informesResoluciones.memoSolicitante}" size="80" style="font-size: 14px;"/></p:column>
                    </p:row>
                </p:panelGrid>
            </p:panel>
            <p:tabView id="tvInforme">
                <p:tab title="PREDIO URBANO" titleStyle="font-size: 14px;">
                    <div align="right">
                        <p:commandButton value="REPORTE" actionListener="#{informesResoluciones.generarInforme(1)}" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-print"/>
                        <p:commandButton value="LIMPIAR" actionListener="#{informesResoluciones.limpiarTablas()}" update="prediosUrbanos" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-trash" iconPos="right"/>
                    </div>
                    <dialog:consultaCodigoPredial id="consulta" tipoConsulta="#{informesResoluciones.tipoConsultaUrbano}"
                                                  updateConsulta="consulta, mainForm:tvInforme:prediosUrbanos"
                                                  predioModel="#{informesResoluciones.predioModel}"
                                                  renderContribuyente="false"
                                                  consultarEmisiones="#{informesResoluciones.consultarPredioUrbano()}"
                                                  tipoPredio="true"
                                                  renderConsultaDirecta="false"/>
                    
                    <br/>
                    <p:dataTable id="prediosUrbanos" value="#{informesResoluciones.prediosUrbanos}" var="urbano" rowKey="#{urbano.id}"  scrollHeight="350" lazy="true" reflow="true" rows="20" paginator="true" emptyMessage=""
                                 rowsPerPageTemplate="20,50,100" paginatorPosition="top" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <p:column headerText="Matricula Inmobiliaria" width="100"><p:outputLabel value="#{urbano.numPredio}"/></p:column>
                        <p:column headerText="Cod. Catastral"><p:outputLabel value="#{urbano.codigoPredialCompleto}"/></p:column>
                        <p:column headerText="Dirección"><p:outputLabel value="#{urbano.ciudadela.nombre}-#{urbano.urbMz}/#{urbano.urbSolarnew}"/></p:column>
                        <p:column headerText="Propietario"><p:outputLabel value="#{urbano.nombrePropietarios}"/></p:column>
                        <p:column headerText="Eliminar" style="text-align: center;" width="100"><p:commandLink update="prediosUrbanos" actionListener="#{informesResoluciones.eliminarPredioUrbano(urbano)}"><p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/></p:commandLink></p:column>
                    </p:dataTable>
                </p:tab>
                <p:tab title="PREDIO RURAL" titleStyle="font-size: 14px;" >
                    <div align="right">
                        <p:commandButton value="REPORTE" actionListener="#{informesResoluciones.generarInforme(2)}" style="float: right; font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-print"/>
                        <p:commandButton value="LIMPIAR" actionListener="#{informesResoluciones.limpiarTablas()}" update="prediosRurales" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" icon="ui-icon-trash" iconPos="right"/>
                    </div>
                    
                    <dialog:consultaCodigoPredial id="consultaRural" tipoConsulta="#{informesResoluciones.tipoConsultaUrbano}"
                                                  updateConsulta="consultaRural, mainForm:tvInforme:prediosRurales"
                                                  predioModel="#{informesResoluciones.predioModel}"
                                                  renderContribuyente="false"
                                                  ciudadelas="#{informesResoluciones.parroquiasRurales}"
                                                  consultarEmisiones="#{informesResoluciones.consultarPredioRural()}"
                                                  tipoPredio="false"
                                                  renderConsultaDirecta="false"/>
                    <br/>
                    <p:dataTable id="prediosRurales" value="#{informesResoluciones.prediosRurales}" var="rural" rowKey="#{rural.id}"  scrollHeight="350" lazy="true" reflow="true" rows="20" emptyMessage="" paginator="true"
                                 rowsPerPageTemplate="20,50,100" paginatorPosition="top" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <p:column headerText="Reg. Catastral"><p:outputLabel value="#{rural.regCatastral}"/></p:column>
                        <p:column headerText="Id Predial"><p:outputLabel value="#{rural.idPredial}"/></p:column>
                        <p:column headerText="Parroquia"><p:outputLabel value="#{rural.parroquia.descripcion}"/></p:column>
                        <p:column headerText="Propietario"><p:outputLabel value="#{rural.propietario.nombres} #{rural.propietario.apellidos} #{rural.propietario.razonSocial}"/></p:column>
                        <p:column headerText="Sitio"><p:outputLabel value="#{rural.sitio}"/></p:column>
                        <p:column headerText="Nombre"><p:outputLabel value="#{rural.nombrePredio}"/></p:column>
                        <p:column headerText="Eliminar" style="text-align: center;" width="100"><p:commandLink update="prediosRurales" actionListener="#{informesResoluciones.eliminarPredioRural(rural)}"><p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/></p:commandLink></p:column>
                    </p:dataTable>
                </p:tab>
            </p:tabView>
        </h:form>

        <p:dialog header="Listado de Predios - Seleccione Predio" widgetVar="dlgPrediosConsulta" appendTo="@(body)" width="90%" responsive="true" closable="true" closeOnEscape="true" modal="true" position="top">
            <h:form id="frmPredios">
                <p:dataTable value="#{informesResoluciones.prediosUrbanosConsulta}" var="p" selection="#{informesResoluciones.prediosUrbanosConsultaSeleccionados}" rowKey="#{p.id}" style="width: 90%; margin: 0 auto;" reflow="true" paginator="true" rows="15" filterEvent="enter" paginatorPosition="top">
                    <p:column selectionMode="multiple" style="width:30px;text-align:center"/>
                    <p:column headerText="No. Predio" sortBy="#{p.numPredio}" filterBy="#{p.numPredio}" filterMatchMode="exact" filterStyle="width: 95%;"><h:outputText value="#{p.numPredio}"/></p:column>
                    <p:column headerText="Urbanizacion" filterBy="#{p.ciudadela.nombre}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.ciudadela.nombre}"/></p:column>
                    <p:column headerText="Mz" filterBy="#{p.urbMz}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.urbMz}"/></p:column>
                    <p:column headerText="Sl" filterBy="#{p.urbSolarnew}" filterMatchMode="contains" filterStyle="width: 95%;"><h:outputText value="#{p.urbSolarnew}"/></p:column>
                    <p:column headerText="Cod. Predial"><h:outputText value="#{p.codigoPredialCompleto}"/></p:column>
                    <f:facet name="footer">
                        <p:commandButton value="Seleccionar" actionListener="#{informesResoluciones.seleccionarPredio(1)}" update="mainForm:tvInforme:prediosUrbanos"/>
                    </f:facet>
                </p:dataTable>         
            </h:form>
        </p:dialog>

        <script>
            jQuery.extend(jQuery.expr[':'], {
                focusable: function (el, index, selector) {
                    return $(el).is('a, button, :input, [tabindex]');
                }
            });

            $(document).on('keypress', 'input,select', function (e) {
                if (e.which == 13) {
                    e.preventDefault();
                    // Get all focusable elements on the page
                    var $canfocus = $(':focusable');
                    var index = $canfocus.index(this) + 1;
                    if (index >= $canfocus.length)
                        index = 0;
                    $canfocus.eq(index).focus().select();
                }
            });
        </script>
    </ui:define>
</ui:composition>
