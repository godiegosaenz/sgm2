<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">
        <div align="center">
            <h1>Listado de Titulos Prediales Emitidos</h1>
        </div>
        <h:form id="mainForm">



            <p:dataTable id="dtPagos" reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20, 50,100" paginatorPosition="top" style="text-align: center;"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{titulosPrediales.liquidacionesLazy}" var="liquidacion" selection="#{titulosPrediales.liquidacionseleccionadas}" 
                         emptyMessage="No se encontraron elementos..." rowKey="#{liquidacion.id}" filterEvent="enter">

                <f:facet name="header">
                    <p:commandButton value="Anular Emisiones Seleccionadas"  oncomplete="PF('dlgAnular').show()" />
<!--                                     rendered="#{titulosPrediales.session.name_user eq 'lcagua'}"/>-->
                </f:facet>
                <!--                <p:column headerText="Detalle" width="60" style="text-align: center;">
                    <p:commandLink actionListener="#{pagosRealizados.verPago(p)}" title="#{p.numComprobante}" oncomplete="PF('dlgPago').show();" update="formPago">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                    </p:commandLink>
                </p:column>-->
                <p:column selectionMode="multiple" style="width:4%;text-align:center"  />
<!--                          rendered="#{titulosPrediales.session.name_user eq 'lcagua'}"/>-->
                <p:column headerText="*" style="width: 25px; text-align:center">
                    <p:graphicImage value="/image/circleGreen.png" height="12" rendered="#{liquidacion.estadoLiquidacion.id eq 1 ? true : false}" title="#{emision.estadoLiquidacion.descripcion}"/>
                    <p:graphicImage value="/image/circleRed.png" height="12" rendered="#{liquidacion.estadoLiquidacion.id eq 2 ? true : false}" title="#{emision.estadoLiquidacion.descripcion}"/>
                    <p:graphicImage value="/image/circleOrange.png" height="12" rendered="#{liquidacion.estadoLiquidacion.id eq 4 ? true : false}" title="#{emision.estadoLiquidacion.descripcion}"/>
                </p:column>
                <p:column headerText="Clave Catastral">
                    <p:outputLabel value="#{liquidacion.predioRustico.regCatastral}" rendered="#{liquidacion.tipoLiquidacion.id eq 7}"  />
                    <p:outputLabel value="#{liquidacion.predio.claveCat}" rendered="#{liquidacion.tipoLiquidacion.id eq 13}"   />
                    <p:outputLabel value="#{liquidacion.claveAME}" rendered="#{liquidacion.predio.id eq null}"   />
                </p:column> 
                <p:column headerText="Mat. Inmobiliaria" filterBy="#{liquidacion.predio.numPredio}">
                    <p:outputLabel value="#{liquidacion.predio.numPredio}" />
                </p:column> 
                <p:column headerText="Comprobante" filterBy="#{numComprobante}" sortBy="#{numComprobante}" filterStyle="width: 95%;"><p:outputLabel value="#{liquidacion.numComprobante}" style="font-weight: bold; font-size: 13px;"/></p:column>
                <p:column headerText="Id-Liquidacion"  filterBy="#{liquidacion.idLiquidacion}"  filterStyle="width: 95%;"><p:outputLabel value="#{liquidacion.idLiquidacion}" style="font-weight: bold;"/></p:column>


                <p:column headerText="AÃ±o" filterBy="#{liquidacion.anio}"  filterStyle="width: 95%;"><p:outputLabel value="#{liquidacion.anio}"/></p:column>
                <p:column headerText="C.I / RUC" filterBy="#{liquidacion.comprador.ciRuc}">
                    <p:outputLabel value="#{liquidacion.comprador.ciRuc}"/>
                </p:column>
                <p:column headerText="Contribuyente">
                    <p:outputLabel value="#{liquidacion.comprador==null?liquidacion.nombreComprador :liquidacion.comprador.nombreCompleto}"/>
                </p:column>
                <p:column headerText="Avaluo" style="text-align: center;" width="100">
                    <h:outputText value="#{liquidacion.avaluoMunicipal}">
                        <f:convertNumber pattern="$ #,##0.00" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Emision" style="text-align: center;" width="100">
                    <h:outputText value="#{liquidacion.totalPago}">
                        <f:convertNumber pattern="$ #,##0.00" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Observaciones">
                    <p:outputLabel value="#{liquidacion.observacion}"/>
                </p:column>
                <p:column headerText="Imprimir" width="65" style="text-align: center;">
                    <p:commandLink  rendered="#{liquidacion.estadoLiquidacion.id eq 4 ? true : false}" actionListener="#{titulosPrediales.generarComprobante(liquidacion)}" title="#{liquidacion.idLiquidacion}">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>
                    </p:commandLink>
                </p:column>
                <p:column headerText="Agregar Valor CEM" width="65" style="text-align: center;">
                    <p:commandLink rendered="#{liquidacion.estadoLiquidacion.id eq 2 ? true : false}" actionListener="#{titulosPrediales.openDialogCem(liquidacion)}" title="#{liquidacion.idLiquidacion}">
                        <p:graphicImage value="/css/homeIconsImages/add_edificacion.png" height="16"/>
                    </p:commandLink>
                </p:column>

            </p:dataTable>
        </h:form>

        <p:dialog widgetVar="dlgAddCem" header="Agregar Valor de CEM" 
                  height="200" width="250" responsive="true" closable="true" closeOnEscape="true" 
                  modal="true" appendTo="@(body)" >

            <h:form id="frmCEMValor">
                <center>
                    <h:panelGrid columns="1">
                        <h:panelGroup layout="block">
                            <p:outputLabel value="CEM Parques y Plazas" style="text-align: center; font-weight: bolder"/><br/>
                            <p:inputText value="#{titulosPrediales.cemParquesPlazas}" style="text-align: center; "/>
                        </h:panelGroup>
                        <h:panelGroup layout="block">
                            <p:outputLabel value="CEM Alcantarillados" style="text-align: center; font-weight: bolder"/><br/>
                            <p:inputText value="#{titulosPrediales.cemAlcantarillado}" style="text-align: center; " />
                        </h:panelGroup>
                    </h:panelGrid>
                </center>

                <br/><br/>
                <center>
                    <p:commandButton value="Aceptar" 
                                      actionListener="#{titulosPrediales.addCem()}" update="mainForm"  />    
                </center>


            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgAnular" header="Escribir Observaciones para Anular la Emision" 
                  height="300" width="400" responsive="true" closable="true" closeOnEscape="true" 
                  modal="true" appendTo="@(body)" >

            <h:form id="frmAnular">
                <p:panelGrid columns="8">
                    <p:inputTextarea id="obsservacion21" value="#{titulosPrediales.observacion}" 
                                     rows="10" cols="50" style="width: 98%; text-transform: uppercase" />
                </p:panelGrid>

                <p:commandButton value="Aceptar" 
                                 process="@all" actionListener="#{titulosPrediales.anularLiquidacion()}" update="mainForm"  />

            </h:form>
        </p:dialog>



    </ui:define>
</ui:composition>
