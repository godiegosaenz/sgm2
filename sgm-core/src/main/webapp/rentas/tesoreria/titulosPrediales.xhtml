<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="head">
        
        <style type="text/css">
            .ui-selectoneradio label{
                font-size: 1.2em;
                font-weight: bold;
            }
            .ui-datatable .ui-datatable-scrollable-body .ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td, .ui-datatable tfoot th{
                height : 20px;
                padding: 3px 5px;
            } 
        </style>
    </ui:define>
    <ui:define name="content">
        <center><h1>Títulos de Predios Urbanos</h1></center>
        <h:form id="mainForm">
            <p:tabView id="consultaPredial">
                <p:ajax event="tabChange" listener="#{consultaPagosPrediales.onChangeTab}"/>
                <p:tab  title="PREDIOS URBANOS">
                    <dialog:consultaCodigoPredial id="consultaTitu" tipoConsulta="#{consultaPagosPrediales.tipoConsulta}"
                                                  changeRadio="#{consultaPagosPrediales.onChangeRadio}"
                                                  updateConsulta="consultaTitu, mainForm:consultaPredial"
                                                  predioModel="#{consultaPagosPrediales.predioModel}"
                                                  contribuyenteConsulta="#{consultaPagosPrediales.contribuyenteConsulta}"
                                                  dlgSolicitante="PF('dlgSolicitante').show()"
                                                  ciudadelas="#{consultaPagosPrediales.ciudadelas}"
                                                  consultarEmisiones="#{consultaPagosPrediales.consultarEmisiones()}"
                                                  updateFrmSolicitante=":frmSolicitante"
                                                  tipoPredio="true"
                                                  renderConsultaDirecta="false"/>
                    <p:spacer width="25"/>
                    <p:outputLabel value="FORMATO ACTUAL: " style="font-size: 15px; font-weight: bolder;"/>
                    <p:selectBooleanCheckbox value="#{consultaPagosPrediales.formatoActual}" />
                    <p:spacer width="25"/>
                    <p:panel id="datos">
                        <p:outputLabel value="MATRICULA INMOBILIARIA: #{consultaPagosPrediales.predioConsulta.numPredio}" style="font-size: 16px; font-weight: bolder;"/>
                        <p:spacer width="25"/>
                        <p:outputLabel value="CODIGO: #{consultaPagosPrediales.predioConsulta.claveCat}" style="font-size: 16px; font-weight: bolder;"/>
                        <p:spacer width="25"/>
                        <p:commandButton value="GENERAR SELECCIONADOS" ajax="true" style="font-size: 14px; font-weight: bolder; float: right;" styleClass="btnStyle" icon="ui-icon-gear" iconPos="right" actionListener="#{consultaPagosPrediales.procesarPago(null, 1)}" process="dtEmision"/>
                        <!--                        <p:commandButton value="NO ADEUDAR" style="font-size: 14px; font-weight: bolder; float: right;" styleClass="btnStyle" icon="ui-icon-print" iconPos="right" oncomplete="PF('dlgCertificado').show();" update="formCertificado" rendered="# {(consultaPagosPrediales.totalEmisionesGeneral eq null or consultaPagosPrediales.totalEmisionesGeneral gt 0.00)?false:true}">
                                                    <f:setPropertyActionListener target="# {consultaPagosPrediales.tipoCertificado}" value="# {1}" />
                                                </p:commandButton>-->
                        <div style="clear: both;"/>
                        <p:dataTable id="dtEmision" value="#{consultaPagosPrediales.emisionesPrediales}" var="emision1" selection="#{consultaPagosPrediales.emisionesSeleccionadas}" 
                                     rowKey="#{emision1.id}" scrollable="true" scrollHeight="350" lazy="true" reflow="true" rows="100"
                                     rowStyleClass="#{emision1.coactiva ? 'orange' : null}" >
                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                            <p:column headerText="*" style="width: 20px;">
                                <p:graphicImage value="/image/circleGreen.png" height="12" rendered="#{emision1.estadoLiquidacion.id eq 1 ? true : false}" title="#{emision1.estadoLiquidacion.descripcion}"/>
                                <p:graphicImage value="/image/circleRed.png" height="12" rendered="#{emision1.estadoLiquidacion.id eq 2 ? true : false}" title="#{emision1.estadoLiquidacion.descripcion}"/>
                                <p:graphicImage value="/image/circleOrange.png" height="12" rendered="#{emision1.estadoLiquidacion.id eq 4 ? true : false}" title="#{emision1.estadoLiquidacion.descripcion}"/>
                            </p:column>
                            <p:column headerText="No." style="text-align: center;"  width="60"><p:outputLabel value="#{emision1.idLiquidacion}"/></p:column>
                            <p:column headerText="Año" style="text-align: center;" width="60"><p:outputLabel value="#{emision1.anio}"/></p:column>
                            <p:column  headerText="N. Predio" style="text-align: center;" width="100"><p:outputLabel value="#{emision1.predio.numPredio}"/></p:column>
                            <p:column headerText="Mz./Sl." style="text-align: center;"  width="80"><p:outputLabel value="#{emision1.predio.mz}/#{emision1.predio.solar}"/></p:column>
                            <p:column headerText="Factor" style="text-align: center;"  width="80"><p:outputLabel value="#{emision1.bandaImpositiva}"/></p:column>
                            <p:column  headerText="Identificación" style="text-align: center" width="140"><p:outputLabel value="#{emision1.comprador.ciRuc}"/></p:column>
                            <p:column headerText="Contribuyente" style="text-align: center" width="200">
                                <p:outputLabel value="#{emision1.comprador==null?emision1.nombreComprador :emision1.comprador.apellidos}#{emision1.comprador.nombres}#{emision1.comprador.razonSocial}#{emision1.comprador.nombreComercial}"/>
                            </p:column>
                            <p:column headerText="Avaluo" style="text-align: center;" width="100"><p:outputLabel value="#{emision1.avaluoMunicipal}"/></p:column>
                            <p:column headerText="Emision" style="text-align: center;" width="100"><p:outputLabel value="#{emision1.totalPago}"/></p:column>
                            <p:column headerText="Acción" style="text-align: center;" width="100"><p:commandButton value="Imprimir" actionListener="#{consultaPagosPrediales.procesarPago(emision1, 1)}"/></p:column>
                        </p:dataTable>

                    </p:panel>
                </p:tab>

                <!-- -->

                <p:tab  title="PREDIOS RUSTICOS">
                    <dialog:consultaCodigoPredial id="consultaRuralTitu" tipoConsulta="#{consultaPagosPrediales.tipoConsultaRural}"
                                                  updateConsulta="consultaRuralTitu, mainForm:consultaPredial:datosRural"
                                                  predioModel="#{consultaPagosPrediales.predioModel}"
                                                  contribuyenteConsulta="#{consultaPagosPrediales.contribuyenteConsulta}"
                                                  dlgSolicitante="PF('dlgSolicitante').show()"
                                                  ciudadelas="#{consultaPagosPrediales.parroquiasRurales}"
                                                  consultarEmisiones="#{consultaPagosPrediales.consultarEmisionesRurales()}"
                                                  updateFrmSolicitante=":frmSolicitante"
                                                  tipoPredio="false"
                                                  renderConsultaDirecta="false"
                                                  nombreComprador="#{consultaPagosPrediales.nombreComprador}"
                                                  consultaContDirecta="#{consultaPagosPrediales.consultarPorNombreComprador(2)}"/>

                    <p:spacer width="25"/>
                    <p:outputLabel value="FORMATO ACTUAL: " style="font-size: 15px; font-weight: bolder;"/>
                    <p:selectBooleanCheckbox value="#{consultaPagosPrediales.formatoActual}" />
                    <p:spacer width="25"/>
                    <p:panel id="datosRural">
                        <p:outputLabel value="REG. CATASTRAL: #{consultaPagosPrediales.predioRuralConsulta.regCatastral}    " style="font-size: 16px; font-weight: bolder;"/>
                        <p:spacer width="25"/>
                        <p:commandButton value="GENERAR SELECCIONADOS" ajax="true" style="font-size: 14px; font-weight: bolder; float: right;" styleClass="btnStyle" icon="ui-icon-gear" iconPos="right" actionListener="#{consultaPagosPrediales.procesarPago(null, 2)}" process="dtEmisionRural"/>
                        <div style="clear: both;"/>
                        <p:dataTable id="dtEmisionRural" value="#{consultaPagosPrediales.emisionesPrediales}" var="emisionRural1" selection="#{consultaPagosPrediales.emisionesSeleccionadas}" 
                                     rowKey="#{emisionRural1.id}" scrollable="true" scrollHeight="350" lazy="true" reflow="true" rows="100"
                                     rowStyleClass="#{emisionRural1.coactiva ? 'orange' : null}" >
                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                            <p:column headerText="*" style="width: 20px;">
                                <p:graphicImage value="/image/circleGreen.png" height="12" rendered="#{emisionRural1.estadoLiquidacion.id eq 1 ? true : false}" title="#{emisionRural1.estadoLiquidacion.descripcion}"/>
                                <p:graphicImage value="/image/circleRed.png" height="12" rendered="#{emisionRural1.estadoLiquidacion.id eq 2 ? true : false}" title="#{emisionRural1.estadoLiquidacion.descripcion}"/>
                                <p:graphicImage value="/image/circleOrange.png" height="12" rendered="#{emisionRural1.estadoLiquidacion.id eq 4 ? true : false}" title="#{emisionRural1.estadoLiquidacion.descripcion}"/>
                            </p:column>
                            <p:column headerText="No." style="text-align: center;"  width="60"><p:outputLabel value="#{emisionRural1.idLiquidacion}"/></p:column>
                            <p:column headerText="Año" style="text-align: center;" width="60"><p:outputLabel value="#{emisionRural1.anio}"/></p:column>
                            <p:column  headerText="Cod. Catastral" style="text-align: center;" width="100"><p:outputLabel value="#{emisionRural1.predioRustico.regCatastral}-#{emisionRural1.predioRustico.idPredial}"/></p:column>
                            <p:column headerText="Sitio." style="text-align: center;"  width="80"><p:outputLabel value="#{emisionRural1.predioRustico.sitio}"/></p:column>
                            <p:column headerText="Factor" style="text-align: center;"  width="80"><p:outputLabel value="#{emisionRural1.bandaImpositiva}"/></p:column>
                            <p:column  headerText="Identificación" style="text-align: center" width="140"><p:outputLabel value="#{emisionRural1.comprador.ciRuc}"/></p:column>
                            <p:column headerText="Contribuyente" style="text-align: center" width="200">
                                <p:outputLabel value="#{emisionRural1.comprador==null?emisionRural1.nombreComprador :emisionRural1.comprador.apellidos}#{emisionRural1.comprador.nombres}#{emisionRural1.comprador.razonSocial}#{emisionRural1.comprador.nombreComercial}"/>
                            </p:column>
                            <p:column headerText="Avaluo" style="text-align: center;" width="100"><p:outputLabel value="#{emisionRural1.avaluoMunicipal}"/></p:column>
                            <p:column headerText="Emision" style="text-align: center;" width="100"><p:outputLabel value="#{emisionRural1.totalPago}"/></p:column>
                            <p:column headerText="Acción" style="text-align: center;" width="100"><p:commandButton value="Imprimir" actionListener="#{consultaPagosPrediales.procesarPago(emisionRural1, 2)}"/></p:column>
                        </p:dataTable>

                    </p:panel>
                </p:tab>

            </p:tabView>
        </h:form>        


        <p:dialog id="dialgSolicitante" widgetVar="dlgSolicitante" header="Listado de contribuyentes" appendTo="@(body)" width="700" responsive="true" closable="true" closeOnEscape="true" modal="true">
            <h:form id="frmSolicitante">
                <p:dataTable id="dtSolicitante" value="#{consultaPagosPrediales.solicitantes}" var="s" selection="#{consultaPagosPrediales.contribuyenteConsulta}" rowKey="#{s.id}" style="width: 100%" lazy="true" reflow="true" paginator="true" rows="10" selectionMode="single" filterEvent="enter" paginatorPosition="top">
                    <f:facet name="header">Seleccione Contribuyente</f:facet>
                    <p:column headerText="No. Identificacion" sortBy="#{s.ciRuc}" filterBy="#{s.ciRuc}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.ciRuc}"/>
                    </p:column>
                    <p:column headerText="Apellidos" filterBy="#{s.apellidos}" sortBy="#{s.apellidos}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.apellidos}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{s.nombres}" sortBy="#{s.nombres}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.nombres}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Razon Social" filterBy="#{s.razonSocial}" sortBy="#{s.razonSocial}"  filterMatchMode="contains" filterStyle="width: 95%;">
                        <h:outputText value="#{s.razonSocial}" style="text-transform: uppercase"/>
                    </p:column>
                    <f:facet name="footer">
                        <p:commandButton id="btnSeleccionar" value="Seleccionar" update="mainForm" style="height: 30px" oncomplete="PF('dlgSolicitante').hide()"/>
                    </f:facet>
                </p:dataTable>         
            </h:form>
        </p:dialog>

        <p:dialog header="ADVERTENCIA" widgetVar="dlgMensaje" resizable="false" closeOnEscape="true" modal="true" width="200">
            <h:form id="formMensaje">
                <p:panelGrid styleClass="noBorder" columns="1">
                    <p:outputLabel value="El predio consultado tiene Titulos de Credito en COACTIVA!!!" style="font-size: 14px;font-weight: bolder;text-align: center;color: #0033FF;"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>