<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
   
    <ui:define name="content">
        <div align="center">
            <h1>Listado de Comprobantes Cobrados</h1>
        </div>
        <h:form id="mainForm">
            <p:dataTable id="dtPagos" reflow="true" paginator="true" lazy="true" rows="15" rowsPerPageTemplate="15,50,100" paginatorPosition="top" style="text-align: center;"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 value="#{pagosRealizados.pagos}" var="p" emptyMessage="No se encontraron elementos..." rowKey="#{p.id}" filterEvent="enter">
                <p:column headerText="Detalle" width="60" style="text-align: center;">
                    <p:commandLink actionListener="#{pagosRealizados.verPago(p)}" title="#{p.numComprobante}" oncomplete="PF('dlgPago').show();" update="formPago">
                        <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                    </p:commandLink>
                </p:column>
                <p:column headerText="Imprimir" width="65" style="text-align: center;">
                    <p:commandLink actionListener="#{pagosRealizados.imprimirComprobante(p)}" title="#{p.numComprobante}">
                        <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>
                    </p:commandLink>
                </p:column>
                <p:column headerText="Clave Catastral">
                    <p:outputLabel value="#{p.liquidacion.predioRustico.regCatastral}" rendered="#{p.liquidacion.tipoLiquidacion.id eq 7}"  />
                    <p:outputLabel value="#{p.liquidacion.predio.claveCat}" rendered="#{p.liquidacion.tipoLiquidacion.id eq 13}"   />
                    <p:outputLabel value="#{p.liquidacion.claveAME}" rendered="#{p.liquidacion.predio.id eq null}"   />
                </p:column> 
                
                <p:column headerText="Comprobante" filterBy="#{p.numComprobante}" sortBy="#{p.numComprobante}" filterStyle="width: 95%;"><p:outputLabel value="#{p.numComprobante}" style="font-weight: bold; font-size: 13px;"/></p:column>
                <p:column headerText="Id-Liquidacion"  filterBy="#{p.liquidacion.idLiquidacion}"  filterStyle="width: 95%;"><p:outputLabel value="#{p.liquidacion.idLiquidacion}" style="font-weight: bold;"/></p:column>
               
                <p:column headerText="Liquidacion" filterBy="#{p.liquidacion.numLiquidacion}" filterStyle="width: 95%;"><p:outputLabel value="#{p.liquidacion.numLiquidacion}"/></p:column>
                <p:column headerText="AÃ±o" filterBy="#{p.liquidacion.anio}"  filterStyle="width: 95%;"><p:outputLabel value="#{p.liquidacion.anio}"/></p:column>
                <p:column headerText="Contribuyente" filterBy="#{p.nombreContribuyente}">
                    <p:outputLabel style="font-weight: bold; font-size: 13px;" value="#{p.contribuyente ne null?p.contribuyente.nombreCompleto: p.nombreContribuyente ne null?p.liquidacion.nombreComprador:(p.liquidacion.observacion.contains('|')?p.liquidacion.observacion.substring(0,p.liquidacion.observacion.indexOf('|')):p.liquidacion.observacion)}"/>
                </p:column>
                <p:column headerText="Valor"><p:outputLabel value="#{p.valor}"/></p:column>
                <p:column headerText="Fecha"><p:outputLabel value="#{p.fechaPago}"><f:convertDateTime pattern="dd-MM-YYYY"/></p:outputLabel></p:column>
                <p:column headerText="Cajero"><p:outputLabel value="#{p.cajero.usuario}"/></p:column>
                <p:column headerText="Estado"><p:outputLabel style="font-weight: bold;" value="#{p.estado?'PROCESADO':'ANULADO'}"/></p:column>
            </p:dataTable>
        </h:form>
        
        <p:dialog header="INFORMACION PAGO" widgetVar="dlgPago" modal="true" resizable="false" width="70%" closeOnEscape="true" position="center">
            <h:form id="formPago">
                <p:fieldset legend="DETALLE EMISION">
                    <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;">
                        <p:outputLabel value="TITULO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.tipoLiquidacion.nombreTitulo}"/>
                        <p:outputLabel value="ID EMISION" style="font-weight: bold;"/><p:inputText value="#{pagosRealizados.pago.liquidacion.idLiquidacion}" readonly="true"/>
                        
                        <p:outputLabel value="CONTRIBUYENTE" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.comprador.apellidos} #{pagosRealizados.pago.liquidacion.comprador.nombres} #{pagosRealizados.pago.liquidacion.comprador.razonSocial} #{pagosRealizados.pago.liquidacion.comprador.nombreComercial}"/>
                        <p:outputLabel value="FECHA EMISION" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.fechaIngreso}"><f:convertDateTime pattern="dd-MM-YYYY HH:MM"/></p:outputLabel>
                        
                        <p:outputLabel value="ESTADO-ANIO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.estadoLiquidacion.descripcion}-#{pagosRealizados.pago.liquidacion.anio}"/>
                        <p:outputLabel value="USUARIO INGRESO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.usuarioIngreso}"/>
                        
                        <p:outputLabel value="VALOR" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.totalPago}"/>
                        <p:outputLabel value="SALDO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.liquidacion.saldo}"/>
                    </p:panelGrid>
                </p:fieldset>
                <br/>
                <p:fieldset legend="DETALLE PAGO">
                    <p:panelGrid styleClass="noBorder" columns="4" style="width: 100%;">
                        <p:outputLabel value="COMPROBANTE" style="font-weight: bold;"/><p:inputText value="#{pagosRealizados.pago.numComprobante}" readonly="true"/>
                        <p:outputLabel value="FECHA PAGO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.fechaPago}"><f:convertDateTime pattern="dd-MM-YYYY HH:MM"/></p:outputLabel>
                        
                        <p:outputLabel value="VALOR" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.valor}"/>
                        <p:outputLabel value="CAJERO" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.cajero.usuario}"/>
                        
                        <p:outputLabel value="INTERES" style="font-weight: bold;"/><p:outputLabel value="#{pagosRealizados.pago.interes}"/>
                        <p:outputLabel value="DESCUENTO" style="font-weight: bold;" rendered="#{pagosRealizados.pago.descuento gt 0}"/><p:outputLabel value="#{pagosRealizados.pago.descuento}" rendered="#{pagosRealizados.pago.descuento gt 0}"/>
                        <p:outputLabel value="RECARGO" style="font-weight: bold;" rendered="#{pagosRealizados.pago.recargo gt 0}"/><p:outputLabel value="#{pagosRealizados.pago.recargo}" rendered="#{pagosRealizados.pago.recargo gt 0}"/>
                    </p:panelGrid>
                </p:fieldset>
                <br/>
                <center>
                    <p:commandButton value="Aceptar" oncomplete="PF('dlgPago').hide();" styleClass="btnStyle" icon="ui-icon-circle-check"/>
                    <p:spacer width="20"/>
                    <p:commandButton value="Anular Pago" oncomplete="PF('dlgSubirDocumento').show();" styleClass="btnStyle" icon="ui-icon-trash" update="mainForm:dtPagos" rendered="#{pagosRealizados.renderAnular and pagosRealizados.pago.estado}">
                        
                    </p:commandButton>
                    <p:spacer width="20"/>
                    <p:commandButton value="Comprobante" oncomplete="PF('dlgPago').hide();" styleClass="btnStyle" icon="ui-icon-print" actionListener="#{pagosRealizados.generarComprobante(false)}" rendered="#{pagosRealizados.renderAnular and pagosRealizados.pago.estado}"/>
                </center>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>
            </h:form>
        </p:dialog>
        
        <p:dialog widgetVar="dlgSubirDocumento" header="Escribir Observaciones para Anular Pago" 
                  height="300" width="400" responsive="true" closable="true" closeOnEscape="true" 
                  modal="true" appendTo="@(body)" >

            <h:form id="frmSubirDocumentosDialog">
                <p:panelGrid columns="8">
                    <p:inputTextarea id="obsservacion21" value="#{pagosRealizados.observacion}" 
                                     rows="10" cols="50" style="width: 98%; text-transform: uppercase" />
                </p:panelGrid>
                
                <p:commandButton value="Aceptar" oncomplete="PF('dlgSubirDocumento').hide()" 
                                 process="@all" actionListener="#{pagosRealizados.reversarPago()}" update="mainForm, formPago"  />
                
            </h:form>
        </p:dialog>
        
    </ui:define>
</ui:composition>
