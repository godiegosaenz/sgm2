<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:poue="http://primefaces.org/ui/extensions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html" 
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:dlg="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{localesComerciales.initView()}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
            .ui-datepicker .ui-datepicker-title select {
                font-size: 1em;
                margin: 1px 0;
                color: black;
            }
        </style>
    </ui:define>
    <ui:define name="content">
        <center>
            <h1>Declaraciónes de Impuestos  </h1>
        </center>
        <center>
            <h:form id="frmAlcPlus" >

            <h:panelGrid id="pnlDP" columns="1" style="width: 99%;">
                <p:panel header="Buscar Usuario" style="width: 99%;">
                    <center>
                        <h:panelGrid columns="2" styleClass="noBorder" >
                            <h:panelGrid columns="2" >
                                <h:outputText value="Tipo de Liquidación" style="display: block;"/>
                                <p:selectOneMenu value="#{localesComerciales.tipoLiquidacion}" converter="entityConverter"  style="width: 220px;"
                                                 converterMessage="Error al intentar realizar conversión" title="#{localesComerciales.tipoLiquidacion.nombreTitulo}" >
                                    <f:selectItem itemLabel="Seleccione..." itemValue="#{null}"/>
                                    <f:selectItems value="#{localesComerciales.tiposLiquidacions}" var="tipo" 
                                                   itemLabel="#{tipo.nombreTitulo}" itemValue="#{tipo}" />
                                    <p:ajax update="frmAlcPlus" listener="#{localesComerciales.consultarRubros()}" />
                                </p:selectOneMenu>
                            </h:panelGrid>
                            <h:panelGrid columns="3" >
                                <h:outputText value="Número de Identificación" style="display: block;"/>
                                <p:inputText value="#{localesComerciales.cedulaRuc}" style="display: block; margin: 0 auto;" disabled="#{localesComerciales.tipoLiquidacion==null}">
                                    <poue:keyFilter mask="num" preventPaste="false"/>
                                </p:inputText>
                                <p:commandButton update="frmAlcPlus" actionListener="#{localesComerciales.buscarEnte()}" style="color: #ffffff; background: #616161 !important; font-weight: bold; height: 30px;" value="Buscar" disabled="#{localesComerciales.tipoLiquidacion==null}"/>
                            </h:panelGrid>

                            </h:panelGrid>
                        </center>
                    </p:panel>
                </h:panelGrid>
                <br/>
                <p:panel rendered="#{localesComerciales.propietario != null and localesComerciales.tipoLiquidacion != null}">
                    <h:panelGrid columns="2" >
                        <dlg:datosEntes ente="#{localesComerciales.propietario}"
                                        esPersona="#{localesComerciales.esPersonaProp}"
                                        header="Datos del propietario" 
                                        id="outComprador"
                                        update="frmAlcPlus" />
                        <h:panelGrid columns="1">
                            <p:dataTable rows="5" paginator="true" paginatorPosition="top" value="#{localesComerciales.localesEnte}" 
                                         var="local1">
                                <f:facet name="header">
                                    <p:commandLink value="Buscar Local" actionListener="#{localesComerciales.buscarLocal()}" 
                                                   style="font-size: 16px; font-weight: bold; color: #006699;" >
                                        <!--                        <p:graphicImage value="/css/homeIconsImages/buscar.png" height="25" width="25"/>-->
                                        <p:ajax event="dialogReturn" listener="#{localesComerciales.seleccionarLocal}" />
                                    </p:commandLink>
                                </f:facet>
                                <p:column headerText="Nombre del local" filterBy="#{local1.nombreLocal}" width="45%;" filterStyle="width: 99%;">
                                    <center><h:outputText value="#{local1.nombreLocal}"/></center>
                                </p:column>
                                <p:column headerText="Número del local" filterBy="#{local1.numLocal}" filterStyle="width: 99%;">
                                    <center><h:outputText value="#{local1.numLocal}"/></center>
                                </p:column>
                                <p:column headerText="Área del local" filterBy="#{local1.area}" filterStyle="width: 99%;">
                                    <center><h:outputText value="#{local1.area}"/></center>
                                </p:column>
                                <p:column headerText="Acción" >
                                    <center><p:commandLink value="Seleccionar" actionListener="#{localesComerciales.seleccionar(local1)}" update="frmAlcPlus"/></center>
                                </p:column>
                            </p:dataTable>
                        </h:panelGrid>
                    </h:panelGrid>
                </p:panel>
                <br/>
                <center>
                    <!-- rendered="# {localesComerciales.propietario != null and localesComerciales.tipoLiquidacion != null}" -->
                    <h:panelGrid columns="5" rendered="#{localesComerciales.localSel != null}">
                        <h:outputText value="Año Liquidación: " style="font-weight: bolder"/>
                        <p:spinner value="#{localesComerciales.liquidacion.anio}" min="#{localesComerciales.minAnio}" 
                                   maxlength="4" max="#{localesComerciales.maxAnioAct}" stepFactor="1" >
                            <poue:keyFilter mask="num"/>
                            <p:ajax update="frmAlcPlus:t1, frmAlcPlus:dtLocal" listener="#{localesComerciales.generarValorLiquidacion()}"
                                    rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 102}"/>
                        </p:spinner>

                        <h:outputText value="Número Trámite: " style="font-weight: bolder"/>
                        <p:inputText value="#{localesComerciales.liquidacion.numReporte}">
                            <poue:keyFilter mask="num"/>
                        </p:inputText>
    <!--                    <p:inputText value="#{localesComerciales.liquidacion.numReporte}">
                            <poue:keyFilter mask="num"/>
                        </p:inputText>-->
                    </h:panelGrid>
                </center>
                <br/>
                <!--rendered="# {localesComerciales.propietario != null and localesComerciales.tipoLiquidacion != null}"--> 
                <h:panelGrid columns="2" rendered="#{localesComerciales.localSel != null}" >
                    <!--                ACTIVOS TOTALES -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 11}" >
                        <p:outputLabel value="Activo Total: " />
                        <poue:inputNumber value="#{localesComerciales.local.activoTotal}" id="at1">
                            <p:ajax  listener="#{localesComerciales.sumarActivos()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </poue:inputNumber>

                        <p:outputLabel value="Activo Contingente: "/>
                        <poue:inputNumber value="#{localesComerciales.local.activoContingente}" id="at2">
                            <p:ajax  listener="#{localesComerciales.sumarActivos()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </poue:inputNumber>

                        <p:outputLabel value="Pasivo Corriente: " />
                        <poue:inputNumber value="#{localesComerciales.local.pasivoTotal}" id="at3">
                            <p:ajax  listener="#{localesComerciales.sumarPasivos()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </poue:inputNumber>

                        <p:outputLabel value="Pasivo Contingente: " />
                        <poue:inputNumber value="#{localesComerciales.local.pasivoContingente}" id="at4">
                            <p:ajax  listener="#{localesComerciales.sumarPasivos()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </poue:inputNumber>

                        <p:outputLabel value="Año de Balance: " />
                        <p:spinner id="at5" value="#{localesComerciales.local.anioBalance}" min="#{localesComerciales.minAnio}" 
                                   maxlength="4" max="#{localesComerciales.maxAnio}" stepFactor="1" >
                            <poue:keyFilter mask="num"/>
                            <p:ajax  listener="#{localesComerciales.impuesto()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </p:spinner>
                        <p:outputLabel value="Porcentaje de Ingreso: " />
                        <poue:inputNumber value="#{localesComerciales.local.porcentajeIngreso}" id="at6" emptyValue="zero" 
                                          decimalPlaces="6" maxValue="100" >
                            <p:ajax  listener="#{localesComerciales.impuesto()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </poue:inputNumber>

                        <p:outputLabel value="Año de Cobro: " />
                        <p:calendar value="#{localesComerciales.local.fechaIngreso}" id="at7" disabled="true" pattern="dd/MM/yyyy">
                            <p:ajax  listener="#{localesComerciales.impuesto()}" update="frmAlcPlus:t1, frmAlcPlus:dtLocal"/>
                        </p:calendar>

                        <p:outputLabel value="" />
                        <p:outputLabel value="" id="at8"/>
                    </h:panelGrid>

                    <!--                TASA DE HABILITACION -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 15}" >
                        <h:outputText value="Área Permitida: " style="font-weight: bolder"/>
                        <poue:inputNumber value="#{localesComerciales.localSel.area}" id="th1" readonly="true"/>

                        <h:outputText value="Área Prohibida: "  style="font-weight: bolder"/>
                        <poue:inputNumber value="" id="th2" readonly="true"/>
                    </h:panelGrid>

                    <!--                PATENTE ANUAL -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 14}" >
                        <p:outputLabel value="Capital o Patrimonio: " />
                        <poue:inputNumber value="#{localesComerciales.balance.capital}" id="pa1">
                            <p:ajax update="frmAlcPlus" listener="#{localesComerciales.generarValorLiquidacion()}" />
                        </poue:inputNumber>

                        <p:outputLabel value="Fecha Balance: " />
                        <p:calendar value="#{localesComerciales.balance.fechaBalance}" id="pa2" navigator="true"/>

                        <p:outputLabel value="Año de Cobro: " />
                        <p:inputText value="#{localesComerciales.balance.anioBalance}" id="pa3"/>
                    </h:panelGrid>

                    <!--                TURISMO -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 98}" >
                        <h:outputText value="Actividad: " style="display: block; font-weight: bolder " />
                        <p:dataList id="tu1" value="#{localesComerciales.actividadesLocal}" var="ct1" 
                                    emptyMessage="No se encontrarón registros de actividades">
                            <p:outputLabel value="#{ct1.descripcion}"/>
                        </p:dataList>

                        <h:outputText value="Categoria: " style="display: block; font-weight: bolder " />
                        <p:inputText value="#{localesComerciales.localSel.categoria.descripcion}" id="tu2" readonly="true"/>

                        <h:outputText value="Cantidad: " style="display: block; font-weight: bolder "/>
                        <p:dataList id="tu3" value="#{localesComerciales.localSel.cantidadAccesoriosCollection}" var="ac1"
                                    emptyMessage="No se encontrarón registros de Cantidad">
                            <p:outputLabel value="#{ac1.cantidad}" />
                        </p:dataList>

                        <h:outputText value="Valor Unitario: " style="display: block; font-weight: bolder "/>
                        <p:inputText value="#{localesComerciales.valor}" id="tu4" readonly="true"/>
                    </h:panelGrid>

                    <!--                BOMBEROS -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 53   }" >
                        <h:outputText value="Año Liquidación: " style="display: block; font-weight: bolder "/>
                        <p:inputText value="#{localesComerciales.liquidacion.anio}" id="bo1"/>

                        <h:outputText value="Valor: " style="display: block; font-weight: bolder "/>
                        <poue:inputNumber value="#{localesComerciales.liquidacion.totalPago}" id="bo2">
                            <p:ajax update="frmAlcPlus" listener="#{localesComerciales.generarValorLiquidacion}"/>
                        </poue:inputNumber>
                    </h:panelGrid>
                    <!--                VALLAS PUBLICITARIAS -->
                    <h:panelGrid columns="4" rendered="#{localesComerciales.tipoLiquidacion.codigoTituloReporte == 206}"
                                 >
                        <h:outputText value="Varios Rotulos"  style="text-align: left; font-weight: bolder"/>

                        <p:outputLabel value="" />
                        <p:selectBooleanCheckbox  value="#{localesComerciales.variosRotulos}" style="text-align: center; "/>
                        <p:outputLabel value=""/>
                        <p:outputLabel value="" />
                        <p:outputLabel value="" />
                        <p:outputLabel value="" />
                        <div align="left">
                            <h:outputText value="Tipo: " style="text-align: left; font-weight: bolder"/>
                        </div>
                        <p:selectOneRadio id="vl1" value="#{localesComerciales.liquidacion.codigoLocal}" 
                                          style="width: 99%; " columns="1" layout="grid" >
                            <f:selectItem itemLabel="Publicidad Normal" itemValue="rotulo"/>
                            <f:selectItem itemLabel="Publicidad Normal (10)" itemValue="rotulo(10)"/>
                            <f:selectItem itemLabel="Pantalla Electronica Digital" itemValue="pantalla"/>
                            <p:ajax update="frmAlcPlus" listener="#{localesComerciales.generarValorLiquidacion()}"/>
                        </p:selectOneRadio>
                        <p:outputLabel value="" />

                        <h:outputText value="Metros: "  style="text-align: left; font-weight: bolder" />
                        <p:spacer width="5"/>
                        <p:inputText value="#{localesComerciales.liquidacion.areaTotal}" id="vl3" style="width: 99%; ">
                            <poue:keyFilter mask="num" preventPaste="false"/>
                            <p:ajax update="frmAlcPlus" listener="#{localesComerciales.generarValorLiquidacion()}"/>
                        </p:inputText>
                    </h:panelGrid>

                    <h:panelGroup>
                        <!--                    RUBROS LOCALES COMERCIALES -->
                        <p:dataTable id="dtLocal" reflow="true" value="#{localesComerciales.detalle}" 
                                     var="rub" rowIndexVar="index" style="width: 99%;" >
                            <p:column style="width: 5%">
                                <h:outputText value="#{index+1}" />
                            </p:column>
                            <p:column headerText="Descripción" >
                                <h:outputText value="#{rub.descripcion}" />
                            </p:column>
                            <p:column headerText="Valor" style="width: 20%; text-align: right">
                                <h:outputText value="#{rub.valor}" >
                                    <f:convertNumber maxFractionDigits="2" minFractionDigits="2" currencySymbol="$"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                        <br/>
                        <div align="right">
                            <h:outputText  value="Total a cancelar: " style="font-weight: bold;"/>
                            <p:outputLabel  value="$ " style="font-weight: bold;"/>
                            <p:inputText id="t1" value="#{localesComerciales.liquidacion.totalPago}" >
                                <f:convertNumber maxFractionDigits="2"  minFractionDigits="2"/>
                                <p:ajax listener="#{localesComerciales.modificarTotal()}" update="frmAlcPlus:dtLocal"/>
                            </p:inputText>
                        </div>
                    </h:panelGroup>

                </h:panelGrid>

                <br/><br/>
                <center  >
<!--                    <p:commandButton value="Calcular" styleClass="btnStyle" style="height: 20px; text-align: center;" rendered="#{localesComerciales.liquidacion.totalPago == 0 and localesComerciales.localSel != null}"
                                     actionListener="#{localesComerciales.generarValorLiquidacion()}"/>
                     rendered="#{localesComerciales.propietario != null and localesComerciales.tipoLiquidacion != null}""-->
                    <p:commandButton value="Procesar" actionListener="#{localesComerciales.validar()}" rendered="#{localesComerciales.localSel != null}" 
                                     icon="ui-icon-gear" styleClass="btnStyle" iconPos="r" style="height: 20px;">
                        <p:confirm header="Advertencia" icon="ui-icon-info" message="¿Esta seguro de guardar los datos ingresados?"/>
                    </p:commandButton>
                </center>
                <br/><br/>
            </h:form>
        </center>
        <!-- -->

        <dlg:dialogNumLiquidacion headerDialog="#{localesComerciales.liquidacion.tipoLiquidacion.nombreTransaccion}"
                                  idLiq="#{localesComerciales.liquidacion.idLiquidacion}" 
                                  actionButton="#{localesComerciales.borrar()}"
                                  update="frmAlcPlus"
                                  id="numLiq"/>

        <dlg:observaciones actionButton="#{localesComerciales.procesar()}"
                           observaciones="#{localesComerciales.liquidacion.observacion}"

                           />
        <!-- -->

        <p:dialog id="dlgSolicitante" header="Datos de Solicitante" widgetVar="dlgSolInf" resizable="false" modal="true" 
                  position="center" closable="false">
            <h:form id="formSolicitante">
                <p:panelGrid styleClass="noBorder" style="width: 400px">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Cédula:" style="font-weight: bolder" rendered="#{localesComerciales.persona.esPersona}"/>
                            <p:outputLabel value="RUC:" style="font-weight: bolder" rendered="#{!localesComerciales.persona.esPersona}"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{localesComerciales.persona.ciRuc}" readonly="true"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Nombres:" style="font-weight: bolder" rendered="#{localesComerciales.persona.esPersona}"/>
                            <p:outputLabel value="Razon Social:" style="font-weight: bolder" rendered="#{!localesComerciales.persona.esPersona}"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{localesComerciales.persona.nombres}" style="width: 99%" rendered="#{localesComerciales.persona.esPersona}"/>
                            <p:inputText value="#{localesComerciales.persona.razonSocial}" style="width: 99%" rendered="#{!localesComerciales.persona.esPersona}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Apellidos:" style="font-weight: bolder" rendered="#{localesComerciales.persona.esPersona}"/>
                            <p:outputLabel value="Representante Legal:" style="font-weight: bolder" rendered="#{!localesComerciales.persona.esPersona}"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{localesComerciales.persona.apellidos}" style="width: 99%" rendered="#{localesComerciales.persona.esPersona}"/>
                            <p:inputText id="repLeg" value="#{localesComerciales.persona.nombresCompletos}" style="width: 70%" rendered="#{!localesComerciales.persona.esPersona}" readonly="true" title="#{localesComerciales.persona.nombresCompletos}"/>
                            <p:commandLink actionListener="#{localesComerciales.buscarEnteDlg()}" rendered="#{!localesComerciales.persona.esPersona}"  >
                                <p:ajax event="dialogReturn" listener="#{localesComerciales.seleccionarComprador}" update="formSolicitante:repLeg" />
                                <p:graphicImage value="/css/homeIconsImages/buscar.png" width="25" height="25"/>
                            </p:commandLink>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Dirección :"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{localesComerciales.persona.direccion}" style="width: 99%"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:commandLink value="SI CLIENTE NO POSEE CORREO DE CLIC AQUI." style="font-weight: bolder;color: #0033FF"
                                           actionListener="#{localesComerciales.agregarCorreoGenerico()}" update="dtEmailPer"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Email:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="labelEmail" value="#{localesComerciales.emailNew}" size="35" placeholder="Ejemplo: correo@ejemplo.com"/>
                            <p:spacer width="15" height="1"/>
                            <p:commandButton value="Agregar" icon="ui-icon-plus" update="dtEmailPer,labelEmail"
                                             actionListener="#{localesComerciales.agregarEmail()}" />
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:dataTable id="dtEmailPer" value="#{localesComerciales.persona.enteCorreoCollection}" var="mail" scrollable="true" scrollHeight="80">
                                <p:column headerText="Email" style="text-align: center">
                                    <p:outputLabel value="#{mail.email}"/>
                                </p:column>
                                <p:column headerText="Acción" style="text-align: center" width="60">
                                    <p:commandLink value="Eliminar" actionListener="#{localesComerciales.eliminarEmail(mail)}" 
                                                   update="dtEmailPer" style="color: #0033FF;font-weight: bolder"/>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Teléfono:" style="font-weight: bolder"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="labelTelef" value="#{localesComerciales.tlfnNew}" size="35" placeholder="Ejemplo: 045555555 ó 0988888888"/>
                            <p:spacer width="20" height="1"/>
                            <p:commandButton value="Agregar" actionListener="#{localesComerciales.agregarTlfn()}" 
                                             update="dtTelefPer,labelTelef" icon="ui-icon-plus"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <p:dataTable id="dtTelefPer" value="#{localesComerciales.persona.enteTelefonoCollection}" var="tlfn" scrollable="true" scrollHeight="80">
                                <p:column headerText="Teléfono" style="text-align: center" >
                                    <p:outputLabel value="#{tlfn.telefono}"/>
                                </p:column>
                                <p:column headerText="Acción" style="text-align: center" width="60">
                                    <p:commandLink value="Eliminar" actionListener="#{localesComerciales.eliminarTlfn(tlfn)}"
                                                   style="color: #0033FF;font-weight: bolder" update="dtTelefPer" />
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="text-align: center">
                            <p:commandButton ajax="false" value="Guardar" icon="ui-icon-disk" styleClass="btnStyle"
                                             actionListener="#{localesComerciales.guardarSolicitante()}"/>
                            <p:spacer width="40" height="1"/>
                            <p:commandButton value="Cancelar" icon="ui-icon-cancel" styleClass="btnStyle" oncomplete="PF('dlgSolInf').hide();"
                                             actionListener="#{localesComerciales.cancelarGuardado()}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <!-- -->

    </ui:define>

</ui:composition>
