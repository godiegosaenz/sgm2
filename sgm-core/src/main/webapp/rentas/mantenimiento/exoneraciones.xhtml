<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:daoj="http://deltaspike.apache.org/jsf"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="head">
        <style type="text/css">
            .ui-datatable tbody td {
                border-color: lightsteelblue;
                padding-bottom: 0px;
            }
            .ui-datatable table {
                border-collapse: collapse;
            }
            .ui-datatable-even {
                background: #e1e4f0;
            }
        </style>
    </ui:define>



    <ui:define name="content">
        <center>
            <h1>Exoneraciones Aplicadas</h1>
        </center>
        <h:form id="frmExon">

            <p:dataTable lazy="true" paginator="true" emptyMessage="No se encontrar&#243;n registros" 
                         paginatorPosition="top" reflow="true" rows="10" rowsPerPageTemplate="10,20,50"
                         value="#{exoneracionesView.exoneraciones}" var="exo" filterEvent="enter" 
                         style="padding: 1px 10px;" >

                <p:column headerText="Num. de solicitud" width="15" filterBy="#{exo.id}">
                    <center>#{exo.id}</center>
                </p:column>

                    <p:column headerText="Tipo de Exoneraciòn" width="15" >
                        <center>#{exo.exoneracion.exoneracionTipo.descripcion}</center>
                    </p:column>

                    <p:column headerText="Estado de Exoneraciòn" width="15" >
                        <center>#{exo.exoneracion.estado.descripcion}</center>
                    </p:column>

                <p:column headerText="Num. predio" width="15" filterBy="#{exo.liquidacionOriginal.predio.numPredio}">
                    <center>#{exo.liquidacionOriginal.predio.numPredio}</center>
                </p:column>

                <p:column headerText="Año" width="10" filterBy="#{exo.liquidacionOriginal.anio}">
                    <center>#{exo.liquidacionOriginal.anio}</center>
                </p:column>

                <p:column headerText="Solicitante" width="35" filterBy="#{exo.liquidacionOriginal.nombreComprador}">
                    <center><h:outputText value="#{exo.liquidacionPosterior == null?(exo.liquidacionOriginal.comprador == null ?  exo.liquidacionOriginal.nombreComprador : exo.liquidacionOriginal.comprador.nombreCompleto):(exo.liquidacionPosterior.comprador == null ?  exo.liquidacionPosterior.nombreComprador : exo.liquidacionPosterior.comprador.nombreCompleto)}"/></center>
                </p:column>

                <p:column headerText="Fecha de ingreso" width="15">
                    <center>#{exo.fechaIngreso}</center>
                </p:column>

                <p:column headerText="Accion" width="15">
                    <center>
                        <p:commandLink actionListener="#{exoneracionesView.verDetalles(exo)}" title="Ver detalles" oncomplete="PF('dlgExoAplicada').show();" update="frmExoAp">
                            <p:graphicImage value="/css/homeIconsImages/abrir.png" height="16"/>   
                        </p:commandLink>
                        <p:commandLink title="Anular exoneracion"  update="frmExon"
                                      
                                       actionListener="#{exoneracionesView.anularExoneracion(exo)}">
                            <p:graphicImage value="/css/homeIconsImages/delete.png" height="16"/>
                            <p:confirm header="Advertencia" message="Esta seguro de continuar?" icon="ui-icon-alert" />
                        </p:commandLink>
                        <p:commandLink title="Imprimir exoneracion" 
                                       rendered="#{exo.exoneracion.exoneracionTipo.id eq 17 or exo.exoneracion.exoneracionTipo.id eq 18 or exo.exoneracion.exoneracionTipo.id eq 37}" actionListener="#{exoneracionesView.imprimirExoClase3y6(exo)}">
                            <p:graphicImage value="/css/homeIconsImages/reporte.png" height="16"/>
                        </p:commandLink>
                    </center>
                </p:column>
            </p:dataTable>

        </h:form>

        <!-- -->

        <p:dialog id="dlgExoAplicada" widgetVar="dlgExoAplicada" header="Solicitud de Exoneración Aplicada" appendTo="@(body)" modal="true" width="80%" resizable="false" closable="true" closeOnEscape="true">
            <h:form id="frmExoAp">
                <p:panel id="pobs" header="Datos de la exoneración" style="width: 100%">

                    <div align="center">
                        <h:outputText value="NUMERO DE SOLICITUD: #{exoneracionesView.exoConsulta.id}" style="font-weight:bold"/>
                        <h:outputText value="#{exoneracionesView.mensajeExoneracion}" style="font-weight:bold"/>
                        <p:panelGrid columns="2">
                            <p:fieldset legend="Liquidación Original" style="font-size: 13px;">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Total a pagar"/>
                                    <p:inputText value="#{exoneracionesView.original.totalPago}"/>
                                </p:panelGrid>
                                <p:dataTable value="#{exoneracionesView.detList1}" var="t1" rows="7" paginator="true"
                                             paginatorPosition="top">
                                    <f:facet name="header">
                                        Rubros
                                    </f:facet>
                                    <p:column>
                                        <center>#{t1.descripcion}</center>
                                    </p:column>
                                    <p:column>
                                        <center>#{t1.valor}</center>
                                    </p:column>
                                </p:dataTable>
                            </p:fieldset>

                            <!-- -->

                            <p:fieldset legend="Liquidación Posterior" style="font-size: 13px;">
                                <p:panelGrid columns="2">
                                    <h:outputText value="Total a pagar"/>
                                    <p:inputText value="#{exoneracionesView.posterior.totalPago}"/>
                                </p:panelGrid>
                                <p:dataTable value="#{exoneracionesView.detList2}" var="t2" rows="7" paginator="true"
                                             paginatorPosition="top">
                                    <f:facet name="header">
                                        Rubros
                                    </f:facet>
                                    <p:column>
                                        <center>#{t2.descripcion}</center>
                                    </p:column>
                                    <p:column>
                                        <center>#{t2.valor}</center>
                                    </p:column>
                                </p:dataTable>
                            </p:fieldset>
                        </p:panelGrid>
                    </div>
                </p:panel>
            </h:form>
        </p:dialog>

        <!-- -->

    </ui:define>
</ui:composition>
