<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="saldoMejorasPorObra" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="10" uuid="3cee3e7f-3793-4d35-889a-a0bcd7805f27">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="962"/>
	<property name="ireport.y" value="39"/>
	<parameter name="LOGO" class="java.lang.String"/>
	<parameter name="ANIO" class="java.lang.Long"/>
	<parameter name="DESDE" class="java.util.Date"/>
	<parameter name="HASTA" class="java.util.Date"/>
	<parameter name="USUARIO" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT o.cuenta_contable,o.concepto,MAX(o.valor_emision_anual) AS valor_emision,prm.ubicacion_obra, SUM(prm.valor) AS valor_recaudado,
    (SELECT razon_social from sgm_application.empresa) AS nombre_empresa
FROM sgm_mejoras.mej_pago_rubro_mejora prm
INNER JOIN sgm_financiero.ren_pago_rubro pr ON (pr.id=prm.rubro_mejora_pago)
INNER JOIN sgm_financiero.ren_pago p ON (pr.pago=p.id)
INNER JOIN sgm_financiero.ren_liquidacion l ON (p.liquidacion=l.id)
INNER JOIN sgm_mejoras.mej_valores_obra_ubicacion vu ON (prm.ubicacion_obra=vu.id)
INNER JOIN sgm_mejoras.mej_obra o ON (vu.obra=o.id)
WHERE o.anio=$P{ANIO}
AND p.fecha_pago::DATE BETWEEN $P{DESDE} AND $P{HASTA} AND p.estado
GROUP BY o.cuenta_contable,o.concepto,prm.ubicacion_obra
ORDER BY prm.ubicacion_obra]]>
	</queryString>
	<field name="cuenta_contable" class="java.lang.String"/>
	<field name="concepto" class="java.lang.String"/>
	<field name="valor_emision" class="java.math.BigDecimal"/>
	<field name="ubicacion_obra" class="java.lang.Long"/>
	<field name="valor_recaudado" class="java.math.BigDecimal"/>
	<field name="nombre_empresa" class="java.lang.String"/>
	<variable name="TOTAL_EMISION" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{valor_emision}]]></variableExpression>
	</variable>
	<variable name="SALDO" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$F{valor_emision}.subtract( $F{valor_recaudado} )]]></variableExpression>
	</variable>
	<variable name="TOTAL_SALDO" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$V{TOTAL_EMISION}.subtract( $V{TOTAL_RECAUDACION} )]]></variableExpression>
	</variable>
	<variable name="TOTAL_RECAUDACION" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{valor_recaudado}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="83" splitType="Stretch">
			<image>
				<reportElement x="0" y="0" width="117" height="53" uuid="1617a664-32eb-4e08-9d8e-b3f5dad9dfbe"/>
				<imageExpression><![CDATA[$P{LOGO}]]></imageExpression>
			</image>
			<textField>
				<reportElement x="533" y="56" width="72" height="12" uuid="74740e5e-44a4-413a-9655-7d63bd5f0d6f"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{ANIO}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="235" y="56" width="296" height="12" uuid="c49def8f-9332-4a73-a59a-dd6a4c7dccd7"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[SALDOS DE MEJORAS POR OBRAS CORRESPONDIENTES AL AÑO]]></text>
			</staticText>
			<staticText>
				<reportElement x="256" y="68" width="46" height="14" uuid="1577a10b-0670-42e5-bc8e-03b2cb0d8206"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Desde:]]></text>
			</staticText>
			<staticText>
				<reportElement x="467" y="68" width="46" height="14" uuid="59f174dc-4037-400d-847f-262f794d049d"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Hasta:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="304" y="68" width="86" height="14" uuid="df14dfd7-2f00-4997-bd5d-008543bd062a"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{DESDE}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="515" y="68" width="90" height="14" uuid="4b25f6d0-d441-4a27-a72d-78ef2ab3db4a"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{HASTA}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="82" width="802" height="1" uuid="6c176393-7957-440d-ab9d-9b47b28955d0"/>
				<graphicElement>
					<pen lineWidth="3.0" lineStyle="Double"/>
				</graphicElement>
			</line>
			<line>
				<reportElement x="0" y="55" width="802" height="1" uuid="595ad799-88bc-4598-a29f-63d0f3a1cae6"/>
			</line>
			<textField>
				<reportElement x="118" y="0" width="684" height="55" uuid="f2464b91-5101-4c22-8b9e-bc219e569796"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre_empresa}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="11" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="12" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="101" height="12" uuid="5c653c0b-2b3a-4aac-91d6-40f4f17d2cda"/>
				<textElement verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CUENTA]]></text>
			</staticText>
			<staticText>
				<reportElement x="101" y="0" width="250" height="12" uuid="514f1c3c-0283-4fa8-ae6f-65fa7fb43bc1"/>
				<textElement verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CONCEPTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="351" y="0" width="80" height="12" uuid="267b188e-dda5-40a5-81c3-d5669d04f2b8"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[EMISION INICIAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="621" y="0" width="80" height="12" uuid="f74247d0-8291-4dac-8843-d62eb9339a83"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[RECAUDACION]]></text>
			</staticText>
			<staticText>
				<reportElement x="711" y="0" width="80" height="12" uuid="30bab6a4-8786-4294-8c00-71b1ab2ebca9"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[SALDO]]></text>
			</staticText>
			<staticText>
				<reportElement x="441" y="0" width="80" height="12" uuid="7e1c3462-eacb-4bff-9aab-a2f5dc8d34f0"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[EMISION]]></text>
			</staticText>
			<staticText>
				<reportElement x="531" y="0" width="80" height="12" uuid="92e5af86-df8d-44c6-aa4a-0842f7184b3f"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[BAJAS]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="24" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="101" y="0" width="250" height="12" uuid="52d07782-a714-4737-ae86-afc9eefa8946"/>
				<textElement textAlignment="Justified">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{concepto}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="0" width="101" height="12" uuid="366afcc6-d08d-452d-9ab0-82dc32ad4c11"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cuenta_contable}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="351" y="0" width="80" height="12" uuid="f8d20637-641d-4607-8103-246d933083ec"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor_emision}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="621" y="0" width="80" height="12" uuid="fb083b2c-15a5-4def-8e73-c362914dd39f"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor_recaudado}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="711" y="0" width="80" height="12" uuid="3799ee7f-153c-4ebf-b0d9-94fb82443095"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SALDO}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="16" splitType="Stretch">
			<line>
				<reportElement x="0" y="0" width="802" height="1" uuid="5ee05f47-69e0-43c3-bce2-47ef921b54c4"/>
			</line>
			<textField isBlankWhenNull="true">
				<reportElement x="23" y="1" width="150" height="15" uuid="b21b3ccf-8990-4153-8b05-1624598214a9"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["USUARIO: "+$P{USUARIO}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" isBlankWhenNull="true">
				<reportElement x="748" y="0" width="40" height="15" uuid="14d58e94-8899-4a7d-ab3d-fefe3b546cd4"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy h:mm a" isBlankWhenNull="true">
				<reportElement x="326" y="1" width="150" height="15" uuid="dfca2310-0353-4c3f-9751-c45071e4ef74"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="668" y="0" width="80" height="15" uuid="a637d373-d106-4d07-82b0-8d3f096b43a2"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Pag "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="26" splitType="Stretch">
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="339" y="0" width="78" height="12" uuid="eeca7e45-cb4e-4384-b9c4-5a988b71e79c"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_EMISION}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="266" y="0" width="73" height="12" uuid="80683c5c-0ed1-4a12-9dd7-645c7435dbfd"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTALES>>>>>]]></text>
			</staticText>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="609" y="0" width="80" height="12" uuid="65142f9b-ec6b-41e0-8883-29f97303f3f8"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_RECAUDACION}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="699" y="0" width="80" height="12" uuid="5490750d-da1d-49ec-990d-bb88bf969fe3"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_SALDO}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
