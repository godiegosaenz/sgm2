<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="saldoPorRubrosPrediales" pageWidth="842" pageHeight="595" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="10" uuid="a56a30ba-edc8-4597-8d24-cbd2285c00d5">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="LOGO" class="java.lang.String"/>
	<parameter name="USUARIO" class="java.lang.String"/>
	<parameter name="TIPO_LIQUIDACION" class="java.lang.Long"/>
	<parameter name="ANIO" class="java.lang.Integer"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\Users\\origami-idea\\Documents\\NetBeansProjects\\workspaceGib\\sgm-reportes-jama\\sgm-reportes\\src\\main\\resources\\reportes\\"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT A.descripcion , A.valor_inicial,  COALESCE(D.emision,0.00) AS emision, COALESCE(C.bajas,0.00) AS bajas, COALESCE(B.valor_recaudado,0.00) AS valor_recaudado
FROM (	SELECT r.id, r.descripcion, COALESCE(vi.valor_inicial,0.00) AS valor_inicial
	FROM  sgm_financiero.ren_rubros_liquidacion r
	LEFT OUTER JOIN sgm_financiero.ren_valor_inicial_emision vi ON (r.id=vi.rubro_liquidacion AND vi.anio=$P{ANIO} AND vi.estado=TRUE)
	WHERE r.tipo_liquidacion=$P{TIPO_LIQUIDACION} AND r.id not in (651,5,653,654,652,648,650,649,9)
) AS A
LEFT OUTER JOIN
  (SELECT pr.rubro, SUM(COALESCE(pr.valor,0.00)) AS valor_recaudado
   FROM sgm_financiero.ren_liquidacion l
   INNER JOIN sgm_financiero.ren_pago p ON (l.id=p.liquidacion)
   INNER JOIN sgm_financiero.ren_pago_rubro pr ON (p.id=pr.pago)
   WHERE l.tipo_liquidacion=$P{TIPO_LIQUIDACION} AND (l.estado_liquidacion=1 )
   AND l.anio=$P{ANIO} AND p.estado=TRUE
   GROUP BY pr.rubro) AS B ON (A.id=B.rubro)
LEFT OUTER JOIN
  (
  SELECT dl.rubro, NULLIF(SUM(dl.valor-COALESCE(dlp.valor,0.00)),0.00) AS bajas
   FROM sgm_financiero.fn_exoneracion_liquidacion el
   INNER JOIN sgm_financiero.ren_liquidacion l ON (el.liquidacion=l.id)
   INNER JOIN sgm_financiero.ren_det_liquidacion dl ON (l.id=dl.liquidacion)
   LEFT OUTER JOIN sgm_financiero.ren_liquidacion lp ON (el.liquidacion_posterior=lp.id AND lp.anio=$P{ANIO} AND lp.tipo_liquidacion=$P{TIPO_LIQUIDACION} )
   LEFT OUTER JOIN sgm_financiero.ren_det_liquidacion dlp ON (lp.id=dlp.liquidacion AND dl.rubro=dlp.rubro)
   WHERE  l.tipo_liquidacion=$P{TIPO_LIQUIDACION}
   GROUP BY dl.rubro
   ) AS C ON (A.id=C.rubro)
LEFT OUTER JOIN
  (
  SELECT dlp.rubro, COALESCE(SUM(dlp.valor),0.00) AS emision
   FROM sgm_financiero.fn_exoneracion_liquidacion el
   INNER JOIN sgm_financiero.ren_liquidacion lp ON (el.liquidacion_posterior=lp.id)
   LEFT OUTER JOIN sgm_financiero.ren_det_liquidacion dlp ON (lp.id=dlp.liquidacion)
   WHERE lp.anio=$P{ANIO} AND lp.tipo_liquidacion=$P{TIPO_LIQUIDACION} AND el.liquidacion IS NULL
   GROUP BY dlp.rubro
) AS D ON (A.id=D.rubro)
ORDER BY A.id]]>
	</queryString>
	<field name="descripcion" class="java.lang.String"/>
	<field name="valor_inicial" class="java.math.BigDecimal"/>
	<field name="emision" class="java.math.BigDecimal"/>
	<field name="bajas" class="java.math.BigDecimal"/>
	<field name="valor_recaudado" class="java.math.BigDecimal"/>
	<variable name="SALDO" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$F{valor_inicial}.subtract( $F{valor_recaudado})]]></variableExpression>
	</variable>
	<variable name="TOTAL_EMISION" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{valor_inicial}]]></variableExpression>
	</variable>
	<variable name="TOTAL_RECAUDACION" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{valor_recaudado}]]></variableExpression>
	</variable>
	<variable name="TOTAL_SALDO" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{SALDO}]]></variableExpression>
	</variable>
	<variable name="TOTAL_EMISIONES" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{emision}]]></variableExpression>
	</variable>
	<variable name="TOTAL_BAJAS" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{bajas}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="100" splitType="Stretch">
			<subreport>
				<reportElement x="124" y="0" width="555" height="68" uuid="3fda5828-99cf-49b9-bf04-e2c87086410d"/>
				<subreportParameter name="LOGO">
					<subreportParameterExpression><![CDATA[$P{LOGO}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "titleReporte.jasper"]]></subreportExpression>
			</subreport>
			<textField>
				<reportElement x="124" y="68" width="555" height="32" uuid="0647d0ce-3777-486d-8813-56ebcedd0e45"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["SALDOS POR RUBROS DE PREDIOS "+($P{TIPO_LIQUIDACION}==13L?"URBANOS ":"RUSTICOS ")+"CORRESPONDIENTE AL AÑO "+$P{ANIO}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="48" splitType="Stretch">
			<staticText>
				<reportElement x="107" y="22" width="253" height="20" uuid="53671d02-2d41-46d6-ae35-4f0e524dcced"/>
				<textElement verticalAlignment="Bottom">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[DESCRIPCION DEL RUBRO.]]></text>
			</staticText>
			<staticText>
				<reportElement x="385" y="22" width="119" height="20" uuid="8768b42c-bb64-49f6-aec4-4bb0c92e0976"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[VALOR EMISION INICIAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="513" y="22" width="100" height="20" uuid="b7ea57c1-5432-4b6c-9787-017e76004389"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[VALOR RECAUDADO]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="15" splitType="Stretch">
			<textField>
				<reportElement x="107" y="0" width="253" height="15" uuid="54c537d0-0ce8-4fff-940e-d867f7c5f665"/>
				<textElement>
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00">
				<reportElement x="398" y="0" width="106" height="15" uuid="82f849da-9d06-468a-adc0-2ccc6580de16"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor_inicial}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00">
				<reportElement x="513" y="0" width="100" height="15" uuid="03c09d18-2f3b-490e-9246-77d333040886"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor_recaudado}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="16" splitType="Stretch">
			<textField>
				<reportElement x="593" y="1" width="80" height="15" uuid="b707fef9-e4f1-4b26-adf9-35df7b0ef2a2"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Pag "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="673" y="1" width="40" height="15" uuid="feedccaf-06ca-42f6-8491-55b69b7ec95c"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="107" y="1" width="150" height="15" uuid="9e1e7dd4-e8af-4dba-9c15-16f786c41186"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["USUARIO: "+$P{USUARIO}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy h:mm a">
				<reportElement x="382" y="1" width="150" height="15" uuid="dff88df2-73af-49e0-b987-53ac1a1dc9f7"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="20" y="0" width="759" height="1" uuid="0505e0e1-6077-42ce-bc94-c588a97b7ddf"/>
			</line>
		</band>
	</pageFooter>
	<summary>
		<band height="42" splitType="Stretch">
			<textField pattern="¤ #,##0.00">
				<reportElement x="513" y="0" width="100" height="15" uuid="2b35b1a4-ce30-4233-9132-563d6b829375"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_RECAUDACION}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00">
				<reportElement x="398" y="0" width="106" height="15" uuid="1a9b6f42-cb96-4187-9c0c-b1e02cfdb4c6"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_EMISION}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="292" y="0" width="106" height="15" uuid="68109c23-c7a1-4c4b-af05-6fcb65dd4c77"/>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTALES>>>]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
