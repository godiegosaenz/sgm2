<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="desgloseImpuestoUrbano_subreport1" language="groovy" pageWidth="802" pageHeight="555" orientation="Landscape" columnWidth="802" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="600c73ed-2331-4ee4-a67e-c39a3e24591b">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="FECHA" class="java.lang.String"/>
	<parameter name="USUARIO" class="java.lang.Long"/>
	<queryString>
		<![CDATA[select upper(ba.descripcion) as nombre_banco, de.ch_num_cuenta, de.ch_num_cheque, liq.anio,
pa.num_comprobante, us.usuario, ti.nombre_transaccion, de.valor,
CASE WHEN liq.comprador IS NULL THEN liq.nombre_comprador ELSE
TRIM(UPPER(CASE en.es_persona WHEN TRUE THEN COALESCE(en.apellidos,'')||' '||COALESCE(en.nombres,'')
ELSE COALESCE(en.razon_social,'') END)) END propietario
from sgm_financiero.ren_pago_detalle as de
left join sgm_financiero.ren_pago as pa on (pa.id = de.pago)
left join sgm_financiero.ren_liquidacion as liq on (liq.id = pa.liquidacion)
left join sgm_financiero.ren_tipo_liquidacion as ti on (ti.id = liq.tipo_liquidacion)
left join sgm_financiero.ren_entidad_bancaria as ba on (ba.id = de.ch_banco)
left join sgm_app.acl_user as us on (us.id = pa.cajero)
left join sgm_app.cat_ente as en on (en.id = liq.comprador)
where to_char(pa.fecha_pago, 'dd-mm-yyyy') = $P{FECHA} and pa.estado= TRUE
and de.tipo_pago = 4
and (CASE WHEN $P{USUARIO} IS NOT NULL AND $P{USUARIO}!=144 THEN pa.cajero=$P{USUARIO} ELSE TRUE END)
order by nombre_banco, de.ch_num_cuenta, de.ch_num_cheque, pa.num_comprobante]]>
	</queryString>
	<field name="nombre_banco" class="java.lang.String"/>
	<field name="ch_num_cuenta" class="java.lang.String"/>
	<field name="ch_num_cheque" class="java.lang.String"/>
	<field name="anio" class="java.lang.Integer"/>
	<field name="num_comprobante" class="java.lang.Long"/>
	<field name="usuario" class="java.lang.String"/>
	<field name="nombre_transaccion" class="java.lang.String"/>
	<field name="valor" class="java.math.BigDecimal"/>
	<field name="propietario" class="java.lang.String"/>
	<variable name="gran_total" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{valor}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
	</variable>
	<variable name="total_banco" class="java.math.BigDecimal" resetType="Group" resetGroup="group_nom_banco" calculation="Sum">
		<variableExpression><![CDATA[$F{valor}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
	</variable>
	<variable name="total_cta" class="java.math.BigDecimal" resetType="Group" resetGroup="group_no_cuenta" calculation="Sum">
		<variableExpression><![CDATA[$F{valor}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
	</variable>
	<variable name="total_ch" class="java.math.BigDecimal" resetType="Group" resetGroup="group_no_cheque" calculation="Sum">
		<variableExpression><![CDATA[$F{valor}]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
	</variable>
	<group name="group_nom_banco">
		<groupExpression><![CDATA[$F{nombre_banco}]]></groupExpression>
		<groupHeader>
			<band height="28">
				<textField>
					<reportElement uuid="56ccd1e1-b218-40f3-a315-e7eb82cd460b" x="0" y="0" width="441" height="16"/>
					<textElement verticalAlignment="Middle">
						<font size="12" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{nombre_banco}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement uuid="ce05e504-d280-4460-9f40-bda3ac5016eb" x="1" y="16" width="100" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Nº Cuenta]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="33d38ded-fd6e-4315-b3c2-912c34d3780a" x="101" y="16" width="75" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Nº Cheque]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="8f0beaa8-bfff-467f-bddf-e817cc3060d8" x="211" y="16" width="75" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Nº Ingreso]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="a10da4fd-6307-46dd-8088-a3f289ded98e" x="176" y="16" width="35" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Año]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="cd8df775-3413-47be-ae68-b23ff727f373" x="286" y="16" width="66" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Cajero]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="b0c80e37-40be-4587-b5e9-377aa6dca71e" x="352" y="16" width="200" height="12"/>
					<box>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Contribuyente]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="612940d2-0b8e-4286-bbe5-7a841046329c" x="552" y="16" width="150" height="12"/>
					<box leftPadding="3">
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Descripción]]></text>
				</staticText>
				<staticText>
					<reportElement uuid="7e3e5861-ccdd-4965-b1a7-e5913fb334c7" x="702" y="16" width="100" height="12"/>
					<box rightPadding="3">
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Valor]]></text>
				</staticText>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="15">
				<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
					<reportElement uuid="175f2820-98e8-46c1-be70-0ee2a816b23f" x="552" y="0" width="150" height="15" isPrintWhenDetailOverflows="true"/>
					<box rightPadding="2">
						<topPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="9" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{total_banco}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement uuid="50edd3b3-4f5a-4e29-95f2-c6ab18b425a0" x="101" y="0" width="451" height="15"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="9" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["TOTAL " + $F{nombre_banco}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="group_no_cuenta">
		<groupExpression><![CDATA[$F{ch_num_cuenta}]]></groupExpression>
		<groupFooter>
			<band height="15">
				<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
					<reportElement uuid="e65d1156-3cd7-43bb-9a6f-25d1ed29e210" x="702" y="0" width="100" height="15" isPrintWhenDetailOverflows="true"/>
					<box>
						<topPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{total_cta}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement uuid="8793b390-2dab-4a70-95f0-0dd8a5f902cf" x="552" y="0" width="150" height="15"/>
					<textElement verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Total Cta. Nº " + $F{ch_num_cuenta}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="group_no_cheque">
		<groupExpression><![CDATA[$F{ch_num_cheque}]]></groupExpression>
		<groupFooter>
			<band height="15">
				<textField>
					<reportElement uuid="e30abf24-edf8-49e3-a420-334821e4e4ce" x="552" y="0" width="150" height="15"/>
					<textElement verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Total Ch/. Nº " + $F{ch_num_cheque}]]></textFieldExpression>
				</textField>
				<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
					<reportElement uuid="b7885a1d-be94-4bf3-b99e-7274e7178089" x="702" y="0" width="100" height="15" isPrintWhenDetailOverflows="true"/>
					<box>
						<topPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{total_ch}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<detail>
		<band height="12" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement uuid="b7537986-6598-4b9c-9364-c7f47361267b" x="1" y="0" width="100" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ch_num_cuenta}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="68489856-e419-4124-9a86-797b7d81cd73" x="101" y="0" width="75" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ch_num_cheque}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="607362ef-aea8-46dc-b18a-ae3c8e048f32" x="176" y="0" width="35" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{anio}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="d17c1b8a-c417-4e9f-b2ae-c0c5cfb26888" x="211" y="0" width="75" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{num_comprobante}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="543d6a19-7a7f-442e-9b52-73434c6d73a8" x="286" y="0" width="66" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{usuario}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="b8ba06fa-f732-4015-99b2-062bb98ddcc7" x="352" y="0" width="200" height="12" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{propietario}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="593f8dce-32ca-4882-baa9-79f4f988db54" x="552" y="0" width="150" height="12" isPrintWhenDetailOverflows="true"/>
				<box leftPadding="3"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre_transaccion}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement uuid="3420e465-4581-4840-a6ed-a42c8ea8e823" x="702" y="0" width="100" height="12" isPrintWhenDetailOverflows="true"/>
				<box rightPadding="0"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="25">
			<staticText>
				<reportElement uuid="53ff1c4a-ce81-4d4d-93d0-e3acee0d74a0" x="256" y="0" width="85" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<bottomPen lineWidth="3.0" lineStyle="Double"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[GRAN TOTAL:]]></text>
			</staticText>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement uuid="a341e1f4-9160-4d76-bb55-58e703ff5a05" x="352" y="0" width="150" height="20" isPrintWhenDetailOverflows="true"/>
				<box>
					<pen lineStyle="Double"/>
					<topPen lineStyle="Double"/>
					<leftPen lineStyle="Double"/>
					<bottomPen lineWidth="3.0" lineStyle="Double"/>
					<rightPen lineStyle="Double"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{gran_total}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
