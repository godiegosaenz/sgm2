<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="asignacionDepartamento" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="5" bottomMargin="5" uuid="b0131eae-5866-4d66-a0e6-55c9720e0488">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" fill="Solid" hAlign="Center" vAlign="Middle"/>
	<subDataset name="DEPARTAMENTOS" uuid="11fd3b16-4f83-4e4d-9bfb-1c0e642b69dd">
		<parameter name="SOLICITUD" class="java.lang.Long">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<queryString>
			<![CDATA[SELECT
    D.NOMBRE AS NOMBRE_DEP,
    COALESCE(ED.NOMBRES) || ' ' || COALESCE(ED.APELLIDOS) AS NOMBRE_DIR_DEP
FROM
   sgm_flow.sv_solicitud_departamento SD INNER JOIN sgm_app.GE_DEPARTAMENTO D ON D.ID = SD.DEPARTAMENTO
   INNER JOIN sgm_app.ACL_USER UD ON UD.ID = SD.DIRECTOR INNER JOIN sgm_app.CAT_ENTE ED ON ED.ID = UD.ENTE
WHERE
   SD.SOLICITUD = $P{SOLICITUD} AND SD.ID >= (SELECT MIN(ID) FROM sgm_flow.sv_solicitud_departamento WHERE solicitud=$P{SOLICITUD})
ORDER BY
   SD.ID ASC,D.NOMBRE ASC
LIMIT 3]]>
		</queryString>
		<field name="nombre_dep" class="java.lang.String"/>
		<field name="nombre_dir_dep" class="java.lang.String"/>
	</subDataset>
	<subDataset name="DEPARTAMENTOS_1" uuid="9d9f2b63-1015-4b1e-a25a-358a7f91847f">
		<parameter name="SOLICITUD" class="java.lang.Long">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<queryString>
			<![CDATA[SELECT
    D.NOMBRE AS NOMBRE_DEP,
    COALESCE(ED.NOMBRES) || ' ' || COALESCE(ED.APELLIDOS) AS NOMBRE_DIR_DEP
FROM
   sgm_flow.sv_solicitud_departamento SD INNER JOIN sgm_app.GE_DEPARTAMENTO D ON D.ID = SD.DEPARTAMENTO
   INNER JOIN sgm_app.ACL_USER UD ON UD.ID = SD.DIRECTOR INNER JOIN sgm_app.CAT_ENTE ED ON ED.ID = UD.ENTE
WHERE
   SD.SOLICITUD = $P{SOLICITUD} AND SD.ID >(SELECT MAX(a.id) FROM (SELECT dp.id FROM sgm_flow.sv_solicitud_departamento dp WHERE dp.solicitud=$P{SOLICITUD} ORDER BY 1 LIMIT 3) as a)
ORDER BY
   D.NOMBRE ASC
LIMIT 3]]>
		</queryString>
		<field name="nombre_dep" class="java.lang.String"/>
		<field name="nombre_dir_dep" class="java.lang.String"/>
	</subDataset>
	<parameter name="SOLICITUD" class="java.lang.Long">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="FECHA" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[new java.util.Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="TRAMITE" class="java.lang.Long"/>
	<parameter name="LOGO" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[java.lang.System.getProperty("user.home") + "\\Documents\\NetBeansProjects\\sgm\\src\\main\\webapp\\css\\homeIconsImages\\logo.jpg"]]></defaultValueExpression>
	</parameter>
	<parameter name="OBSERVACION" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="LOGO_FOOTER" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
    s.id,
    s.representante,
    s.descripcion_inconveniente,
    s.nota_guia,
    ht.nombre_propietario,
    ht.id AS num_tramite,
    ui.usuario,
    (SELECT razon_social from sgm_application.empresa) AS nombre_empresa
FROM
    sgm_flow.sv_solicitud_servicios s INNER JOIN sgm_flow.historico_tramites ht ON ht.id_tramite = s.tramite
     INNER JOIN sgm_app.ACL_USER UI ON UI.ID = ht.user_creador
WHERE
    s.id = $P{SOLICITUD}]]>
	</queryString>
	<field name="id" class="java.lang.Long"/>
	<field name="representante" class="java.lang.String"/>
	<field name="descripcion_inconveniente" class="java.lang.String"/>
	<field name="nota_guia" class="java.lang.String"/>
	<field name="nombre_propietario" class="java.lang.String"/>
	<field name="num_tramite" class="java.lang.Long"/>
	<field name="usuario" class="java.lang.String"/>
	<field name="nombre_empresa" class="java.lang.String"/>
	<variable name="count" class="java.lang.Integer" resetType="Column" calculation="Count">
		<variableExpression><![CDATA[$F{id}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="108" splitType="Stretch">
			<image onErrorType="Blank">
				<reportElement x="0" y="0" width="90" height="81" uuid="110b777f-2abf-4edd-80d8-a4346fbb87b7"/>
				<imageExpression><![CDATA[$P{LOGO}]]></imageExpression>
			</image>
			<frame>
				<reportElement x="596" y="55" width="191" height="32" uuid="9ed929f2-c75c-4b94-901d-a230136a8163"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textField evaluationTime="Band">
					<reportElement x="72" y="11" width="119" height="20" uuid="146e8fe1-d2bd-4115-8b30-393130433805"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{num_tramite}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="13" y="11" width="59" height="20" uuid="2c4a33e9-e58b-4ce7-94bb-cca88ccc5db5"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Trámite: ]]></text>
				</staticText>
			</frame>
			<textField pattern="MMMMM dd, yyyy HH:mm">
				<reportElement x="90" y="88" width="170" height="20" uuid="d90a0ada-5f14-4a6e-b9d1-8083ff46f37f"/>
				<textFieldExpression><![CDATA[$P{FECHA}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="88" width="90" height="20" uuid="1b5d482c-895e-49bf-914c-6d85405cf2e1"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha de envió: ]]></text>
			</staticText>
			<textField>
				<reportElement x="90" y="0" width="712" height="53" uuid="9f0f85fa-f2af-41d9-a911-e3e70bb9d7d1"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre_empresa}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<columnHeader>
		<band height="15">
			<staticText>
				<reportElement x="0" y="0" width="48" height="14" uuid="03962895-47eb-47c5-ba48-9157178aebfe"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[No.]]></text>
			</staticText>
			<staticText>
				<reportElement x="48" y="0" width="391" height="14" uuid="c31582ba-b91e-43da-8846-fc65c91e0761"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Contribuyente/Departamento]]></text>
			</staticText>
			<staticText>
				<reportElement x="439" y="0" width="229" height="14" uuid="6d17a2ee-96f2-451c-885d-274c063f95fa"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Asunto]]></text>
			</staticText>
			<staticText>
				<reportElement x="672" y="0" width="130" height="14" uuid="d4e05ad5-3d55-4f75-bae2-d40903de8bd8"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Observacion]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="14" width="802" height="1" uuid="12355e6c-4d3a-4769-857f-b742e1af1b08"/>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="44" splitType="Stretch">
			<textField evaluationTime="Column">
				<reportElement x="0" y="0" width="48" height="20" uuid="0e3ed3d9-5ca3-4c84-9609-a1caf88c9f77"/>
				<textFieldExpression><![CDATA[$V{count}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement x="48" y="0" width="391" height="20" uuid="4f969534-bbb3-475b-9f6d-1aa0c13b5008"/>
				<textFieldExpression><![CDATA[($F{representante} == null)? $F{nombre_propietario} : $F{representante}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="439" y="1" width="229" height="20" uuid="d4e391aa-9959-4fd2-a905-efc2b2287620"/>
				<textFieldExpression><![CDATA[$F{descripcion_inconveniente}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="672" y="0" width="130" height="20" uuid="9910d095-5d76-4258-ab43-89c16edebea2"/>
				<textFieldExpression><![CDATA[$P{OBSERVACION}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="0" y="24" width="462" height="20" isRemoveLineWhenBlank="true" uuid="9ff2021f-3986-4b1a-8358-e38edf9f2da8">
					<printWhenExpression><![CDATA[$F{nota_guia}!=null]]></printWhenExpression>
				</reportElement>
				<textElement>
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Nota: "+$F{nota_guia}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<lastPageFooter>
		<band height="50">
			<image hAlign="Left" vAlign="Middle">
				<reportElement mode="Opaque" x="2" y="0" width="245" height="50" uuid="3d7e1627-8247-4de0-a5ba-60f5e01af55c"/>
				<imageExpression><![CDATA[$P{LOGO_FOOTER}]]></imageExpression>
			</image>
		</band>
	</lastPageFooter>
	<summary>
		<band height="124" splitType="Stretch">
			<componentElement>
				<reportElement style="Crosstab Data Text" x="102" y="7" width="277" height="90" uuid="f12e1cb7-1659-4379-816b-33822a6f3851"/>
				<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" printOrder="Vertical" ignoreWidth="true">
					<datasetRun subDataset="DEPARTAMENTOS" uuid="937a1bc8-0755-4e02-bd90-f3f4defbff76">
						<datasetParameter name="SOLICITUD">
							<datasetParameterExpression><![CDATA[$P{SOLICITUD}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:listContents height="90" width="277">
						<textField isStretchWithOverflow="true">
							<reportElement x="6" y="67" width="266" height="12" isRemoveLineWhenBlank="true" uuid="a08222f3-f88d-4402-b1b3-ae2290243087"/>
							<textElement textAlignment="Center">
								<font size="8"/>
							</textElement>
							<textFieldExpression><![CDATA["Director(a) " + $F{nombre_dep}]]></textFieldExpression>
						</textField>
						<textField isStretchWithOverflow="true">
							<reportElement x="6" y="55" width="266" height="12" isRemoveLineWhenBlank="true" uuid="dadd2bd3-6049-437d-8edc-0d1626093785"/>
							<textElement textAlignment="Center">
								<font size="9"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{nombre_dir_dep}]]></textFieldExpression>
						</textField>
						<rectangle>
							<reportElement x="5" y="0" width="266" height="56" isRemoveLineWhenBlank="true" uuid="f8ee56d0-7b80-4afc-ae14-861098bcf20b"/>
						</rectangle>
					</jr:listContents>
				</jr:list>
			</componentElement>
			<staticText>
				<reportElement x="0" y="7" width="102" height="20" uuid="35f2f202-28e5-4117-b098-473cfd8a8929"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Departemento(s): ]]></text>
			</staticText>
			<staticText>
				<reportElement x="656" y="7" width="146" height="20" uuid="1742bea2-84bd-4295-87e5-2d2576462a1c"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Elaborado por:]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="27" width="102" height="20" uuid="fc02c69a-3b55-4b85-a450-bc84d67c0218"/>
				<text><![CDATA[Recibido por:]]></text>
			</staticText>
			<componentElement>
				<reportElement style="Crosstab Data Text" x="379" y="7" width="277" height="90" uuid="17dd9418-b6cd-4d22-8168-a751db726454"/>
				<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" printOrder="Vertical" ignoreWidth="true">
					<datasetRun subDataset="DEPARTAMENTOS_1" uuid="8c045cad-f5ae-49ff-b092-07dc34f5cf5d">
						<datasetParameter name="SOLICITUD">
							<datasetParameterExpression><![CDATA[$P{SOLICITUD}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:listContents height="90" width="277">
						<textField isStretchWithOverflow="true">
							<reportElement x="6" y="67" width="266" height="12" uuid="2ff8bee6-b2e2-4ebd-81da-5d94589413fa"/>
							<textElement textAlignment="Center">
								<font size="8"/>
							</textElement>
							<textFieldExpression><![CDATA["Director(a) " + $F{nombre_dep}]]></textFieldExpression>
						</textField>
						<textField isStretchWithOverflow="true">
							<reportElement x="6" y="55" width="266" height="12" uuid="a4cdaa54-2d3d-479e-ad65-c6c7d1b21960"/>
							<textElement textAlignment="Center">
								<font size="9"/>
							</textElement>
							<textFieldExpression><![CDATA[$F{nombre_dir_dep}]]></textFieldExpression>
						</textField>
						<rectangle>
							<reportElement x="5" y="0" width="266" height="56" uuid="d4665fd6-e47e-4116-9d77-70502bf9c6d7"/>
						</rectangle>
					</jr:listContents>
				</jr:list>
			</componentElement>
		</band>
	</summary>
</jasperReport>
