<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="resumenDepartamento" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="aad27ee5-2e93-4639-a7c1-1ae73af853cb">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="60"/>
	<property name="ireport.y" value="15"/>
	<parameter name="estado" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="inicio" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fin" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="logo" class="java.lang.String">
		<defaultValueExpression><![CDATA["C:\\Users\\supergold\\Documents\\sgm\\src\\main\\webapp\\css\\homeIconsImages\\logo.jpg"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
     CASE WHEN d.nombre IS null THEN 'SIN ASIGNAR' else d."nombre" END AS departamento,
     COUNT(ht.id) AS numTramitesDep
FROM
     sgm_flow."historico_tramites" ht LEFT JOIN sgm_flow."sv_solicitud_servicios" ss
     ON (ss."tramite" = ht."id_tramite")
     LEFT JOIN sgm_flow."sv_solicitud_departamento" sd ON sd."solicitud" = ss."id"
     LEFT JOIN sgm_app."ge_departamento" d ON d."id" = sd."departamento"
WHERE
     ht.tipo_tramite = 20 AND
     ht.estado = $P{estado} AND
     (CASE WHEN d.nombre IS NULL THEN
          (SELECT COUNT(ssd.id) FROM sgm_flow."sv_solicitud_departamento" ssd WHERE ssd.solicitud = ss.id) = 0
     WHEN d.nombre IS NOT NULL THEN
          (SELECT COUNT(ssd.id) FROM sgm_flow."sv_solicitud_departamento" ssd WHERE ssd.solicitud = ss.id) = 1
     END
           ) AND
     to_char(ht.fecha, 'YYYY-MM-DD') BETWEEN $P{inicio} AND $P{fin}
GROUP BY
     d.nombre,
     ht.tipo_tramite]]>
	</queryString>
	<field name="departamento" class="java.lang.String"/>
	<field name="numtramitesdep" class="java.lang.Long"/>
	<variable name="total" class="java.lang.Long" resetType="None" calculation="Sum">
		<variableExpression><![CDATA[$F{numtramitesdep}]]></variableExpression>
	</variable>
	<variable name="numtramitesdep_1" class="java.lang.Long" calculation="Sum">
		<variableExpression><![CDATA[$F{numtramitesdep}]]></variableExpression>
		<initialValueExpression><![CDATA[0L]]></initialValueExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="129" splitType="Stretch">
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="398" y="95" width="80" height="20" uuid="0f01c3bb-12d7-44f6-9044-77ea89c4a172"/>
				<textFieldExpression><![CDATA[$P{fin}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="164" y="95" width="52" height="20" uuid="f1aba35f-669e-4854-83f7-c8a3bf622171"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Desde: ]]></text>
			</staticText>
			<staticText>
				<reportElement x="345" y="95" width="52" height="20" uuid="e7fbd80c-88fb-4893-a845-e0efb8afdf1d"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Hasta: ]]></text>
			</staticText>
			<staticText>
				<reportElement x="139" y="27" width="370" height="27" uuid="0efbf03b-f3c0-4261-b36e-6c0a6f4073c4"/>
				<textElement textAlignment="Center">
					<font size="20"/>
				</textElement>
				<text><![CDATA[Resumen Solicitud de Servicios]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="217" y="95" width="80" height="20" uuid="7dade1f9-2e3e-43fb-a925-056767f6f2e3"/>
				<textFieldExpression><![CDATA[$P{inicio}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="1" y="1" width="115" height="115" uuid="424365f4-e161-4f3b-97a9-383b52519980"/>
				<imageExpression><![CDATA[$P{logo}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="139" y="54" width="370" height="27" uuid="395a5890-87f4-4c7e-90a8-c9b6871833a8"/>
				<textElement textAlignment="Center">
					<font size="20"/>
				</textElement>
				<text><![CDATA[Por Departamento]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="24" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="405" height="20" uuid="c45473d8-a703-4e65-9a34-53eee53b6141"/>
				<textElement>
					<font size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[DEPARTAMENTOS]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="23" width="534" height="1" forecolor="#000000" uuid="db4d2c57-4fde-4b61-84e6-537c8e34c0c5"/>
			</line>
			<textField>
				<reportElement x="404" y="1" width="130" height="20" uuid="e224062b-4d35-4bff-93c2-3b8fd190a50f"/>
				<textElement textAlignment="Right">
					<font size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{estado}.toUpperCase()]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="22" splitType="Stretch">
			<textField>
				<reportElement x="1" y="0" width="405" height="18" uuid="38b524a6-85c2-48ea-8435-bf7d4d511b0f"/>
				<textFieldExpression><![CDATA[$F{departamento}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="406" y="0" width="128" height="18" uuid="2e1da5e5-d328-4bf7-b96c-6d28d9441a2a"/>
				<textElement textAlignment="Right">
					<font size="13"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{numtramitesdep}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="50" splitType="Stretch">
			<frame>
				<reportElement mode="Transparent" x="0" y="2" width="555" height="22" forecolor="#FFFFFF" backcolor="#990000" uuid="c1e20ff5-ec4c-40a8-8cbb-46619e234a43"/>
				<staticText>
					<reportElement x="1" y="0" width="405" height="20" uuid="ed97c90b-e403-4747-955c-a87bb113d63b"/>
					<textElement>
						<font size="14" isBold="true"/>
					</textElement>
					<text><![CDATA[Total TrÃ¡mites ]]></text>
				</staticText>
				<textField isBlankWhenNull="true">
					<reportElement x="408" y="0" width="126" height="20" uuid="273a8a8b-fbd0-44bc-b4d1-b3a7251849fd"/>
					<textElement textAlignment="Right">
						<font size="14" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{numtramitesdep_1}]]></textFieldExpression>
				</textField>
			</frame>
			<line>
				<reportElement mode="Opaque" x="1" y="0" width="533" height="1" forecolor="#000000" uuid="abd93c4a-70af-4471-869d-67a499185275"/>
			</line>
		</band>
	</summary>
</jasperReport>
