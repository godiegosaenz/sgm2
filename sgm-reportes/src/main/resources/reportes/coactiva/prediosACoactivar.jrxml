<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="prediosACoactivar" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="dd322472-5aae-4391-b5a2-25c0c9615fd4">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[
"C:\\Users\\Juan Carlos\\Documents\\NetBeansProjects\\ReportesSanVicente\\trunk\\src\\main\\resources\\reportes\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="LOGO" class="java.lang.String"/>
	<parameter name="LOGO_FOOTER" class="java.lang.String"/>
	<parameter name="PREDIOS" class="java.util.Collection"/>
	<parameter name="LOGO2" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT L.ANIO,P.NUM_PREDIO,P.CLAVE_CAT AS COD_PREDIAL,
CASE WHEN L.COMPRADOR IS NULL THEN L.NOMBRE_COMPRADOR ELSE UPPER(CASE E.ES_PERSONA WHEN TRUE THEN TRIM(COALESCE(E.NOMBRES, '') || ' ' || COALESCE(E.APELLIDOS, '')) ELSE TRIM(E.RAZON_SOCIAL) END) END AS CONTRIBUYENTE,L.SALDO,L.ESTADO_COACTIVA,
CASE
WHEN (L.ANIO= EXTRACT(YEAR FROM NOW())) AND (EXTRACT(MONTH FROM NOW())<7) THEN
	ROUND( D.VALOR*(SELECT PORCENTAJE FROM SGM_APP.CTLG_DESCUENTO_EMISION WHERE NUM_MES=EXTRACT(MONTH FROM NOW()) AND NUM_QUINCENA=(CASE WHEN EXTRACT(DAY FROM NOW())>15 THEN 2 ELSE 1 END))/100,2)
WHEN (L.ANIO<EXTRACT(YEAR FROM NOW())) THEN
	(ROUND((D.VALOR*0.1),2) +ROUND
	( (L.SALDO)*(SELECT SUM(PORCENTAJE*DIAS)/360
FROM SGM_FINANCIERO.REN_INTERESES I
WHERE I.DESDE>=TO_DATE('01-01-'||L.ANIO+1,'DD-MM-YYYY') AND I.HASTA<= TO_DATE('01-'||EXTRACT(MONTH FROM NOW())+1||'-'||EXTRACT(YEAR FROM NOW()),'DD-MM-YYYY')),2))
ELSE ROUND((D.VALOR*0.1),2) END AS VALOR_COMPLEMENTO
FROM SGM_FINANCIERO.REN_LIQUIDACION L
INNER JOIN SGM_FINANCIERO.REN_DET_LIQUIDACION D ON (L.ID=D.LIQUIDACION AND D.RUBRO=2)
INNER JOIN SGM_APP.CAT_PREDIO P ON (L.PREDIO=P.ID)
LEFT OUTER JOIN SGM_APP.CAT_ENTE E ON (L.COMPRADOR=E.ID)
WHERE L.ESTADO_LIQUIDACION=2 AND L.TIPO_LIQUIDACION=13
AND $X{IN,L.PREDIO,PREDIOS} AND L.ANIO<EXTRACT(YEAR FROM NOW())
ORDER BY 2 DESC,1 ASC]]>
	</queryString>
	<field name="anio" class="java.lang.Integer"/>
	<field name="num_predio" class="java.lang.Long"/>
	<field name="cod_predial" class="java.lang.String"/>
	<field name="contribuyente" class="java.lang.String"/>
	<field name="saldo" class="java.math.BigDecimal"/>
	<field name="estado_coactiva" class="java.lang.Integer"/>
	<field name="valor_complemento" class="java.math.BigDecimal"/>
	<variable name="IMPUESTO" class="java.math.BigDecimal">
		<variableExpression><![CDATA[($F{saldo} == null? new BigDecimal("0.00") : $F{saldo}).add( ($F{valor_complemento} == null? new BigDecimal("0.00") : $F{valor_complemento}) )]]></variableExpression>
	</variable>
	<variable name="COACTIVA" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$F{estado_coactiva}==2?$V{IMPUESTO}.multiply( new BigDecimal("0.1") ):new BigDecimal("0.00")]]></variableExpression>
	</variable>
	<variable name="TOTAL" class="java.math.BigDecimal">
		<variableExpression><![CDATA[($V{IMPUESTO} == null? java.math.BigDecimal.ZERO : $V{IMPUESTO}).add( ($V{COACTIVA} == null? java.math.BigDecimal.ZERO :$V{COACTIVA}).setScale(2, RoundingMode.HALF_UP) )]]></variableExpression>
	</variable>
	<variable name="SUMA_IMPUESTO" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{IMPUESTO}]]></variableExpression>
	</variable>
	<variable name="SUMA_COACTIVA" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{COACTIVA}]]></variableExpression>
	</variable>
	<variable name="SUMA_TOTAL" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{TOTAL}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="95" splitType="Stretch">
			<staticText>
				<reportElement x="151" y="71" width="245" height="23" uuid="95e828e1-4baa-4bd6-9819-013ba68da0ee"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[PREDIOS A COACTIVAR]]></text>
			</staticText>
			<subreport>
				<reportElement x="0" y="0" width="555" height="67" uuid="5e2fda54-746b-4205-9836-e90adc31d6f7"/>
				<subreportParameter name="LOGO2">
					<subreportParameterExpression><![CDATA[$P{LOGO2}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="LOGO">
					<subreportParameterExpression><![CDATA[$P{LOGO_FOOTER}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "titleReporte2.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="15" splitType="Stretch">
			<staticText>
				<reportElement x="30" y="0" width="67" height="15" uuid="72ae2b5b-ed78-47ff-83e4-6a3c1f65667f"/>
				<textElement verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[M. Inmobiliaria]]></text>
			</staticText>
			<staticText>
				<reportElement x="97" y="0" width="143" height="15" uuid="cd294c49-c3e3-47ea-830e-1c4c6d13ae76"/>
				<textElement verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Codigo Predial]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="0" width="30" height="15" uuid="6523e87c-31b8-4d10-ad21-3d997e543d55"/>
				<textElement verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Año]]></text>
			</staticText>
			<staticText>
				<reportElement x="240" y="0" width="143" height="15" uuid="7c5658b0-9895-4f7d-98c4-ba5d3ebb8c40"/>
				<textElement verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Contribuyente]]></text>
			</staticText>
			<staticText>
				<reportElement x="383" y="0" width="56" height="15" uuid="9e07ab9a-a205-417a-b35a-901dc1ab5af0"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Impuesto]]></text>
			</staticText>
			<staticText>
				<reportElement x="439" y="0" width="56" height="15" uuid="9304d0ff-78a2-4065-acc4-aefbd1394bba"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Coactiva]]></text>
			</staticText>
			<staticText>
				<reportElement x="495" y="0" width="60" height="15" uuid="8ada12f3-cb1d-4ca6-a60a-ec53a450813d"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="13" splitType="Stretch">
			<textField>
				<reportElement x="30" y="0" width="67" height="12" uuid="8d11e089-652d-4bd4-8524-1e2db5c87385"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{num_predio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="97" y="0" width="143" height="12" uuid="1323b337-d16b-44ef-b55c-9b5b8027e3fb"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cod_predial}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="30" height="12" uuid="912490b1-62a5-4841-8acb-112f17a2c7fe"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{anio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="240" y="0" width="143" height="12" uuid="fd447515-c9f0-4e84-9444-84965a8a8acc"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{contribuyente}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="383" y="0" width="56" height="12" uuid="c8fea953-860c-4726-952f-d4dc48e37f33"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{IMPUESTO}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="439" y="0" width="56" height="12" uuid="459aa35e-6f2a-41c1-803a-90e000088200"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{COACTIVA}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="495" y="0" width="60" height="12" uuid="53d42b56-6546-419c-ac03-5135f770bd73"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="9" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="52" splitType="Stretch">
			<subreport>
				<reportElement x="0" y="0" width="555" height="50" uuid="f992cd97-c73f-4882-ad3a-f4326f17698c"/>
				<subreportParameter name="LOGO">
					<subreportParameterExpression><![CDATA[$P{LOGO_FOOTER}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "footerReporte.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</pageFooter>
	<summary>
		<band height="25" splitType="Stretch">
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="383" y="0" width="56" height="15" uuid="c6b2f078-2a3d-4bd8-9cc4-8d31fdba6f98"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SUMA_IMPUESTO}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="439" y="0" width="56" height="15" uuid="d1e889a0-e16d-45ae-8678-8d28d5a9dda2"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SUMA_COACTIVA}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="495" y="0" width="60" height="15" uuid="fa7effa6-96d8-4a9c-a2d7-a2c907d1b94c"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SUMA_TOTAL}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="283" y="0" width="100" height="15" uuid="a625efe3-bde4-4c0b-937a-3b96e758f8e6"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Totales>>>]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
