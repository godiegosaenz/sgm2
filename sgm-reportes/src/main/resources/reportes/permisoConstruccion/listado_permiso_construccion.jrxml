<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="listado_permiso_construccion" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="e920ab55-139d-4e4c-b6ff-1c212f1a68f2">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="16"/>
	<property name="ireport.y" value="21"/>
	<parameter name="MEMO" class="java.lang.String"/>
	<parameter name="DE" class="java.lang.Long"/>
	<parameter name="HASTA" class="java.lang.Long"/>
	<parameter name="DESDE_ANIO" class="java.lang.Long"/>
	<parameter name="DIRIGIDO_A" class="java.lang.String"/>
	<parameter name="CARGO" class="java.lang.String"/>
	<queryString>
		<![CDATA[select pe.num_reporte,
     ht.id as numero_tramite_nuevo ,
     pe.num_tram_ant as numero_tramite_ant,
     CASE en.es_persona when TRUE THEN
	    coalesce(en.apellidos,'')||' '||coalesce(en.nombres,'')
	else
	    en.razon_social
	end AS nombre_propietario,

     pre.sector||'-'||pre.mz||'-'|| pre.cdla||'-'||pre.mzdiv||'-'||pre.solar||'-'||pre.div1||
'-'||pre.div2||'-'||pre.div3||'-'||pre.div4||'-'||pre.div5||'-'||pre.div6||'-'||pre.div7||
'-'||pre.div8||'-'||pre.div9||'-'||pre.phv||'-'||pre.phh as codnuevo,
     pe.area_construccion as area_const,
     pe.impuesto, pe.inspeccion,
     pe.revision,
     pe.no_adeudar,
     pe.linea_f,
     tipope.codigo as tipo
from
     sgm_flow.historico_tramites ht INNER JOIN sgm_app.pe_permiso as pe ON (pe.numero_tramite = ht.id_tramite)
     left join sgm_app.cat_ente as en on(en.id = pe.propietario_persona)
     left join sgm_app.cat_predio as pre on (pre.id = pe.id_predio)
     left join sgm_app.pe_tipo_permiso as tipope on (tipope.id = pe.tipo_permiso) AND
     ht.id IS NOT NULL
where
     pe.estado like 'A' AND pe.num_reporte NOT IN (300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319) AND
	pe.anio_permiso>=$P{DESDE_ANIO} AND
     pe.num_reporte BETWEEN $P{DE} AND $P{HASTA}

order by
     pe.num_reporte asc]]>
	</queryString>
	<field name="num_reporte" class="java.lang.Long"/>
	<field name="numero_tramite_nuevo" class="java.lang.Long"/>
	<field name="numero_tramite_ant" class="java.lang.Long"/>
	<field name="nombre_propietario" class="java.lang.String"/>
	<field name="codnuevo" class="java.lang.String"/>
	<field name="area_const" class="java.math.BigDecimal"/>
	<field name="impuesto" class="java.math.BigDecimal"/>
	<field name="inspeccion" class="java.math.BigDecimal"/>
	<field name="revision" class="java.math.BigDecimal"/>
	<field name="no_adeudar" class="java.math.BigDecimal"/>
	<field name="linea_f" class="java.math.BigDecimal"/>
	<field name="tipo" class="java.lang.String"/>
	<variable name="SUMA_LIQ" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{SUMA_LIQXPC}]]></variableExpression>
	</variable>
	<variable name="SUMA_LIQXPC" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$F{impuesto}.add($F{inspeccion}.add($F{revision}.add($F{no_adeudar}.add($F{linea_f}))))]]></variableExpression>
	</variable>
	<variable name="xx" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{SUMA_LIQXPC}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="181" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="16" width="77" height="20" uuid="484b263a-bcde-4f45-b4da-9af109a3796b"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[San Miguel,]]></text>
			</staticText>
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement x="77" y="16" width="246" height="20" uuid="9131d779-9862-40d1-8ef4-36477e33f2dd"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="36" width="88" height="20" uuid="cbf66984-81ae-4658-b6b6-1c744bc88257"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Memorandum #]]></text>
			</staticText>
			<textField>
				<reportElement x="88" y="36" width="235" height="20" uuid="bb5b8b3b-f30d-452b-ba78-b3ea36d76999"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{MEMO}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="66" width="52" height="20" uuid="0936eae9-b0e0-4906-8db2-288a551044e3"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Se침or]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="134" width="555" height="20" uuid="bab30abf-ef48-4d8c-81c7-c7a25df3aedd"/>
				<text><![CDATA[Para su conocimiento y aprobaci칩n, sirvase recibir el detalle de la lista que por concepto de Permiso de]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="154" width="555" height="20" uuid="f026cb11-a3dc-4997-b0d0-ecddb48ec9a9"/>
				<text><![CDATA[Construcci칩n que se tratamita  en esta oficina.]]></text>
			</staticText>
			<textField>
				<reportElement x="0" y="86" width="323" height="20" uuid="8af98306-8851-46c0-972e-6c389b9bf2a7"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{DIRIGIDO_A}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="106" width="323" height="20" uuid="38840720-b3c7-4565-92cc-30c6e9318d86"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{CARGO}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="42" height="20" uuid="069f111f-3438-451f-a5c7-62ce2c8091b0"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[# PC]]></text>
			</staticText>
			<staticText>
				<reportElement x="41" y="0" width="67" height="20" uuid="31cf8b0a-9f6c-430f-ab8d-f3e87c3fe69e"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[#Tr치mite]]></text>
			</staticText>
			<staticText>
				<reportElement x="108" y="0" width="148" height="20" uuid="c69df627-9a5c-4ef4-ba9a-32a985de27fe"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Propietario]]></text>
			</staticText>
			<staticText>
				<reportElement x="256" y="0" width="113" height="20" uuid="faa886dd-e25b-4bc3-adbb-64253b00ede0"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Codigo Nuevo]]></text>
			</staticText>
			<staticText>
				<reportElement x="369" y="0" width="85" height="20" uuid="2e79c9e6-7b38-4205-a9f6-f37a1f8723b7"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Area/Con. m2]]></text>
			</staticText>
			<staticText>
				<reportElement x="517" y="0" width="38" height="20" uuid="c792b4f4-44c1-44ff-a4df-13cd3ce01d00"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Tipo]]></text>
			</staticText>
			<staticText>
				<reportElement x="454" y="0" width="63" height="20" uuid="671238be-bdbc-4b60-97ce-a2a93a933bf8"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[V/Liquid. Tasa $]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="16" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="0" width="42" height="16" uuid="76428878-1e25-4874-bb24-e34d36ed0bab"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{num_reporte}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="41" y="0" width="67" height="16" uuid="d2487b40-ecf2-453f-9c24-92c414667ebf"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{numero_tramite_nuevo}!=null?$F{numero_tramite_nuevo}:$F{numero_tramite_ant}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="108" y="0" width="148" height="16" uuid="e20af467-c059-475d-b011-c12c8ce74080"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre_propietario}.toUpperCase()]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="256" y="0" width="113" height="16" uuid="b15c41d6-1145-44ff-ae89-792f3cb22573"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{codnuevo}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="369" y="0" width="85" height="16" uuid="3a0d7082-a061-46e1-afbb-38a40b9bc414"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{area_const}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="517" y="0" width="38" height="16" uuid="a63c3245-e967-4731-8ac6-63159c048825"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{tipo}]]></textFieldExpression>
			</textField>
			<textField pattern="###0.00" isBlankWhenNull="true">
				<reportElement x="454" y="0" width="63" height="16" uuid="5afca78b-77cb-4708-9d31-3541e79e3664"/>
				<box>
					<bottomPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SUMA_LIQXPC}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="50" splitType="Stretch">
			<textField evaluationTime="Report" isBlankWhenNull="true">
				<reportElement x="515" y="30" width="40" height="20" uuid="d19fecb5-0272-444c-86c6-51c872a5d0bc"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="435" y="30" width="80" height="20" uuid="975ddd34-db3f-4d5b-99b3-afe7be1aa4ee"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Pag "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<lastPageFooter>
		<band height="20">
			<textField>
				<reportElement x="435" y="0" width="80" height="20" uuid="da947baa-9ef6-4d8b-932a-d260dacd6ab5"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Pag "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" isBlankWhenNull="true">
				<reportElement x="517" y="0" width="40" height="20" uuid="48401054-dafc-4802-a8d4-6e1db10966cd"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</lastPageFooter>
	<summary>
		<band height="197" splitType="Stretch">
			<staticText>
				<reportElement x="323" y="0" width="100" height="20" uuid="b5b9b5ba-0c95-4eb6-b3c8-19f3e3448284"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total :]]></text>
			</staticText>
			<staticText>
				<reportElement x="174" y="74" width="219" height="20" uuid="fd8e8b0e-07fa-4917-b902-9e3ecee9b135"/>
				<textElement textAlignment="Center">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Atentamente.]]></text>
			</staticText>
			<line>
				<reportElement x="174" y="129" width="219" height="1" uuid="30e28648-1923-4630-a1f9-e3f335da773f"/>
			</line>
			<staticText>
				<reportElement x="174" y="130" width="219" height="20" uuid="2978c675-22e9-43b1-b9fb-29497c15bbeb"/>
				<textElement textAlignment="Center">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Directora  de Edificaciones]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="423" y="0" width="113" height="20" uuid="50d70cfc-bef6-4fce-a934-a8b2efb290fe"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{xx}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
